var tikestep=function(){"use strict";return function(e,t,n){e.find("#step-2").on("click","kbd:not(.frst)",function(t){var o=t.target.tagName.toLowerCase();if("kbd"==o||"span"==o){t.preventDefault(),t.stopPropagation(),v(),$(document).trigger("click.bs.dropdown.data-api",{causeby:"clearmenu"});var i=$("span"==o?t.target.parentNode:t.target),s=t.target.getBoundingClientRect(),l=e.find(".s2_fuckdrowdown"),r=e.find(".s2_fuckdrowdown_body");r.find(".menuitems").each(function(e,t){var n=t.className.indexOf(i[0].className)>=0?"":"none";if(t.style.display=n,""==n&&(n=$(t).find(":input")).length>0){var o=apisvr.a$.trim(i.find("span:first-child").text());"tab"==o&&(o=""),n.val(o),setTimeout(function(){n.select()},100)}}),r.detach().appendTo(i),l.detach().appendTo(i);var a=function(){if((l=i.find(".s2_fuckdrowdown")).length>0){r=i.find(".s2_fuckdrowdown_body");var e=l.dropdown().data()["bs.dropdown"],t=e._getPopperConfig(),n=function(e){var t=30;s.right<e.popper.width&&(t=e.popper.width-s.right+30),r.find("[class^=arrow]").css("right",t)};t.onCreate=function(e){n(e)},t.onUpdate=function(e){n(e)},t.modifiers.offset={offset:"20,0"},e._getPopperConfig=function(){return t},$(e.constructor._getParentFromElement(l[0])).one("hidden.bs.dropdown",function(e){l.dropdown("dispose")}),l.dropdown("toggle")}else setTimeout(a,20)};setTimeout(a,20)}else if("a"==o){var c=$(t.target).find(":input"),f=$(t.target).closest("kbd").find("span"),u=apisvr.a$.trim($(t.target).attr("f")),p=apisvr.a$.trim(c.length>0?c.val():$(t.target).text()),g=!1;if(""==u)p.length>0&&p!=apisvr.a$.trim(f.text())&&(f.html(p),g=!0);else{if(f.attr("f")!=u){var h=$(t.target).closest("kbd").parent().find(".fdata>span[f='"+u+"']"),_=apisvr.a$.trim(f.text());"b"!=u&&h.attr("f",f.attr("f")).html(""==_?"&nbsp;":_),g=!0}"b"==u?f.html("&nbsp;"):f.html(""==p?"&nbsp;":p),f.attr("f",u)}if(g){var w=!1;n.fileinfo?(w=0!=n.fileinfo.issave,L(w),1==n.fileinfo.issave&&(n.fileinfo=$.extend(!0,{},n.fileinfo),n.fileinfo.issave=2)):(n.s3calc&&2==n.stepHis.remLOG&&(w=!0),n.stepHis.remLOG=1),srclocked(!0),setTimeout(function(){x(d($(t.target).closest(".log-ctrl").find("kbd>span"))),w&&m(),srclocked(!1)},10)}}}).on("change","input.mcc-using-sel",function(e){srclocked(!0),$(this).val(),setTimeout(function(){srclocked(!1)},20)});var o,i=function(e,t){return 0!=(e=apisvr.a$.trim(e)).length&&(t.i=Number(e),!0)},s=function(e,t){return e=apisvr.a$.trim(e),t.n=e,!0},l=function(e,t,n){if(e.length<10)return!1;var o=dayjs(e,n);return t.t=o.$d,o.isValid()},r=function(e,t){return!0},a=t("lan"),c=(apisvr.a$.selected_language,"<a class='close' onclick='javascript:$(this).closest(&quot;.popover&quot;).popover(&quot;hide&quot;).data(&quot;bs.popover&quot;).element.showBack = false;'>&times;</a>"),f=function(t,n){t||(t=e.find("#step-2  .log-ctrl kbd>span"));var o,i=$(t[0]),s=($(t[t.length-1]),e.find(".fdata.menuitems"));i.text(n.conf.s),n.conf.f.forEach(function(e,n){(o=$(t[n+1])).attr("f",e),"b"==e?o.html("&nbsp;"):o.html(s.find('a[f="'+e+'"]').text())})},d=function(t,o){t||(t=e.find("#step-2  .log-ctrl kbd>span"));var a,c,d,u,p,g,v=this,h=[],m=[],_=[],w=new Date("9999/1/1"),b=new Date("1900/1/1"),k=function(e){if(c=$(t[0]),d=apisvr.a$.trim($(t[t.length-1]).text()),u=apisvr.a$.trim(c.text()),v&&(v[1]&&(p=function(e){return v[1].indexOf(Number(e))>-1}),v[2]&&(v[2][0]instanceof Date&&!isNaN(v[2][0])||v[2][1]instanceof Date&&!isNaN(v[2][1])))){var n=null,o=null;v[2][0]&&(n=new Date(new Date(v[2][0]).setHours(0,0,0,0))),v[2][1]&&(o=(o=new Date(new Date(v[2][1]).setHours(0,0,0,0))).setDate(o.getDate()+1)),g=function(e){return n&&o?n<=e&&e<=o:n?n<=e:e<=o}}for(var f=1;f<t.length-1;f++)switch($(t[f]).attr("f")){case"i":_.push(i);break;case"n":_.push(s);break;case"t":_.push(l);break;default:_.push(r)}"tab"==u&&(u=/\t/),$.each(e.split(/\r?\n/),function(e,t){var n=t.trim().split(u);if(n.length>1)for(var o=!0,i={},s=0;s<n.length;s++)if(s<_.length&&!_[s](n[s],i,d)){o=!1;break}o&&i.hasOwnProperty("i")&&i.hasOwnProperty("t")&&(p&&!p(i.i)||g&&!g(i.t)||h.push(i))}),a=h.reduce(function(e,t){return e[t.i]=e[t.i]||[],e[t.i].push(t),w>t.t&&(w=t.t),b<t.t&&(b=t.t),e},{}),$.each(a,function(e,t){var n=t[0],o=t.sort(function(e,t){return e.t-t.t});m.push({acno:Number(e),ten:apisvr.a$.trim(n.n),logs:t.length,aLogs:$.map(o,function(e,t){return e.t}),minL:o[0].t,maxL:o[o.length-1].t})})};if(void 0!==v)return k(v[0]||""),[m,w,b];o&&o.conf&&f(t,o),k(n.showinvisibles&&n.showinvisibles.val()||""),e.find("span.logok").html(h.length);var O=e.find(".log-sample kbd.frst");return h.length>0?(h[0].hasOwnProperty("i")&&(O[0].innerHTML=h[0].i),O[1].innerHTML=h[0].hasOwnProperty("n")&&""!=h[0].n?h[0].n:"&nbsp;",h[0].hasOwnProperty("t")&&(O[2].innerHTML=dayjs(h[0].t).format(d))):O.html("&nbsp;"),e.find("span.totalemps").html(m.length),n.allLOGs=[[m,w,b,null,null],null,{f:$.map(t,function(e,t){return $(e).attr("f")}),l:h.length,e:m.length,s:apisvr.a$.trim(c.text()),tf:d,p:"",p0:"",p1:"",p2:"",p3:"",p4:"",p5:"",p6:"",p7:"",p8:"",p9:""}],n.allLOGs[0]},u=function(e){return"verifyLOG"==e?d:"LAN"==e?a:"cTIP"==e?c:"uiDEV"==e?x:"hisLOG"==e?D:"logFROMDB"==e?h:"resetUPLOAD"==e?I:"cleanHIS"==e?R:"logCONF"==e?g:"delHISLOG"==e?y:"dogIFRM"==e?C.dogIFRM:"saveDUPHIS"==e?(L(2==n.fileinfo),[C,C.lstORfrm]):"dlgs3"==e?p:void 0},p=function(e,t,n){return DevExpress.ui.dialog.custom({title:a.js_004_18[0],showTitle:!1,messageHtml:a.js_004_18[1],popupOptions:{_ignoreFunctionValueDeprecation:!0},buttons:[{text:a.js_004_18[2],visible:!0===n.s3,onClick:function(e){return-2}},{text:n.b2?n.b2:a.js_004_18[3],onClick:function(e){return 1}},{text:a.js_003_1,onClick:function(e){return 0}}]})},g=function(){var e=n.allLOGs[2];return e.minL=n.allLOGs[0][1],e.maxL=n.allLOGs[0][2],e},v=function(e){n.selEMP_popover&&n.selEMP_popover.popover("hide"),n.log_fromto_popover&&n.log_fromto_popover.popover("hide"),!e&&n.saveLOCKED_popover&&n.saveLOCKED_popover.popover("hide")},h=function(i,s){C.parent().find(".logFROMDB").off("click").on("click",function(i){srclocked(!0),v(),H(function(){o||(o=new FormWizard.s2log.init(e,t,n,u)),o.lstHis(C.parent(),C.lstORfrm)})}).css("display",!i||(!(i[2]>=1)||n.fileinfo)&&i[2]+s<=1?"none":"")},m=function(){var i=function(){return 1==n.stepHis.remLOG&&!n.fileinfo};if(n.puSAVELOG||(n.puSAVELOG=e.find(".saveAttlog"),n.puSAVELOG.on("click",function(i,s){srclocked(!0);var l=$(this);l.attr("disabled",!0),v(s),setTimeout(function(){admin$.DEV(function(){H(function(){o||(o=new FormWizard.s2log.init(e,t,n,u)),o.saveUplog.call(C.lstORfrm,l,function(e){var t="function"==typeof A;if(1==e){var o=["",s&&s.s3];this&&$.isArray(this)&&("N"==this[0]&&(C.lstORfrm=null),o[0]=this.join("|")),C.trigger("s2_srclog_changed",o),t||toastMsg(a.js_003_ok,"success"),b(["","none"]),P(""),N(3),n.stepHis.isTiCo=1}else l.attr("disabled",!1);t&&A(e)},s)})})},10)}),n.puSAVELOG.next().on("click",function(e){_(e,{hide:function(e,t){1===t&&(n.puSAVELOG.parent().css("display","none"),P(""),i()||w(""))},done:function(e){if(i()){srclocked(!0);var t=$.Deferred();$.when(t).then(function(e){2==n.stepHis.remLOG&&(n.stepHis.isTiCo=0),srclocked(!1)}),setTimeout(function(){B(t)},10)}else{var o=n.logDAT[n.fileinfo.id];n.fileinfo=$.extend(!0,{},o[0]),L(2==o[0].issave),n.showinvisibles.val(o[1].dat),x(d(null,n.fileinfo))}}},[0,5])}),n.saveLOCKED_popover=n.puSAVELOG.parent(),n.saveLOCKED_popover.popover({offset:"100%,10",container:e.find("#step-2"),placement:"bottom",trigger:"manual",html:!0,title:"<i class='ti-alert'/> "+a.js_004_17[1]+c,content:function(){return i()?a.js_004_17[3]:a.js_004_17[2]}})),i())b(["none","none"]),w("none"),n.puSAVELOG.css("display","none"),n.puSAVELOG.next().css("display",""),n.saveLOCKED_popover.fadeIn("fast",function(){n.saveLOCKED_popover.popover("show")});else{var s=!1;n.puSAVELOG.css("display","").attr("disabled",!1),n.puSAVELOG.next().css("display",2==n.fileinfo.issave?"":"none"),0==n.fileinfo.issave?b(["none",""]):2==n.fileinfo.issave&&(w("none"),s=!0),n.saveLOCKED_popover.fadeIn("fast",function(){s&&n.saveLOCKED_popover.popover("show")}),P("none")}},_=function(e,t,n,o){v();var i,s=null,l=admin$.popup({a:"d",t:"function"==typeof n&&n().title||a.js_004_16[n[0]],m:"function"==typeof n&&n().txt||a.js_004_16[n[1]]}),r=l.find("#popupdone");return r.html(a.js_004_3),r.removeClass("btn-secondary").addClass("btn-danger"),r.click(function(e){s=1,l.modal("hide"),t.done&&"function"==typeof t.done&&t.done(e,s)}),r[((i=!0)?"add":"remove")+"Class"]("btn-primary").prop("disabled",!i),o&&o.fnM&&"function"==typeof o.fnM&&o.fnM(l),l.modal("show"),srclocked(!1),l.one("hide.bs.modal",function(e){t.hide&&"function"==typeof t.hide&&t.hide(e,s)}),l},w=function(t){C.rmvHisAttlog||(C.rmvHisAttlog=e.find(".rmvHisAttlog"),C.rmvHisAttlog.on("click",function(e,t){_(e,{hide:function(e,n){1==n?C.rmvHisAttlog.fadeOut("fast"):!n&&t&&t.fnCB&&t.fnCB(n)},done:function(e){var o=$.Deferred(),i={};i[n.fileinfo.id]=!1,$.when(o).then(function(e){R(e,!0),t&&t.fnCB?t.fnCB(1):srclocked(!1)}),D(o,n.dbTBname,{id:-1},i),n.stepHis.isTiCo=1}},t&&t.dlgTXT?function(){return t.dlgTXT}:[0,3],t)})),C.lstORfrm&&(t="none"),C.rmvHisAttlog.css("display",t)},b=function(t){if(!C.delHisAttlog){var o=e.find(".delHisAttlog"),i=o.clone();i.removeClass("delHisAttlog btn-outline-danger").addClass("btn-warning").css({display:"none",padding:"5px 6px 2px"}).html("<i class='ti-close'></i>"),o.parent().append(i),C.delHisAttlog=[o,i],o.on("click",function(e){_(e,{hide:function(e,t){1===t&&(srclocked(!0),o.fadeOut("fast"),L(!1),n.saveLOCKED_popover&&n.saveLOCKED_popover.css("display","none"))},done:function(e,t){var o=function(){var e=C.dogIFRM.contentWindow.chanelLog[1].log;e[1]=void 0,R(e,!0),n.stepHis.isTiCo=1,srclocked(!1)};y(function(e){var t=C.find(".hislog-list tbody"),i=n.fileinfo.id;if(t.length>0)t.find("tr[idx='"+i+"'] .bntrmv").trigger("click",[-1*parseInt(i)]);else if(e&&"function"==typeof e){var s=$.Deferred();$.when(s).then(function(e){o()}),e(-1*i,s)}else o()},n.fileinfo.id,n.fileinfo.tc3id)}},[0,2])}),i.on("click",function(e){_(e,{hide:function(e,t){1==t&&i.fadeOut("fast")},done:function(e,t){C.currHISID?(srclocked(!0),setTimeout(function(){var e,t,o,i=function(){x(o),n.rst_attlog?n.ReadyEMP=function(e){n.ReadyEMP=null,srclocked(!1)}:srclocked(!1),C.currHISID=null};if(C.lstORfrm)e=n.logDAT[C.currHISID.id],t=[C.lstORfrm[0],e[1],C.lstORfrm[2]];else{if(C.currHISID.isREM){delete n.fileinfo,I(null,!1,!0,!1);var s=function(e,t){n.showinvisibles.val(t),o=d(null,e),i()};if(1==n.stepHis.remLOG){var l=$.Deferred();$.when(l).then(function(e){s({conf:e.conf},e.log),n.stepHis.remLOG=2}),N(1,l)}else s({conf:C.currHISID.conf},C.currHISID.isREM);return}(e=n.logDAT[C.currHISID.id])?t=[[e[0]],e[1]]:(delete n.fileinfo,n.showinvisibles.val(""),t=[[],null])}o=I(t,!1,void 0,!1),i()})):(R(null,!1),N(3))}},[0,1])})}w(t[0]),C.delHisAttlog[0].css("display",t[0]),C.delHisAttlog[1].css("display",t[1]),C.delHisAttlog[0].parent().css("display",""==t[0]||""==t[1]?"":"none")},k=function(e,t){e[1].log[2]--;for(var n=e[1].log[0].length-1;n>-1;n--)e[1].log[0][n].id==-1*t&&e[1].log[0].splice(n,1);h(e[1].log,0)},O=!1,L=function(e){O=e,C.parent().find(".selAttlog").css("display",e?"none":""),C.parent().find(".logFROMDB").prop("disabled",e)},D=function(e,o,i,s){if("noU"==n.hasUA)lo$DB(function(t){if(0==t.kq)t.cb("cancel"),e.resolve();else if(1==t.kq){var n,l,r=[],a=0,c=t.rst.transaction(o,s?"readwrite":"readonly"),f=c.objectStore(o[0]);c.oncomplete=function(){t.rst.close(),e.resolve([r,n,a])},f.openCursor().onsuccess=function(e){var t=e.target.result;t?(a+=1,s&&void 0!==s[t.value.id]&&(t.value.issel=s[t.value.id],t.update(t.value),C.trigger("s2_srclog_changed","upt")),i&&!function(e){for(var t in i)if(i.hasOwnProperty(t)&&e[t]!=i[t])return"id"==t&&(l=parseInt(i[t])),!1;return!0}(t.value)||r.push(t.value),t.continue()):o.length>1&&r.length>0&&(l=l||r[r.length-1].id,c.objectStore(o[1]).index("LogIndex").get(l).onsuccess=function(e){n=e.target.result})}}});else{var l=$.Deferred(),r=$.Deferred(),a=function(e){var l=C.dogIFRM.contentWindow,a=l.chanelLog,c=function(e){var t=$.grep(a[1].log[0],function(t,n){return"LOG_IN_LST"==o[0]?o[1].indexOf(t.id)>-1:t.id==e.logid});f&&k(a,f),r.resolve([t,e,a[1].log[2]])},f=function(){if(s)for(var e in s)if(s.hasOwnProperty(e)&&parseInt(e)<0)return e;return null}();e&&e(a[1].log[0]),!f&&i&&n.logDAT[i.id]?c(n.logDAT[i.id][1]):-1!=i.id?(t("___").comm1.loghole(l,a[1],"6c6f67717279",{logh:btoa(JSON.stringify([i,s])),logkind:1}),l.cbHwnd=function(e){l.cbHwnd=null,c(e)}):r.resolve([[],void 0,a[1].log[2]])};$.when(l,r).then(function(t,n){e.resolve(n,t)}),s?(t("___").comm1.uaShift(s,"SEL_HIS_LOG",!1).then(function(e){C.trigger("s2_srclog_changed","upt"),l.resolve(e)}),a(function(e){for(var t=0;t<e.length;t++)s.hasOwnProperty(e[t].id)&&(e[t].issel=s[e[t].id])})):(a(),l.resolve())}},y=function(e,t,o){"noU"==n.hasUA?lo$DB(function(i){var s=i.rst.transaction(n.dbTBname,"readwrite"),l=s.objectStore(n.dbTBname[0]),r=s.objectStore(n.dbTBname[1]);s.oncomplete=function(){i.rst.close();var n=C.dogIFRM.contentWindow.chanelLog;k(n,-1*parseInt(t)),C.trigger("s2_srclog_changed","del"),e()},l.delete(t),r.delete(o)}):e(function(e,t){var o={};o[e]=!0,D(t,n.dbTBname,{issel:!0},o)})},H=function(e){_gsC(srcpf$+"/media/js/tikestep_s2.js?"+(new Date).getTime(),"js",function(){e()},"tikestep_s2.js")},x=function(e){n.rst_attlog&&n.rst_attlog.option({dataSource:e[0],paging:{pageIndex:0}}),n.log_fromto_popover&&(n.log_from.option("placeholder",DevExpress.localization.formatDate(e[1],"shortdate")),e[3]=n.log_from.option("value"),n.log_to.option("placeholder",DevExpress.localization.formatDate(e[2],"shortdate")),e[4]=n.log_to.option("value"))},A=-1,C=e.find(".uploadattlog"),S=helloguy.clone(),T=function(){n.s2loglist_scroPerf&&(n.s2loglist_scroPerf.destroy(),delete n.s2loglist_scroPerf)},I=function(e,t,o,i){T(),C.find(".hislog-list").remove();var s=G(e);if(M(e,t,function(){s||(n.fileinfo?C.dogIFRM.contentWindow.showUpLog(n.fileinfo.file,b):C.dogIFRM.contentWindow.dropzone.removeAllFiles())}),i&&N(3),n.puSAVELOG&&n.puSAVELOG.parent().css("display","none"),P(""),!o)return d(null,n.fileinfo)},E=function(e){var o,i=$('<table style="display:none" class="table hislog-list table-fixed"><thead></thead><tbody style="height: 130px"></tbody></table>'),s=i.find("thead"),l=null,r=null,c=function(e,t){-1==unlockedHWND&&srclocked(!0),e=parseInt(e);var o=function(e,t){var o=d(null,t),i=$.Deferred(),s=$.Deferred();$.when(i,s).then(function(e,t){srclocked(!1)}),r&&"function"==typeof r?r(e,s):s.resolve("fnCB NULL"),n.rst_attlog?(n.rst_attlog.clearFilter(),n.ReadyEMP=function(e){i.resolve("UI")},x(o)):i.resolve("UI")};if(n.logDAT[e])M([[n.logDAT[e][0]],n.logDAT[e][1]],!1,function(){o("CACHE",n.logDAT[e][0])});else{var i=$.Deferred();$.when(i).then(function(e){M(e,!1,function(){o("DB",e[0][0])})}),D(i,n.dbTBname,{id:e},t)}},f=function(e,t,i,s){if(n.stepHis.isTiCo=1,"th"==e.target.tagName.toLowerCase()){-1==unlockedHWND&&srclocked(!0),i&&(i.off("hide.bs.modal"),i.modal("hide"));var l={};o.find("tr:not(.row-sum)").each(function(e,t){l[parseInt(t.getAttribute("idx"))]=!1});var r=$.Deferred();$.when(r).then(function(e){R(e,!1),s&&"function"==typeof s&&s(1),srclocked(!1)}),D(r,n.dbTBname,{id:-1,issel:!0},l)}else t.animate({height:10},200,function(e){t.remove(),s&&"function"==typeof s&&s(1),i&&i.modal("hide")})};s.html("<tr style='font-size:11px'><th class='col-1 center ti-eraser bntrmv'></th><th class='col-5'>"+a.js_004_15[2]+"</th><th class='col-2 center'>Size (Kb)</th><th class='col-2 center'>"+a.js_004_32+"</th><th class='col-2 center'>"+a.js_004_33+"</th></tr>");for(var u=0,p=0,g=0,v=e[0].length-1;v>-1;v--){var h=Math.floor(e[0][v].file.size/1e3),m=!1;u+=e[0][v].conf.l,p+=e[0][v].conf.e,g+=h,e[1]?m=e[1].logid==e[0][v].id:v==e[0].length-1&&(m=!0),o+="<tr idx='"+e[0][v].id+"' "+(m?"class='selected'":"")+"><td class='col-1 ti-close bntrmv center'></td><td class='col-5'>"+e[0][v].file.name+"</td><td class='col-2 text-right'>"+h+"</td><td class='col-2 text-right'>"+e[0][v].conf.l+"</td><td class='col-2 text-right'>"+e[0][v].conf.e+"</td></tr>"}o+="<tr class='row-sum'><td class='col-6 text-right'>"+a.js_004_15[4]+"</td><td class='col-2 text-right'>"+g+"</td><td class='col-2 text-right'>"+u+"</td><td class='col-2 text-right'>"+p+"</td></tr>",i.on("click",".bntrmv",function(e,o){if(e.stopPropagation(),e.preventDefault(),O)n.saveLOCKED_popover.popover("show");else{-1==unlockedHWND&&srclocked(!0);var i=e,s=$(this).parent();o&&!o.u4?f(e,s,null,function(){l.resolve(o)}):setTimeout(function(){!function(e,n,o){a||(a=t("lan"));var i,s="th"==e.target.tagName.toLowerCase(),r=null,c=admin$.popup({a:"d",t:o&&o.dlgTXT.title||a.js_004_16[0],m:o&&o.dlgTXT.txt||a.js_004_16[s?4:3]}),d=c.find("#popupdone");d.html(a.js_004_3),d.removeClass("btn-secondary").addClass("btn-danger"),d.click(function(){r=n.attr("idx"),f(e,n,c,o&&o.fnCB)}),d[((i=!0)?"add":"remove")+"Class"]("btn-primary").prop("disabled",!i),o&&o.fnM&&"function"==typeof o.fnM&&o.fnM(c),c.modal("show"),srclocked(!1),c.one("hide.bs.modal",function(e){l&&(srclocked(!0),l.resolve(r)),!r&&o&&o.fnCB&&o.fnCB(r)})}(i,s,o)},20)}}),(o=i.find("tbody").html(o)).on("click","tr:not(.row-sum)",function(e){if(O)return e.stopPropagation(),e.preventDefault(),void n.saveLOCKED_popover.popover("show");var t,s,a,f=$(this),d=$(e.target).hasClass("bntrmv");d&&(l=new $.Deferred,$.when(l).then(function(e){if(l=null,e){var d,u={},p=function(o){if("-1"!=e){var i=$.Deferred();parseInt(parseInt(t)),$.when(i).then(function(e){d&&d.contentWindow.showUpLog(n.fileinfo.file,b),o?o.resolve("srclocked(false)"):srclocked(!1)}),D(i,n.dbTBname,{id:"noU"==n.hasUA?-1:parseInt(a.attr("idx")),issel:!0},u)}};if(u[parseInt(e)]=!1,t!=a.attr("idx")?(r=function(e,t){r=null,"CACHE"==e?p(t):(d&&d.contentWindow.showUpLog(n.fileinfo.file,b),t.resolve("fnCB_DB"))},c(a.attr("idx"),u)):p(),(d=o.find("tr:not(.row-sum)")).length<=1){C.lstORfrm=null;var g=C.dogIFRM;d=g,i.fadeOut("fast",function(){i.remove(),$(g).css({display:"none",opacity:"1"}).fadeIn()})}else{for(var v=0,h=0,m=0,_=[],w=0;w<d.length;w++){var k=$(d[w]),O=k.find("td");_.push(Number(k.attr("idx"))),m+=parseInt(apisvr.a$.trim($(O[2]).text())),v+=parseInt(apisvr.a$.trim($(O[3]).text())),h+=parseInt(apisvr.a$.trim($(O[4]).text()))}(d=o.find("tr.row-sum td"))[1].innerHTML=m,d[2].innerHTML=v,d[3].innerHTML=h,d=null,a.addClass("selected");var L=C.lstORfrm[0];for(w=L.length-1;w>-1;w--)-1==_.indexOf(L[w].id)&&L.splice(w,1);C.lstORfrm[2]=_.length}}else s&&s.attr("idx")==f.attr("idx")?srclocked(!1):c(f.attr("idx"))})),s=function(e,t){var n=o.find("tr.selected"),i=t.getAttribute("idx");return 0!=n.length&&n.attr("idx")==i||(o.find("tr").removeClass("selected"),$(t).addClass("selected"),l||(-1==unlockedHWND&&srclocked(!0),setTimeout(function(){c(i)},20))),0==n.length?null:n}(0,this),d&&(t=s?s.attr("idx"):0,0==(a=f.next("tr:not(.row-sum)")).length&&(a=$(this).prev("tr")))}),i$Desk&&(n.s2loglist_scroPerf=new PerfectScrollbar(i.find("tbody")[0],{suppressScrollX:!0})),C.append(i),i.fadeIn()},G=function(e){var t=e&&$.grep(e[0],function(e,t){return e.issel}).length>1,n=C.find(".hislog-list"),o=C.find("iframe");return t?(E(e),C.lstORfrm=e,o.length>0&&o.fadeOut("fast",function(){o.css({display:"",opacity:"0"})})):(C.lstORfrm=null,n.length>0&&n.fadeOut("fast",function(){T(),n.remove()}),o.length>0&&o.css({display:"none",opacity:"1"}).fadeIn()),t},M=function(e,t,o){var i="none";if(e&&e[1]){var s;n.showinvisibles.val(e[1].dat);for(var l=e[0].length-1;l>-1;l--)e[0][l].id==e[1].logid&&(s=e[0][l]);s.tc3id=e[1].id,n.logDAT[s.id]||(n.logDAT[s.id]=[s,e[1]]),n.fileinfo=s,i=""}b([i,"none"]),o&&"function"==typeof o&&o(),t&&h(e,0)},j=function(i){Main.isMobile()?o&&1==n.showlistLOG?o.upload_attlog():(d(),i&&(m(),srclocked(!1))):H(function(){o||(o=new FormWizard.s2log.init(e,t,n,u)),o.upload_attlog()})},R=function(e,t){delete n.fileinfo,n.showinvisibles.val("");var o=I(e,t,void 0,!1);return x(o),o},N=function(e,t){var o="cmVtX2F0dGxvZw==",i="noU"==n.hasUA?1:n[0].__u,s=function(t){lo$DB(function(o){if(0==o.kq){var s=o.e.target.result;s.objectStoreNames.contains("remLOG")&&s.deleteObjectStore("remLOG"),s.createObjectStore("remLOG",{keyPath:"id"})}else if(1==o.kq){var l,r=o.rst.transaction(["remLOG"],0==e?"readonly":"readwrite").objectStore("remLOG");1==e?l=r.get(i):2==e&&(l=r.put({id:i,conf:g(),log:n.showinvisibles.val()})),l.onsuccess=function(n){2==e?t(n.target.result):t&&t.resolve(n.target.result)}}},"hellohrm_remlog")};if(0==e)return(l=st("getItem",o))&&l.split(i).length>1;if(1==e)s(t);else if(2==e)1==n.stepHis.remLOG&&((l=st("getItem",o))?-1==(l=JSON.parse(l)).indexOf(i)&&l.push(i):l=[i],s(function(){st("setItem",o,JSON.stringify(l)),n.stepHis.remLOG=2}),n.saveLOCKED_popover&&n.saveLOCKED_popover.css("display","none"));else if(3==e){var l;0!=n.stepHis.remLOG&&(l=st("getItem",o))&&(l=JSON.parse(l),l=$.grep(l,function(e){return e!=i}),st((l.length>0?"set":"remove")+"Item",o,JSON.stringify(l))),n.stepHis.remLOG=0}},B=function(e){var t=$.Deferred();$.when(t).then(function(t){t&&(n.showinvisibles.val(t.log),d(null,{conf:t.conf}),n.stepHis.remLOG=2),e.resolve()}),N(1,t)},P=function(e){var t=C.parent(),n=""!=e;t.find(".selAttlog .samplefile").css("display",e),t.find(".selAttlog .upfile").prop("disabled",n),t.find(".logFROMDB").prop("disabled",n)},W=function(){var e,t=admin$.popup({a:"f"}),o=function(e){e.find(".btn").on("click",function(e){var t=$(this).attr("dn");srclocked(!0),setTimeout(function(){i(t)},10)}),t.find(".modal-body").append(e),setTimeout(function(){t.one("shown.bs.modal",function(){t.off("shown.bs.modal"),srclocked(!1)}).modal("show")},1)},i=function(o){var i=JSON.parse(e[o]);$.get(srcp$f+"/media/utils/"+i.p+src$id).done(function(e){var o={u4:"clean4download",dlgTXT:{title:a.__exLAN.dlg[0],txt:a.__exLAN.dlg[1]},fnM:function(e){e.find(".modal-dialog").removeClass("modal-sm").addClass("modal-md")},fnCB:function(o){1==o?(t.modal("hide"),f(null,{conf:i}),n.showinvisibles.val(e),j(!1),n.showinvisibles.trigger("change",["samlog"]),n.stepHis.isTiCo=1):t.css("opacity",1)}};C.lstORfrm?(t.css("opacity",0),C.find("th.bntrmv").trigger("click",[o])):n.fileinfo?(t.css("opacity",0),C.rmvHisAttlog.trigger("click",[o])):o.fnCB(1)}).fail(function(e){srclocked(!1)})};n.logsample_templ?(o(n.logsample_templ),e=C.dogIFRM.contentWindow.__logSAM.conf()):$.get(srcp$f+"/media/utils/lst.html"+src$id).done(function(t){var i=$(t).find(".pricing-table-log"),s=apisvr.a$.selected_language,l=C.dogIFRM.contentWindow,r=i.find("script"),c=r[0].innerHTML;r.remove(),n.logsample_templ=i,l.__doHandshake=function(){l.__doHandshake=null,a.__exLAN=$.extend({}||a.__exLAN,l.__logSAM.exLAN()[s]),e=l.__logSAM.conf(),l=l.__logSAM.ln(),"en"!=s&&n.logsample_templ.find("[data-lang]").each(function(e,t){var n=t.getAttribute("data-lang");$(t).html(l[s][n])})},l.loadjscssfile(c,"jst"),o(n.logsample_templ)}).fail(function(e){srclocked(!1)}),t.find("#popupdone").remove(),t.find(".modal-footer").css("justify-content","center").find("button").removeClass("btn-secondary").addClass("btn-danger"),t.addClass("modal-aside vertical top")},F=function(){C.trigger("s2_srclog_changed",["sample","plsDEL",function(){t("___").comm1.uaShift({},"S3_KQx",!1).then(function(e){})}])},U=function(o,i){var s=$.Deferred(),l=$.Deferred(),r=$.Deferred(),c=$.Deferred(),f={issel:!0};N(0)?(f.id=-1,delete f.issel,B(c)):c.resolve(),"noU"==n.hasUA?($.when(s).then(function(e){var t=G(e);M(e,!0,function(){r.resolve([t,e])})}),$.when(l,r,c).then(function(e,t,o){var i=t[0],s=t[1];!i&&n.fileinfo&&e[0].contentWindow.showUpLog(n.fileinfo.file,b),s&&d(null,n.fileinfo),e[0].contentWindow.chanelLog=[,{log:s||[[],void 0,0]}],e[1]()}),D(s,n.dbTBname,f)):$.when(l).then(function(e){var o=t("alog");if(o.key&&o.log){var i=[$.grep(o.log[0],function(e,t){return e.issel===f.issel}),null,o.log[2]],s=G(i),l=e[0].contentWindow;i[0].length>0?(l.cbHwnd=function(t){l.cbHwnd=null,i[1]=t,M(i,!0,function(){!s&&n.fileinfo&&e[0].contentWindow.showUpLog(n.fileinfo.file,b),d(null,n.fileinfo),e[1]()})},t("___").comm1.loghole(l,o,"4c4f475f4c4f4144",{logh:btoa(JSON.stringify(["L",i[0][i[0].length-1].id])),logkind:1,ori:window.location.origin+";*"})):(l.chanelLog=[,o],h(o,0),e[1]())}else G([[],null,0]),e[1]()}),function(e){var t,o=n.s2_session;0==C.find("iframe").length&&(apisvr.a$.sessions[o]={hwndTO:null,id:o,fn:function(o,i,s){if("postmsg"==o){var l=C.find("#ifrm_"+i)[0].contentWindow;l.focus(),l.postMessage({msgtype:"session",msgkind:i,evtData:{a$:"olshift"}},"*")}else"job"==o&&("loaded"==i.evtData.evt?(clearTimeout(void 0),t.contentWindow.lan(a.js_004_12),this.origin=i.evtData.origin,e.resolve([t,function(){S.trigger("adu_loadlog"),S.remove()}])):"attlog"==i.evtData.evt?(n.fileinfo?C.currHISID=$.extend(!0,{},n.fileinfo):0!=n.stepHis.remLOG?C.currHISID={isREM:n.showinvisibles.val(),conf:g()}:C.currHISID=null,n.showinvisibles.val(i.evtData.dat),n.fileinfo={file:i.evtData.file,issave:0,issel:!0,uptime:new Date},t.style.opacity=1,T(),C.find(".table.hislog-list").remove(),j(!0),n.trapHwnd=m):"startupload"==i.evtData.evt?C.parent().find(".selAttlog .upfile").prop("disabled",!0):"function"==typeof this[i.evtData.evt]&&this[i.evtData.evt](o,i,s))}},C.find("iframe").remove(),(t=document.createElement("iframe")).style.opacity=1,t.style.display="none",t.style.width="100%",t.style.height="140px",t.setAttribute("scrolling","no"),t.setAttribute("frameBorder","0"),t.onload=function(){setTimeout(function(){var e=t.contentWindow.document,n=e.createElement("script"),i=window[st0("1")](o+"|"+srcpf$+"|"+window.location.origin+"|"+GetIEVersion()+"|"+$("#app").hasClass("darkcolor"));n.setAttribute("seson",i),n.setAttribute("src",srcp$f+"/media/utils/jsc/iframeattlog.js"+src$id),e.head.appendChild(n)},10),C.dogIFRM=t},C[0].appendChild(t))}(l),n[i[1]]=e.find("."+i[1]),n[i[1]].off("change").on("change",function(e,t){-1==unlockedHWND&&srclocked(!0);var o=!1;n.fileinfo?(o=0!=n.fileinfo.issave,L(o),1==n.fileinfo.issave&&(n.fileinfo=$.extend(!0,{},n.fileinfo),n.fileinfo.issave=2)):(n.s3calc&&2==n.stepHis.remLOG&&(o=!0),n.stepHis.remLOG=1),setTimeout(function(){"samlog"!=t&&x(d()),o&&(m(),n.stepHis.isTiCo=1),"function"==typeof A?A():srclocked(!1)},20)}),e.find(".selAttlog .btn").on("click",function(e){if($(e.currentTarget).hasClass("upfile")){v();var t=C.dogIFRM;t&&t.contentWindow.clickE()}else srclocked(!0),setTimeout(W,20)}),e.find(".attlog_verify").off("mousedown touchstart").on("mousedown touchstart",function(e){unlockedHWND=0,A=function(){A=-1},frmWizHwnd.pStep=function(e){frmWizHwnd.pStep=null;var t=function(t){n.lockstep(o,!1),-1==["0"].indexOf(t.toString())&&e(),srclocked(!1)};if(n.fileinfo&&1!=n.fileinfo.issave){var i=function(e){A=function(e){A=-1,-2==e&&(n.stepHis.viewBackS3=e),t(e)},n.puSAVELOG&&n.puSAVELOG.trigger("click",[$.extend(!0,{},{s3:!!n.s3calc},e)])};n.akq?p(null,null,{s3:!0}).show().done(function(e){0==e?n.lockstep(o,!1):-2==e?(n.stepHis.viewBackS3=e,t(-2==e?2:e)):1==e&&i({s3:"plsDEL"})}):i({})}else if(n.s3calc){var s=function(e,i){p(null,null,i).show().done(function(i){0==i?n.lockstep(o,!1):(-2==i?n.stepHis.viewBackS3=i:1==i&&(e&&"function"==typeof e&&e(),n.stepHis.isTiCo=1),t(-2==i?2:i))}),srclocked(!1)};n.akq&&0==n.akq[0].toString().indexOf("-1")?s(function(){delete n.akq},{s3:!0,b2:a.js_004_19[4]}):1==n.stepHis.remLOG?s(function(){n.akq&&F()},{s3:!!n.s3calc}):1==n.stepHis.isTiCo&&n.s3calc?s(null,{s3:!0,b2:a.js_004_19[4]}):t(1)}else t(1)}})};this.doStep=function(i,s,l,r){v(),"2"==s.fromStep.toString()&&(n.selEMP_popover&&n.selEMP_popover.popover("hide"),n.log_fromto_popover&&n.log_fromto_popover.popover("hide")),"2"==s.toStep.toString()?(n[r[0]]?n[r[0]].showBack&&n[r[0]].popover("show"):(n[r[0]]=e.find(".testupload .needuptclick"),n[r[0]],n[r[0]].parent().on("click",function(){srclocked(!0),v(),admin$.DEV(function(){H(function(){o||(o=new FormWizard.s2log.init(e,t,n,u)),n.ReadyEMP=function(e){n.ReadyEMP=null,n.showlistLOG=1,srclocked(!1)},o.grid_attlog()}),srclocked(!1)})})),n[r[1]]||(S.css({display:"",position:"absolute",height:"200px"}).removeAttr("id"),C.append(S),U(i,r))):"3"==s.toStep.toString()&&(n.lockstep(i,!0),_gsC(srcpf$+"/media/js/tikestep_s3.js"+src$id,"js",function(){var o=function(t){n.s3calc.viewBack(n,e,function(){n.lockstep(i,!1)},t)};if("0"==l)o(!1);else if(n.stepHis.viewBackS3)o(!0),delete n.stepHis.viewBackS3;else if(1==n.stepHis.isTiCo){n.allLOGs||C.lstORfrm||d();var s=function(t){var o;-1!=unlockedHWND&&srclocked(!1),["mixed","true"].indexOf(n.selEMP_popover&&n.selEMP_popover.attr("aria-checked"))>-1?n.allLOGs[1]=n.rst_attlog.getSelectedRowKeys():n.allLOGs[1]=null,C.lstORfrm&&((o=[])[0]=$.extend(!0,[],C.lstORfrm[0]),o[1]=n.logDAT[n.fileinfo.id][1]),0==t?n.s3calc.exec.call(["uplog",o,n.stepHis.remLOG],n,e,function(){N(2),n.lockstep(i,!1),n.stepHis.isTiCo=0,A=-1}):e.find(".kiem-the .btn-tinhlai").trigger("ditinhlai",[["uplog",o,n.stepHis.remLOG],{}])};n.s3calc?s(1):(n.s3calc=FormWizard.s3calc.createCalc({kind:"noshift",Args:{lockStep:function(e){n.lockstep(i,e)},tinhlaiCHK:function(e){n.fileinfo&&1!=n.fileinfo.issave?(A=function(t){e(t)},n.puSAVELOG.trigger("click",[{dupmsg:a.js_004_15[5]}])):1==n.stepHis.remLOG?p(null,null,{s3:!1}).show().done(function(t){1==t&&(F(),e(t).trigger("ditinhlai"))}):p(null,null,{s3:!1,b2:a.js_004_19[4]}).show().done(function(t){1==t&&(e(t),n[r[1]]?s(1):(S.on("adu_loadlog",function(e){d(),s(1)}),U(i,r)))})},LAN:a,stepcodeback:t},shareMe:u}),s(0))}else n.s3calc?o(!1):n.lockstep(i,!1)},"tikestep_s3.js"))}}}();