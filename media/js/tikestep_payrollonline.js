var tikestep=function(){"use strict";return function(e,t,n){e.find("#step-2").on("click","kbd:not(.frst)",function(t){var o=t.target.tagName.toLowerCase();if("kbd"==o||"span"==o){t.preventDefault(),t.stopPropagation(),p(),$(document).trigger("click.bs.dropdown.data-api",{causeby:"clearmenu"});var i=$("span"==o?t.target.parentNode:t.target),s=t.target.getBoundingClientRect(),l=e.find(".s2_fuckdrowdown"),r=e.find(".s2_fuckdrowdown_body");r.find(".menuitems").each(function(e,t){var n=t.className.indexOf(i[0].className)>=0?"":"none";if(t.style.display=n,""==n&&(n=$(t).find(":input")).length>0){var o=apisvr.a$.trim(i.find("span:first-child").text());"tab"==o&&(o=""),n.val(o),setTimeout(function(){n.select()},100)}}),r.detach().appendTo(i),l.detach().appendTo(i);var a=function(){if((l=i.find(".s2_fuckdrowdown")).length>0){r=i.find(".s2_fuckdrowdown_body");var e=l.dropdown().data()["bs.dropdown"],t=e._getPopperConfig(),n=function(e){var t=30;s.right<e.popper.width&&(t=e.popper.width-s.right+30),r.find("[class^=arrow]").css("right",t)};t.onCreate=function(e){n(e)},t.onUpdate=function(e){n(e)},t.modifiers.offset={offset:"20,0"},e._getPopperConfig=function(){return t},$(e.constructor._getParentFromElement(l[0])).one("hidden.bs.dropdown",function(e){l.dropdown("dispose")}),l.dropdown("toggle")}else setTimeout(a,20)};setTimeout(a,20)}else if("a"==o){var c=$(t.target).find(":input"),d=$(t.target).closest("kbd").find("span"),u=apisvr.a$.trim($(t.target).attr("f")),g=apisvr.a$.trim(c.length>0?c.val():$(t.target).text()),h=!1;if(""==u)g.length>0&&g!=apisvr.a$.trim(d.text())&&(d.html(g),h=!0);else{if(d.attr("f")!=u){var m=$(t.target).closest("kbd").parent().find(".fdata>span[f='"+u+"']"),w=apisvr.a$.trim(d.text());"b"!=u&&m.attr("f",d.attr("f")).html(""==w?"&nbsp;":w),h=!0}"b"==u?d.html("&nbsp;"):d.html(""==g?"&nbsp;":g),d.attr("f",u)}if(h){var _=!1;n.fileinfo?(_=1==n.fileinfo.issave,2!=n.fileinfo.issave&&b(_),_&&(n.fileinfo=$.extend({},n.fileinfo),n.fileinfo.issave=2)):n.stepHis.remLOG=1,srclocked(!0),setTimeout(function(){D(f($(t.target).closest(".log-ctrl").find("kbd>span"))),_&&v(),srclocked(!1)},10)}}});var o,i,s=function(e,t){return 0!=apisvr.a$.trim(e).length&&(t.i=e,!0)},l=function(e,t){return t.n=e,!0},r=function(e,t,n){if(e.length<10)return!1;var o=dayjs(e,n);return t.t=o.$d,o.isValid()},a=function(e,t){return!0},c="<a class='close' onclick='javascript:$(this).closest(&quot;.popover&quot;).popover(&quot;hide&quot;).data(&quot;bs.popover&quot;).element.showBack = false;'>&times;</a>",f=function(t,o){t||(t=e.find("#step-2  .log-ctrl kbd>span")),o&&function(t,n){var o,i=$(t[0]),s=($(t[t.length-1]),e.find(".fdata.menuitems"));i.text(n.conf.s),n.conf.f.forEach(function(e,n){(o=$(t[n+1])).attr("f",e),"b"==e?o.html("&nbsp;"):o.html(s.find('a[f="'+e+'"]').text())})}(t,o);for(var i=[],c=$(t[0]),f=apisvr.a$.trim($(t[t.length-1]).text()),d=[],u=apisvr.a$.trim(c.text()),p=1;p<t.length-1;p++)switch($(t[p]).attr("f")){case"i":d.push(s);break;case"n":d.push(l);break;case"t":d.push(r);break;default:d.push(a)}"tab"==u&&(u=/\t/),$.each(n.showinvisibles.val().split(/\r?\n/),function(e,t){var n=t.split(u);if(n.length>1)for(var o=!0,s={},l=0;l<n.length;l++)if(l<d.length&&!d[l](n[l],s,f)){o=!1;break}o&&s.hasOwnProperty("i")&&s.hasOwnProperty("t")&&i.push(s)}),e.find("span.logok").html(i.length);var g=e.find(".log-sample kbd.frst"),v=new Date,h=new Date;i.length>0?(v=i[0].t,h=i[0].t,i[0].hasOwnProperty("i")&&(g[0].innerHTML=i[0].i),g[1].innerHTML=i[0].hasOwnProperty("n")&&""!=i[0].n?i[0].n:"&nbsp;",i[0].hasOwnProperty("t")&&(g[2].innerHTML=dayjs(i[0].t).format(f))):g.html("&nbsp;");var m=i.reduce(function(e,t){return e[t.i]=e[t.i]||[],e[t.i].push(t),v>t.t&&(v=t.t),h<t.t&&(h=t.t),e},{}),w=[];return $.each(m,function(e,t){var n=t[0],o=t.sort(function(e,t){return e.t-t.t});w.push({acno:e,ten:n.n,logs:t.length,aLogs:$.map(o,function(e,t){return e.t}),minL:dayjs(o[0].t).format(f),maxL:dayjs(o[o.length-1].t).format(f)})}),e.find("span.totalemps").html(w.length),n.allLOGs=[[w,v,h],null,{f:$.map(t,function(e,t){return $(e).attr("f")}),l:i.length,e:w.length,s:apisvr.a$.trim(c.text()),tf:f,p:"",p0:"",p1:"",p2:"",p3:"",p4:"",p5:"",p6:"",p7:"",p8:"",p9:""}],n.stepHis.isTiCo=!0,n.allLOGs[0]},d=function(e){return"verifyLOG"==e?f:"LAN"==e?(o||(o=t("lan")),o):"cTIP"==e?c:"uiDEV"==e?D:"hisLOG"==e?y:"logFROMDB"==e?g:"resetUPLOAD"==e?A:"cleanHIS"==e?T:"logCONF"==e?u:"delHISLOG"==e?O:"dogIFRM"==e?H.dogIFRM:"saveDUPHIS"==e?(b(2==n.fileinfo),[H,H.lstORfrm]):void 0},u=function(){var e=n.allLOGs[2];return e.minL=n.allLOGs[0][1],e.maxL=n.allLOGs[0][2],e},p=function(){n.selEMP_popover&&n.selEMP_popover.popover("hide"),n.log_fromto_popover&&n.log_fromto_popover.popover("hide"),n.saveLOCKED_popover&&n.saveLOCKED_popover.popover("hide")},g=function(o,s){H.parent().find(".logFROMDB").off("click").on("click",function(o){helloguy.css("display",""),p(),L(function(){i||(i=new FormWizard.s2log.init(e,t,n,d)),i.lstHis(H.parent())})}).css("display",!o||(!(o[2]>=1)||n.fileinfo)&&o[2]+s<=1?"none":"")},v=function(){n.puSAVELOG||(n.puSAVELOG=e.find(".saveAttlog"),n.puSAVELOG.on("click",function(s){srclocked(!0),p();var l=$(this);admin$.DEV(function(){L(function(){i||(i=new FormWizard.s2log.init(e,t,n,d)),i.saveUplog(l,function(e){var t="function"==typeof x;1==e&&(t||toastMsg(o.js_003_ok,"success"),w(["","none"]),E(3)),t&&x(e)})})})}),n.puSAVELOG.next().on("click",function(e){h(e,{hide:function(e,t){1===t&&(n.puSAVELOG.parent().css("display","none"),m(""))},done:function(e){var t=n.logDAT[n.fileinfo.id];n.fileinfo=$.extend({},t[0]),b(2==t[0].issave),n.showinvisibles.val(t[1].dat),D(f(null,n.fileinfo))}})}),n.saveLOCKED_popover=n.puSAVELOG.parent(),n.saveLOCKED_popover.popover({offset:"100%,10",container:e.find("#step-2"),placement:"bottom",trigger:"manual",html:!0,title:"<i class='ti-alert'/> "+o.js_004_14[2]+c,content:o.js_004_14[3]}));var s=!1;n.puSAVELOG.next().css("display",2==n.fileinfo.issave?"":"none"),0==n.fileinfo.issave?w(["none",""]):2==n.fileinfo.issave&&(m("none"),s=!0),n.saveLOCKED_popover.fadeIn("fast",function(){s&&n.saveLOCKED_popover.popover("show")})},h=function(e,t,n){p();var i,s=null,l=admin$.popup({a:"d",t:o.js_004_16[n[0]],m:o.js_004_16[n[1]]}),r=l.find("#popupdone");return r.html(o.js_004_3),r.removeClass("btn-secondary").addClass("btn-danger"),r.click(function(e){s=1,l.modal("hide"),t.done&&"function"==typeof t.done&&t.done(e,s)}),r[((i=!0)?"add":"remove")+"Class"]("btn-primary").prop("disabled",!i),l.modal("show"),srclocked(!1),l.one("hide.bs.modal",function(e){t.hide&&"function"==typeof t.hide&&t.hide(e,s)}),l},m=function(t){H.rmvHisAttlog||(H.rmvHisAttlog=e.find(".rmvHisAttlog"),H.rmvHisAttlog.on("click",function(e){h(e,{hide:function(e,t){1==t&&H.rmvHisAttlog.fadeOut("fast")},done:function(e){var t=$.Deferred(),o={};o[n.fileinfo.id]=!1,$.when(t).then(function(e){T(e,!0),srclocked(!1)}),y(t,n.dbTBname,{id:-1},o)}},[0,3])})),H.lstORfrm&&(t="none"),H.rmvHisAttlog.css("display",t)},w=function(t){if(!H.delHisAttlog){var o=e.find(".delHisAttlog"),i=o.clone();i.removeClass("delHisAttlog btn-outline-danger").addClass("btn-warning").css({display:"none",padding:"5px 6px 2px"}).html("<i class='ti-close'></i>"),o.parent().append(i),H.delHisAttlog=[o,i],o.on("click",function(e){h(e,{hide:function(e,t){1===t&&(srclocked(!0),o.fadeOut("fast"),b(!1),n.saveLOCKED_popover&&n.saveLOCKED_popover.css("display","none"))},done:function(e,t){var o=function(){var e=H.dogIFRM.contentWindow.chanelLog[1].log;e[1]=void 0,T(e,!0),srclocked(!1)};O(function(e){var t=H.find(".hislog-list tbody"),i=n.fileinfo.id;if(t.length>0)t.find("tr[idx='"+i+"'] .bntrmv").trigger("click",[-1*parseInt(i)]);else if(e&&"function"==typeof e){var s=$.Deferred();$.when(s).then(function(e){o()}),e(-1*i,s)}else o()},n.fileinfo.id,n.fileinfo.tc3id)}},[0,2])}),i.on("click",function(e){h(e,{hide:function(e,t){1==t&&i.fadeOut("fast")},done:function(e,t){H.currHISID?(srclocked(!0),setTimeout(function(){var e,t;H.lstORfrm?(e=n.logDAT[H.currHISID.id],t=[H.lstORfrm[0],e[1],H.lstORfrm[2]]):t=[[(e=n.logDAT[H.currHISID.id])[0]],e[1]];var o=A(t,!1,void 0,!1);D(o),n.rst_attlog?n.ReadyEMP=function(e){n.ReadyEMP=null,srclocked(!1)}:srclocked(!1),H.currHISID=null})):(T(null,!1),E(3))}},[0,1])})}m(t[0]),H.delHisAttlog[0].css("display",t[0]),H.delHisAttlog[1].css("display",t[1]),H.delHisAttlog[0].parent().css("display",""==t[0]||""==t[1]?"":"none")},_=function(e,t){e[1].log[2]--;for(var n=e[1].log[0].length-1;n>-1;n--)e[1].log[0][n].id==-1*t&&e[1].log[0].splice(n,1);g(e[1].log,0)},k=!1,b=function(t){k=t,e.find(".selAttlog").css("display",t?"none":""),e.find(".logFROMDB").prop("disabled",t)},y=function(e,o,i,s){if("noU"==n.hasUA)lo$DB(function(t){if(0==t.kq)t.cb("cancel"),e.resolve();else if(1==t.kq){var n,l,r=[],a=0,c=t.rst.transaction(o,s?"readwrite":"readonly"),f=c.objectStore(o[0]);c.oncomplete=function(){t.rst.close(),e.resolve([r,n,a])},f.openCursor().onsuccess=function(e){var t=e.target.result;t?(a+=1,s&&void 0!==s[t.value.id]&&(t.value.issel=s[t.value.id],t.update(t.value)),i&&!function(e){for(var t in i)if(i.hasOwnProperty(t)&&e[t]!=i[t])return"id"==t&&(l=parseInt(i[t])),!1;return!0}(t.value)||r.push(t.value),t.continue()):o.length>1&&r.length>0&&(l=l||r[r.length-1].id,c.objectStore(o[1]).index("LogIndex").get(l).onsuccess=function(e){n=e.target.result})}}});else{var l=$.Deferred(),r=$.Deferred(),a=function(e){var l=H.dogIFRM.contentWindow,a=l.chanelLog,c=function(e){var t=$.grep(a[1].log[0],function(t,n){return"LOG_IN_LST"==o[0]?o[1].indexOf(t.id)>-1:t.id==e.logid});f&&_(a,f),r.resolve([t,e,a[1].log[2]])},f=function(){if(s)for(var e in s)if(s.hasOwnProperty(e)&&parseInt(e)<0)return e;return null}();e&&e(a[1].log[0]),!f&&i&&n.logDAT[i.id]?c(n.logDAT[i.id][1]):-1!=i.id?(t("___").comm1.loghole(l,a[1],"6c6f67717279",{logh:btoa(JSON.stringify([i,s])),logkind:1}),l.cbHwnd=function(e){l.cbHwnd=null,c(e)}):r.resolve([[],void 0,a[1].log[2]])};$.when(l,r).then(function(t,n){e.resolve(n,t)}),s?(t("___").comm1.uaShift(s,"SEL_HIS_LOG",!1).then(function(e){l.resolve(e)}),a(function(e){for(var t=0;t<e.length;t++)s.hasOwnProperty(e[t].id)&&(e[t].issel=s[e[t].id])})):(a(),l.resolve())}},O=function(e,t,o){"noU"==n.hasUA?lo$DB(function(i){var s=i.rst.transaction(n.dbTBname,"readwrite"),l=s.objectStore(n.dbTBname[0]),r=s.objectStore(n.dbTBname[1]);s.oncomplete=function(){i.rst.close();var n=H.dogIFRM.contentWindow.chanelLog;_(n,-1*parseInt(t)),e()},l.delete(t),r.delete(o)}):e(function(e,t){var o={};o[e]=!0,y(t,n.dbTBname,{issel:!0},o)})},L=function(e){_gsC(srcpf$+"/media/js/tikestep_s2.js?"+(new Date).getTime(),"js",function(){e()},"tikestep_s2.js")},D=function(e){n.rst_attlog&&n.rst_attlog.option({dataSource:e[0],paging:{pageIndex:0}}),n.log_fromto_popover&&(n.log_from.option("value",e[1]),n.log_to.option("value",e[2]))},x=-1,H=e.find(".uploadattlog"),A=function(e,t,o,i){H.find(".hislog-list").remove();var s=S(e);if(C(e,t,function(){s||(n.fileinfo?H.dogIFRM.contentWindow.showUpLog(n.fileinfo.file,w):H.dogIFRM.contentWindow.dropzone.removeAllFiles())}),i&&E(3),n.puSAVELOG&&n.puSAVELOG.parent().css("display","none"),!o)return f(null,n.fileinfo)},I=function(e){var i,s=$('<table style="display:none" class="table hislog-list table-fixed"><thead></thead><tbody style="height: 125px;"></tbody></table>'),l=s.find("thead"),r=null,a=null,c=function(e,t){-1==unlockedHWND&&srclocked(!0),e=parseInt(e);var o=function(e,t){var o=f(null,t),i=$.Deferred(),s=$.Deferred();$.when(i,s).then(function(e,t){srclocked(!1)}),a&&"function"==typeof a?a(e,s):s.resolve("fnCB NULL"),n.rst_attlog?(n.rst_attlog.clearFilter(),n.ReadyEMP=function(e){i.resolve("UI")},D(o)):i.resolve("UI")};if(n.logDAT[e])C([[n.logDAT[e][0]],n.logDAT[e][1]],!1,function(){o("CACHE",n.logDAT[e][0])});else{var i=$.Deferred();$.when(i).then(function(e){C(e,!1,function(){o("DB",e[0][0])})}),y(i,n.dbTBname,{id:e},t)}},d=function(e,t,o,s){if("th"==e.target.tagName.toLowerCase()){-1==unlockedHWND&&srclocked(!0),o&&(o.off("hide.bs.modal"),o.modal("hide"));var l={};i.find("tr:not(.row-sum)").each(function(e,t){l[parseInt(t.getAttribute("idx"))]=!1});var r=$.Deferred();$.when(r).then(function(e){T(e,!1),s&&"function"==typeof s&&s(),srclocked(!1)}),y(r,n.dbTBname,{id:-1,issel:!0},l)}else t.animate({height:10},200,function(e){t.remove(),s&&"function"==typeof s&&s(),o&&o.modal("hide")})};l.html("<tr style='font-size:11px'><th class='col-1 center ti-eraser bntrmv'></th><th class='col-5'>File Name</th><th class='col-2 center'>Size (KB)</th><th class='col-2 center'>Log The</th><th class='col-2 center'>Nhan Vien</th></tr>");for(var u=0,p=0,g=0,v=e[0].length-1;v>-1;v--){var h=Math.floor(e[0][v].file.size/1e3),m=!1;u+=e[0][v].conf.l,p+=e[0][v].conf.e,g+=h,e[1]?m=e[1].logid==e[0][v].id:v==e[0].length-1&&(m=!0),i+="<tr idx='"+e[0][v].id+"' "+(m?"class='selected'":"")+"><td class='col-1 ti-close bntrmv center'></td><td class='col-5'>"+e[0][v].file.name+"</td><td class='col-2 text-right'>"+h+"</td><td class='col-2 text-right'>"+e[0][v].conf.l+"</td><td class='col-2 text-right'>"+e[0][v].conf.e+"</td></tr>"}i+="<tr class='row-sum'><td class='col-6 text-right'>Tong cong</td><td class='col-2 text-right'>"+g+"</td><td class='col-2 text-right'>"+u+"</td><td class='col-2 text-right'>"+p+"</td></tr>",s.on("click",".bntrmv",function(e,i){if(e.stopPropagation(),e.preventDefault(),k)n.saveLOCKED_popover.popover("show");else{-1==unlockedHWND&&srclocked(!0);var s=e,l=$(this).parent();i?d(e,l,null,function(){r.resolve(i)}):setTimeout(function(){!function(e,n){o||(o=t("lan"));var i,s="th"==e.target.tagName.toLowerCase(),l=null,a=admin$.popup({a:"d",t:o.js_004_16[0],m:o.js_004_16[s?4:3]}),c=a.find("#popupdone");c.html(o.js_004_3),c.removeClass("btn-secondary").addClass("btn-danger"),c.click(function(){l=n.attr("idx"),d(e,n,a)}),c[((i=!0)?"add":"remove")+"Class"]("btn-primary").prop("disabled",!i),a.modal("show"),srclocked(!1),a.one("hide.bs.modal",function(e){r&&(srclocked(!0),r.resolve(l))})}(s,l)},20)}}),(i=s.find("tbody").html(i)).on("click","tr:not(.row-sum)",function(e){if(k)n.saveLOCKED_popover.popover("show");else{var t,o,l,f=$(this),d=$(e.target).hasClass("bntrmv");d&&(r=new $.Deferred,$.when(r).then(function(e){if(r=null,e){var d,u={},p=function(o){if("-1"!=e){var i=$.Deferred();parseInt(parseInt(t)),$.when(i).then(function(e){d&&d.contentWindow.showUpLog(n.fileinfo.file,w),o?o.resolve("srclocked(false)"):srclocked(!1)}),y(i,n.dbTBname,{id:"noU"==n.hasUA?-1:parseInt(l.attr("idx")),issel:!0},u)}};if(u[parseInt(e)]=!1,t!=l.attr("idx")?(a=function(e,t){a=null,"CACHE"==e?p(t):(d&&d.contentWindow.showUpLog(n.fileinfo.file,w),t.resolve("fnCB_DB"))},c(l.attr("idx"),u)):p(),(d=i.find("tr:not(.row-sum)").length)<=1){H.lstORfrm=null;var g=H.dogIFRM;d=g,s.fadeOut("fast",function(){s.remove(),$(g).css({display:"none",opacity:"1"}).fadeIn()})}else d=null,l.addClass("selected")}else o&&o.attr("idx")==f.attr("idx")?srclocked(!1):c(f.attr("idx"))})),o=function(e,t){var n=i.find("tr.selected"),o=t.getAttribute("idx");return 0!=n.length&&n.attr("idx")==o||(i.find("tr").removeClass("selected"),$(t).addClass("selected"),r||(-1==unlockedHWND&&srclocked(!0),setTimeout(function(){c(o)},20))),0==n.length?null:n}(0,this),d&&(t=o?o.attr("idx"):0,0==(l=f.next("tr:not(.row-sum)")).length&&(l=$(this).prev("tr")))}}),H.append(s),s.fadeIn()},S=function(e){var t=e&&e[0].length>1,n=H.find(".hislog-list"),o=H.find("iframe");return t?(I(e),H.lstORfrm=e,o.length>0&&o.fadeOut("fast",function(){o.css({display:"",opacity:"0"})})):(H.lstORfrm=null,n.length>0&&n.fadeOut("fast",function(){n.remove()}),o.length>0&&o.css({display:"none",opacity:"1"}).fadeIn()),t},C=function(e,t,o){var i="none";if(e&&e[1]){var s;n.showinvisibles.val(e[1].dat);for(var l=e[0].length-1;l>-1;l--)e[0][l].id==e[1].logid&&(s=e[0][l]);s.tc3id=e[1].id,n.logDAT[s.id]||(n.logDAT[s.id]=[s,e[1]]),n.fileinfo=s,i=""}w([i,"none"]),o&&"function"==typeof o&&o(),t&&g(e,0)},T=function(e,t){delete n.fileinfo,n.showinvisibles.val("");var o=A(e,t,void 0,!1);D(o)},E=function(e,t){var o="cmVtX2F0dGxvZw==",i="noU"==n.hasUA?1:2,s=function(t){lo$DB(function(o){if(0==o.kq){var s=o.e.target.result;s.objectStoreNames.contains("remLOG")&&s.deleteObjectStore("remLOG"),s.createObjectStore("remLOG",{keyPath:"id"})}else if(1==o.kq){var l,r=o.rst.transaction(["remLOG"],0==e?"readonly":"readwrite").objectStore("remLOG");1==e?l=r.get(i):2==e&&(l=r.put({id:i,conf:u(),log:n.showinvisibles.val()})),l.onsuccess=function(n){2==e?t(n.target.result):t&&t.resolve(n.target.result)}}},"hellohrm_remlog")};if(0==e)return(l=st("getItem",o))&&l.split(i).length>1;if(1==e)s(t);else if(2==e)1==n.stepHis.remLOG&&((l=st("getItem",o))?-1==(l=JSON.parse(l)).indexOf(i)&&l.push(i):l=[i],s(function(){st("setItem",o,JSON.stringify(l)),n.stepHis.remLOG=2}));else if(3==e){var l;2==n.stepHis.remLOG&&(l=st("getItem",o))&&(l=JSON.parse(l),l=$.grep(l,function(e){return e!=i}),st((l.length>0?"set":"remove")+"Item",o,JSON.stringify(l))),n.stepHis.remLOG=0}};this.doStep=function(s,l,r,a){if(p(),"2"==l.fromStep.toString()&&(n.selEMP_popover&&n.selEMP_popover.popover("hide"),n.log_fromto_popover&&n.log_fromto_popover.popover("hide")),"2"==l.toStep.toString()){if(n[a[0]]?n[a[0]].showBack&&n[a[0]].popover("show"):(n[a[0]]=e.find(".testupload .needuptclick"),n[a[0]],n[a[0]].parent().on("click",function(){srclocked(!0),p(),admin$.DEV(function(){L(function(){i||(i=new FormWizard.s2log.init(e,t,n,d)),n.ReadyEMP=function(e){n.ReadyEMP=null,n.showlistLOG=1,srclocked(!1)},i.grid_attlog()}),srclocked(!1)})})),!n[a[1]]){var c=$.Deferred(),u=$.Deferred(),h=$.Deferred(),m=$.Deferred(),_={issel:!0};if(E(0)){_.id=-1,delete _.issel;var k=$.Deferred();$.when(k).then(function(e){n.showinvisibles.val(e.log),f(null,{conf:e.conf}),m.resolve(),n.stepHis.remLOG=2}),E(1,k)}else m.resolve();"noU"==n.hasUA?($.when(c).then(function(e){var t=S(e);C(e,!0,function(){h.resolve([t,e])})}),$.when(u,h,m).then(function(e,t){var o=t[0],i=t[1];!o&&n.fileinfo&&e[0].contentWindow.showUpLog(n.fileinfo.file,w),i&&f(null,n.fileinfo),e[0].contentWindow.chanelLog=[,{log:i||[[],void 0,0]}],e[1]()}),y(c,n.dbTBname,_)):$.when(u).then(function(e){var o=t("alog");if(o.key){var i=[$.grep(o.log[0],function(e,t){return e.issel===_.issel}),null,o.log[2]],s=S(i),l=e[0].contentWindow;i[0].length>0?(l.cbHwnd=function(t){l.cbHwnd=null,i[1]=t,C(i,!0,function(){!s&&n.fileinfo&&e[0].contentWindow.showUpLog(n.fileinfo.file,w),f(null,n.fileinfo),e[1]()})},t("___").comm1.loghole(l,o,"4c4f475f4c4f4144",{logh:btoa(JSON.stringify(["L",i[0][i[0].length-1].id])),logkind:1})):(l.chanelLog=[,o],g(o,0),e[1]())}else S([[],null,0]),e[1]()}),function(s){var l,r,a=n.s2_session,c="/"!=apisvr.a$.mainHolePath?(l=window.location.protocol+"//"+apisvr.a$.mainHolePath,(r=document.createElement("a")).href=l,r.pathname):"";if(0==H.find("iframe").length){var u,p=helloguy.clone();p.css({display:"",position:"absolute",height:"200px"}).removeAttr("id"),H.append(p),apisvr.a$.sessions[a]={hwndTO:null,id:a,fn:function(o,l,r){if("postmsg"==o){var a=H.find("#ifrm_"+l)[0].contentWindow;a.focus(),a.postMessage({msgtype:"session",msgkind:l,evtData:{a$:"olshift"}},"*")}else"job"==o&&("loaded"==l.evtData.evt?(clearTimeout(void 0),this.origin=l.evtData.origin,s.resolve([u,function(){p.remove()}])):"attlog"==l.evtData.evt?(n.fileinfo?H.currHISID=$.extend({},n.fileinfo):H.currHISID=null,n.showinvisibles.val(l.evtData.dat),n.fileinfo={file:l.evtData.file,issave:0,issel:!0,uptime:new Date},u.style.opacity=1,H.find(".table.hislog-list").remove(),Main.isMobile()?i&&1==n.showlistLOG?i.upload_attlog():(f(),v(),srclocked(!1)):L(function(){i||(i=new FormWizard.s2log.init(e,t,n,d)),i.upload_attlog()}),n.trapHwnd=v):"function"==typeof this[l.evtData.evt]&&this[l.evtData.evt](o,l,r))}},H.find("iframe").remove(),(u=document.createElement("iframe")).style.opacity=1,u.style.display="none",u.style.width="100%",u.style.height="300px",u.setAttribute("scrolling","no"),u.setAttribute("frameBorder","0"),u.src=c+"/chamcong/iframeattlog."+t("___").comm1.uplog+"#"+window[st0("1")](a+"|"+apisvr.a$.mainHolePath+"|"+window.location.origin+"|"+GetIEVersion()+"|"+$("#app").hasClass("darkcolor")),u.onload=function(){o=t("lan"),u.contentWindow.lan(o.js_004_12),H.dogIFRM=u},H[0].appendChild(u)}}(u),n[a[1]]=e.find("."+a[1]),n[a[1]].off("change").on("change",function(e){var t=!1;n.fileinfo?(t=1==n.fileinfo.issave,2!=n.fileinfo.issave&&b(t),t&&(n.fileinfo=$.extend({},n.fileinfo),n.fileinfo.issave=2)):n.stepHis.remLOG=1,-1==unlockedHWND&&srclocked(!0),setTimeout(function(){D(f()),t&&v(),"function"==typeof x?x():srclocked(!1)},20)}),e.find(".dropzonecmd").on("click",".selAttlog",function(e){p();var t=H.dogIFRM;t&&t.contentWindow.clickE()}),e.find(".attlog_verify").off("mousedown touchstart").on("mousedown touchstart",function(t){n.lockstep(s,!0),-1==unlockedHWND&&srclocked(!0),x=function(){x=-1};var o=function(t){n.lockstep(s,!1),1==t&&e.find(".attlog_verify").trigger("click"),srclocked(!1)};x=function(e){x=-1,o(e)},n.fileinfo&&1!=n.fileinfo.issave?setTimeout(function(){n.puSAVELOG.trigger("click",[])},50):o()})}}else if("3"==l.toStep.toString()){if("0"==r)return void function(){if(n.step3_rst_grid_cmd){var e={visible:n.stepHis.isTiCo,"items[0].template":$("<div/>").html("<i class='ti-alert'/> Ket qua cu hon Log gat the o #step-2")};n.step3_rst_grid_cmd.option(e)}}();n.lockstep(s,!0),_gsC(srcpf$+"/media/js/tikestep_s3.js?"+(new Date).getTime(),"js",function(){if(n.allLOGs||f(),n.stepHis.isTiCo){var t=function(){n.selEMP_popover&&"mixed"==n.selEMP_popover.attr("aria-checked")?n.allLOGs[1]=n.rst_attlog.getSelectedRowKeys():n.allLOGs[1]=null,n.s3calc.exec(n,e,function(){E(2),n.lockstep(s,!1),n.stepHis.isTiCo=!1,x=1})};n.s3calc?(-1!=unlockedHWND&&srclocked(!1),t()):(n.s3calc=FormWizard.s3calc.createCalc({kind:"noshift",opts:{}}),t())}else n.lockstep(s,!1)},"tikestep_s3.js")}}}}();
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).dayjs=e()}(this,(function(){"use strict";var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",u="hour",a="day",o="week",f="month",h="quarter",c="year",d="date",$="Invalid Date",l=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},m=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},g={s:m,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+m(r,2,"0")+":"+m(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,f),s=n-i<0,u=e.clone().add(r+(s?-1:1),f);return+(-(r+(n-i)/(s?i-u:u-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:f,y:c,w:o,d:a,D:d,h:u,m:s,s:i,ms:r,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},D="en",v={};v[D]=M;var p=function(t){return t instanceof _},S=function(t,e,n){var r;if(!t)return D;if("string"==typeof t)v[t]&&(r=t),e&&(v[t]=e,r=t);else{var i=t.name;v[i]=t,r=i}return!n&&r&&(D=r),r||!n&&D},w=function(t,e){if(p(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new _(n)},O=g;O.l=S,O.i=p,O.w=function(t,e){return w(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var _=function(){function M(t){this.$L=S(t.locale,null,!0),this.parse(t)}var m=M.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(O.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(l);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return O},m.isValid=function(){return!(this.$d.toString()===$)},m.isSame=function(t,e){var n=w(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return w(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<w(t)},m.$g=function(t,e,n){return O.u(t)?this[e]:this.set(n,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var n=this,r=!!O.u(e)||e,h=O.p(t),$=function(t,e){var i=O.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},l=function(t,e){return O.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},y=this.$W,M=this.$M,m=this.$D,g="set"+(this.$u?"UTC":"");switch(h){case c:return r?$(1,0):$(31,11);case f:return r?$(1,M):$(0,M+1);case o:var D=this.$locale().weekStart||0,v=(y<D?y+7:y)-D;return $(r?m-v:m+(6-v),M);case a:case d:return l(g+"Hours",0);case u:return l(g+"Minutes",1);case s:return l(g+"Seconds",2);case i:return l(g+"Milliseconds",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var n,o=O.p(t),h="set"+(this.$u?"UTC":""),$=(n={},n[a]=h+"Date",n[d]=h+"Date",n[f]=h+"Month",n[c]=h+"FullYear",n[u]=h+"Hours",n[s]=h+"Minutes",n[i]=h+"Seconds",n[r]=h+"Milliseconds",n)[o],l=o===a?this.$D+(e-this.$W):e;if(o===f||o===c){var y=this.clone().set(d,1);y.$d[$](l),y.init(),this.$d=y.set(d,Math.min(this.$D,y.daysInMonth())).$d}else $&&this.$d[$](l);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[O.p(t)]()},m.add=function(r,h){var d,$=this;r=Number(r);var l=O.p(h),y=function(t){var e=w($);return O.w(e.date(e.date()+Math.round(t*r)),$)};if(l===f)return this.set(f,this.$M+r);if(l===c)return this.set(c,this.$y+r);if(l===a)return y(1);if(l===o)return y(7);var M=(d={},d[s]=e,d[u]=n,d[i]=t,d)[l]||1,m=this.$d.getTime()+r*M;return O.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this;if(!this.isValid())return $;var n=t||"YYYY-MM-DDTHH:mm:ssZ",r=O.z(this),i=this.$locale(),s=this.$H,u=this.$m,a=this.$M,o=i.weekdays,f=i.months,h=function(t,r,i,s){return t&&(t[r]||t(e,n))||i[r].substr(0,s)},c=function(t){return O.s(s%12||12,t,"0")},d=i.meridiem||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r},l={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:O.s(a+1,2,"0"),MMM:h(i.monthsShort,a,f,3),MMMM:h(f,a),D:this.$D,DD:O.s(this.$D,2,"0"),d:String(this.$W),dd:h(i.weekdaysMin,this.$W,o,2),ddd:h(i.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(s),HH:O.s(s,2,"0"),h:c(1),hh:c(2),a:d(s,u,!0),A:d(s,u,!1),m:String(u),mm:O.s(u,2,"0"),s:String(this.$s),ss:O.s(this.$s,2,"0"),SSS:O.s(this.$ms,3,"0"),Z:r};return n.replace(y,(function(t,e){return e||l[t]||r.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(r,d,$){var l,y=O.p(d),M=w(r),m=(M.utcOffset()-this.utcOffset())*e,g=this-M,D=O.m(this,M);return D=(l={},l[c]=D/12,l[f]=D,l[h]=D/3,l[o]=(g-m)/6048e5,l[a]=(g-m)/864e5,l[u]=g/n,l[s]=g/e,l[i]=g/t,l)[y]||g,$?D:O.a(D)},m.daysInMonth=function(){return this.endOf(f).$D},m.$locale=function(){return v[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=S(t,e,!0);return r&&(n.$L=r),n},m.clone=function(){return O.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},M}(),b=_.prototype;return w.prototype=b,[["$ms",r],["$s",i],["$m",s],["$H",u],["$W",a],["$M",f],["$y",c],["$D",d]].forEach((function(t){b[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),w.extend=function(t,e){return t.$i||(t(e,_,w),t.$i=!0),w},w.locale=S,w.isDayjs=p,w.unix=function(t){return w(1e3*t)},w.en=v[D],w.Ls=v,w.p={},w}));