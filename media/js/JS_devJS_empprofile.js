tabglobalJS.JS_devJS_empprofile=function(){function e(e){var t,n,o,a={bNEW_dis:!0,bUPT_dis:!0,bDEL_dis:!0},i=null,d=!1,s=e.db,r=e.jdat,l=e.$list;this.init=function(e,c,u){var p,f=r.positions,m=r.states,y=app_container.innerWidth(),g=0,h=-1,v=function(){h=-1,console.log("frmLOADED")},x=function(t){x=null,l.option("focusedRowIndex",0),e.find(".cssprofile").removeClass("initloading"),c&&c()},b=function(){R(!0);var e={};n._bkDS=n.option("formData"),$.each(n._bkDS,function(t,n){e[t]=""}),e.birthday=new Date("2000/1/1"),e.hireday=new Date,e.pid=1,n.option("formData",e);n.validate();i=E,srclocked(!1),d=!0},w=function(){srclocked(!0),t.hide(),a.drawer_toggle.option("disabled",!0),n._bkDS=$.extend({},n.option("formData"));n.validate();d=!0,e.find(".cssprofile").addClass("editmode"),i=T,C(!1),srclocked(!1)};function D(){l._lastestERR&&$.each(l._lastestERR.dataerr,function(e,t){var o=n.getEditor(t.F).element().dxValidator("instance");if(o){var a=o._validationRules[0];a.message="Trung ma",a.isValid=!1,o.validate(),a.isValid=!0,n._hasERR=!0}}),l._lastestERR=null,k("Da co loi","error"),srclocked(!1)}function C(e){$.each(n._itemsRunTimeInfo.getItems(),function(t,n){n.widgetInstance&&n.widgetInstance.option("readOnly",e)})}function R(n){n&&t.hide(),e.find(".cssprofile")[(n?"add":"remove")+"Class"]("editmode"),a.drawer_toggle.option("disabled",n),C(!n)}function k(e,t){DevExpress.ui.notify({message:e,type:t,displayTime:600,maxWidth:"300px"})}function _(e){if(d){var t=e.value;if(t)try{t=is$Date(DevExpress.localization.formatDate(e.value,"yyyy-MM-dd").split("-"))}catch(e){t=!1}if(!1===t){var n=e.previousValue;n&&is$Date(n)||(n=new Date),e.component.option("value",n)}}}function O(e){var t=l.option("focusedRowIndex"),n=l.pageSize(),o=l.pageIndex(),a=l.totalCount(),i=function(e){l.isPreventFocusedRowChanged=!0,x=function(t){x=null,l.isPreventFocusedRowChanged=!1,l.option("focusedRowIndex",e)}};1==e?t==n-1&&o<l.pageCount()-1?(i(0),l.pageIndex(o+1)):n*o+t<a-1&&l.option("focusedRowIndex",t+1):0==t&&o>0?(i(n-1),l.pageIndex(o-1)):t>0&&l.option("focusedRowIndex",t-1)}function F(e){var t=DevExpress.ui.dialog.confirm("Are you sure you want to remove e.data.Email?","Delete row");e.cancel=$.Deferred(function(e){t.done(function(t){t&&(srclocked(!0),x=function(e){L(e),k("Delete OK","success"),srclocked(!1)}),e.resolve(!t)})}).promise(),srclocked(!1)}function T(){if(n.validate().isValid){var e=l.option("focusedRowKey");if(e){var t={};t[l.getDataSource().key()]=e;var o=$.extend({},n.option("formData")),a=l.getDataSource();a.store().update(t,o).then(function(t){var n=$.grep(a.items(),function(t,n){return t.id==e});x=function(e){x=null,R(!1),k("Save OK","success"),srclocked(!1)},$.extend(n[0],o),d=!1,l.repaintRows([l.getRowIndexByKey(e)])},function(){D()})}}else k("Da co loi truoc khi save Da co loi truoc khi save Da co loi truoc khi save ","error"),srclocked(!1)}function E(){if(srclocked(!0),n.validate().isValid){var e=$.extend({},n.option("formData"));e.hireday=DevExpress.localization.formatDate(e.hireday,"yyyy-MM-dd"),e.birthday=DevExpress.localization.formatDate(e.birthday,"yyyy-MM-dd");var t=l.getDataSource();t.store().insert(e).then(function(e){var n=l._controllers.data._dataSource._cachedStoreData;n&&(n.push(e),p=function(e,t){p=null,t.iniDAT=n}),l.isPreventFocusedRowChanged=!0,d=!1,t.reload(),x=function(t){x=null,l._controllers.focus._navigateToRow(e.id,!0).done(function(e,t,n){l.isPreventFocusedRowChanged=!1,l.peddingFocusedRowChangedArg&&(z(l.peddingFocusedRowChangedArg),l.peddingFocusedRowChangedArg=null),R(!1),k("Save OK","success"),srclocked(!1)})}},function(){D()})}else k("Da co loi truoc khi save Da co loi truoc khi save Da co loi truoc khi save ","error"),srclocked(!1)}e.find(".pagination.modal-5").on("click","a",function(e){$(this).hasClass("next")?O(1):$(this).hasClass("prev")&&O(-1)}),o=c("dbEngine"),DevExpress.data.AspNet||"function"!=typeof window.aspnetdata||aspnetdata(o);var S="/api/empprofile";s=DevExpress.data.AspNet.createStore($.extend({key:"id",loadUrl:S,insertUrl:S,updateUrl:S,deleteUrl:S,onBeforeSend:function(e,t){clearTimeout(h),-1==h&&(h=0,console.log("start bussy")),p&&"function"==typeof p&&p(e,t)},onAjaxError:function(e){l._lastestERR=$.extend({},e),e="con khi ne !!!!"},tabId:u},s)),myUI=new DevExpress.myUI;var P,I={state:1,relayout:!1},B=function(){1==I.state?(n.option("items",A()),I.relayout=!1):I.relayout=!0},j=$("<img />");j.on("error",function(e){P.css({"background-image":"url("+srcpf$+"/media/images/default-user.jpg)"})}).on("load",function(e){P.css({"background-image":"url("+this.src+")"})}),e.on("onActived",function(e,t){I.state=t.state,1==t.state&&I.relayout&&setTimeout(B,200)}),$("#app").on("sidebar",function(e,t){setTimeout(function(){M[N(y)]!=M[N(app_container.innerWidth())]&&(V(app_container.innerWidth()),B())},10)}),$(window).resize(function(){M[N(y)]!=M[N(app_container.innerWidth())]&&(V(app_container.innerWidth()),B())});var M={xs:1,sm:2,md:2,lg:3,scr:0},U=function(){return{label:{text:"Ngay thoi viec"},dataField:"offdate",editorType:"dxDateBox",editorOptions:{width:"100%",readOnly:!d,onValueChanged:_,calendarOptions:{min:new Date("1900/1/1"),max:new Date("2100/1/1")},onContentReady:function(e){a.offdate=e.component}}}},W={xs:1,sm:2,md:3,lg:4,scr:0},A=function(){return[{itemType:"group",cssClass:"first-group",colCountByScreen:{xs:1,sm:1,md:4,lg:4},items:[{template:function(e,t){var n=$("<div class='row emppicleft'><div class='col-6'><div class='form-avatar'></div></div><div class='col-6 align-self-center' style='max-width:150px'><div id='btnNEW'></div><div id='btnUPT' style='margin: 10px 0px;'></div><div id='btnDEL'></div></div></div>");P=n.find(".form-avatar"),t.append($("<div/>").attr("class","summary").dxValidationSummary({validationGroup:"customerData"}),$('<div class="editcmdtop" style="margin:15px 0;display:none"><button type="button" class="btn btn-primary btn-sm nutsave"><i class="fa fa-floppy-o"></i> Save</button><button type="button" class="btn btn-secondary btn-sm nutcancel"><i class="fa fa-undo"></i> Cancel</button></div>'),n),n.find("#btnNEW").dxButton({text:"Add New",width:100,disabled:a.bNEW_dis,onClick:function(e){srclocked(!0),setTimeout(b,50)},onContentReady:function(e){a.btnNEW=e.component}}),n.find("#btnUPT").dxButton({stylingMode:"outlined",type:"default",text:"Edit",width:100,disabled:a.bUPT_dis,onClick:function(e){srclocked(!0),setTimeout(w,50)},onContentReady:function(e){a.btnUPT=e.component}}),n.find("#btnDEL").dxButton({stylingMode:"outlined",type:"danger",text:"Delete",width:100,disabled:a.bDEL_dis,onClick:function(e){var t=l.option("focusedRowIndex");t>=0&&(srclocked(!0),setTimeout(function(){l.deleteRow(t)},10))},onContentReady:function(e){a.btnDEL=e.component}})}},{itemType:"group",colSpan:3,items:[(e={itemType:"group",colCountByScreen:M,items:[{label:{text:"Ma cham cong"},dataField:"acno",editorOptions:{readOnly:!d},validationRules:[{type:"custom",validationCallback:function(){return!0}},{type:"required",message:"Country is required xxx"}]},{label:{text:"Ma nhan vien"},dataField:"empcode",editorOptions:{readOnly:!d},validationRules:[{type:"custom",validationCallback:function(){return!0}},{type:"required",message:"Country is required"}]},{label:{text:"ho"},dataField:"ho",editorOptions:{readOnly:!d},validationRules:[{type:"required",message:"Country is required"}]},{label:{text:"ten"},dataField:"ten",editorOptions:{readOnly:!d},validationRules:[{type:"required",message:"Country is required"}]},{dataField:"birthday",editorType:"dxDateBox",editorOptions:{width:"100%",readOnly:!d,onValueChanged:_,calendarOptions:{min:new Date("1900/1/1"),max:new Date("2100/1/1")},onContentReady:function(e){a.birthday=e.component}}},{label:{text:"Ngay gia nhap"},dataField:"hireday",editorType:"dxDateBox",editorOptions:{width:"100%",readOnly:!d,onValueChanged:_,calendarOptions:{min:new Date("1900/1/1"),max:new Date("2100/1/1")},onContentReady:function(e){a.hireday=e.component}}},{label:{text:"Gioi tinh"},dataField:"gender",editorOptions:{readOnly:!d}},{label:{text:"Hon nhan"},dataField:"soCMND",editorOptions:{readOnly:!d}}]},M.scr=M[N(y)],2!=M.scr&&e.items.push(U()),e)]}]},{itemType:"group",cssClass:"second-group",items:[function(){W.scr=W[N(y)];var e={itemType:"group",colCountByScreen:W,items:[{colSpan:2,label:{text:"Phong ban"},dataField:"pid",editorType:"dxSelectBox",editorOptions:{readOnly:!d,items:f,displayExpr:"text",valueExpr:"id"}},{label:{text:"Chuc vu"},dataField:"State",editorType:"dxSelectBox",editorOptions:{readOnly:!d,items:m}},{dataField:"email",editorOptions:{readOnly:!d}},{dataField:"Mobile",label:{text:"Phone"},editorOptions:{mask:"+1 (000) 000-0000",readOnly:!d}},{dataField:"cmnd",editorOptions:{readOnly:!d}},{dataField:"ngaycap",editorOptions:{readOnly:!d}},{dataField:"noicap",editorOptions:{readOnly:!d}},{dataField:"loai HDLD",editorOptions:{readOnly:!d}}]},t=4==W.scr?3:2;return 2==M.scr&&e.items.push(U()),e.items.push({colSpan:t,label:{text:"Dia chi"},dataField:"address",editorOptions:{readOnly:!d}}),e}(),{dataField:"Notes",editorType:"dxTextArea",editorOptions:{height:70,readOnly:!d}}]}];var e},V=function(e){return g!=e&&(g=e,y=app_container.innerWidth()),N(y)},N=function(e){return e<540?"xs":e<800?"sm":e<1200?"md":"lg"};function L(t){if(0==l.totalCount())e.find(".pagination a.active").html("0 / 0"),n.option("formData",{});else if(!t.component.isPreventFocusedRowChanged){l.option("focusedRowIndex")>-1&&l.option("focusedRowIndex",0)}}function z(t){try{if(!0===t.component.isPreventFocusedRowChanged)t.row.key&&(t.component.peddingFocusedRowChangedArg=t);else{e.find(".pagination a.active").html(t.rowIndex>-1?1+t.rowIndex+l.pageSize()*l.pageIndex()+" / "+l.totalCount():"0 / 0");var o=t.row.data,a={};o&&$.each(o,function(e,t){"id"!=e&&(a[e]=t)}),n.option("formData",a),l._lastkey=t.row.key,!0===n._hasERR&&n.validate()}}catch(e){}}n=e.find("#form_"+u).dxForm({screenByWidth:V,validationGroup:"customerData",items:A(),onContentReady:function(e){e.element.find("input").attr("autocomplete","new-password"),d&&n.validate()},onOptionChanged:function(e){"formData"===e.name&&j.attr("src",srcpf$+"/media/images/default-user.jpg")}}).dxForm("instance"),e.find(".cssprofile").on("click",'[class^="editcmd"] button',function(){$(this).hasClass("nutcancel")?(d=!1,srclocked(!0),setTimeout(function(){n.resetValues(),DevExpress.validationEngine.resetGroup(n._getValidationGroup()),n.option("formData",n._bkDS),R(!1),srclocked(!1)},100)):$(this).hasClass("nutsave")&&i&&"function"==typeof i&&setTimeout(i,50)}),t=e.find("#drawer_"+u).dxDrawer({opened:!1,position:"top",openedStateMode:"shrink",closeOnOutsideClick:!1,template:function(){var e=$("<div>").dxDataGrid($.extend({dataSource:{store:s},showBorders:!0,filterRow:{visible:!0},focusedRowEnabled:!0,pager:{showPageSizeSelector:!0,allowedPageSizes:[8,12,20]},loadPanel:{showPane:!1},columns:[{dataField:"pid",dataType:"number"},{dataField:"birthday",dataType:"date"},{dataField:"ho",dataType:"string"},{dataField:"ten",dataType:"string"},{dataField:"empcode",dataType:"string"},{dataField:"acno",dataType:"number"},{dataField:"hireday",dataType:"date"}],editing:{texts:{confirmDeleteMessage:""}},onRowRemoving:F,onContentReady:function(e){var t;t=l.totalCount()>0,a.bNEW_dis=!1,a.btnNEW.option("disabled",!1),a.bUPT_dis=!t,a.btnUPT.option("disabled",a.bUPT_dis),a.bDEL_dis=!t,a.btnDEL.option("disabled",a.bDEL_dis),h=setTimeout(v,100),l._fuckContentReady||(l._fuckContentReady="1",setTimeout(function(){x&&"function"==typeof x?x(e):L(e),l._fuckContentReady=null},50))},onFocusedRowChanged:function(e){z(e)}},l));return l=e.dxDataGrid("instance"),e}}).dxDrawer("instance"),e.find("#toolbar_"+u).dxToolbar({items:[{location:"center",template:"<h2><b>Employee's Profile</b></h2>"},{widget:"dxButton",location:"after",options:{icon:"tableproperties",onClick:function(){t.toggle()},onContentReady:function(e){a.drawer_toggle=e.component}}}]});e.find(".nutimgx").dxFileUploader({multiple:!1,selectButtonText:"Hinh anh",showFileList:!1,accept:Main.isMobile()?"image/*;capture=camera":".png, .jpg, .jpeg",value:[],uploadMode:"instantly",onValueChanged:function(t){if(t.value.length>0){function n(){var e=a.getPos,t=document.createElement("canvas"),n=t.getContext("2d"),o=e.w*a.scalex,i=e.h*a.scaley,l=e.x*a.scalex,c=e.y*a.scaley;t.width=s,t.height=r,n.drawImage(a[0],l,c,o,i,0,0,s,r),upimgur(t.toDataURL(),function(e){(e.type="success")&&j.attr("src",e.res.data.link),d.modal("hide"),k(e.msg,e.type)})}srclocked(!0),I.state=0;var o,a,i,d=admin$.popup({a:"f",fw:1,t:""}),s=126,r=126,l=d.find(".modal-body");function c(){var e,t;Jcrop.load(o[0]).then(function(n){e=Jcrop.attach(n,{multi:!1,handles:["sw","nw","ne","se"],aspectRatio:1}),t=Jcrop.Rect.sizeOf(e.el);var o=new Jcrop.Rect;o.w=n.naturalWidth,o.h=n.naturalHeight;var i=o.w>o.h?o.h:o.w;o.w=.5*i,o.h=.5*i,e.newWidget(o.center(n.naturalWidth,n.naturalHeight)),e.focus(),e.listen("crop.update",function(n,o){var i,d,l;i=e.active.pos,d=s/i.w,l=r/i.h,a.css({width:Math.round(d*t.w),height:Math.round(l*t.h),left:-d*i.x,top:-l*i.y}),a.getPos=e.active.pos,a.scalex=e.scalex,a.scaley=e.scaley}),srclocked(!1)}),i=function(){e.destroy()}}l.css({padding:"0px",overflow:"hidden","background-color":"#2a2a2a",border:"none"}),d.find(".modal-header").remove(),d.find(".modal-footer").remove(),d.find(".modal-content").css({border:"none"}),d.find(".modal-dialog").addClass("modal-dialog-centered modal-dialog-zoom"),def1=new $.Deferred,def2=new $.Deferred,$.when(def1,def2).then(function(e){setTimeout(c,1)}),d.one("shown.bs.modal",function(){var e=function(){_gsC(srcpf$+"/media/vendor/jcrop/jcrop.js","js",function(){def2.resolve("jcrop.js")},"jcrop.js")};11==GetIEVersion()?_gsC("https://cdn.polyfill.io/v2/polyfill.min.js","js",e,"polyfill.min.js"):e(),_gsC(srcpf$+"/media/vendor/jcrop/jcrop.css","css",function(){})}).one("hidden.bs.modal",function(t){i&&"function"==typeof i&&i(t),e.trigger("onActived",{state:1}),srclocked(!1)});var u=new FileReader;u.onloadend=function(){l.append('<div id="editpic_container"><img/></div><div id="editgui_controls"><button id="switchCameraButton" class="editpic_button" type="button" aria-pressed="false" style="display: block;"><i class="fa fa-floppy-o"></i></button><div id="takePhotoButton"><div class="form-avatar" style="margin:0"><img/></div></div><button id="toggleFullScreenButton" class="editpic_button" type="button" aria-pressed="false" style="display: block;"><i class="fa fa-times"></i></button></div>'),(o=l.find("#editpic_container img")).attr("src",u.result).on("load",function(e){def1.resolve("imgload")}),d.modal("show"),l.on("click",".editpic_button",function(e){"toggleFullScreenButton"==this.id?d.modal("hide"):"switchCameraButton"==this.id&&(srclocked(!0),setTimeout(n,50))}),(a=l.find("#takePhotoButton img")).attr("src",u.result)},u.readAsDataURL(t.value[0]),t.component.reset()}},onContentReady:function(e){$("<i class='fa fa-camera fuckcam'></i>").insertAfter(e.element.find(".dx-button-text"))}}).dxFileUploader("instance")},this.dispose=function(e){l.dispose(),t.dispose(),n.dispose()}}return e.prototype.publicSharedVar="quux",e}();