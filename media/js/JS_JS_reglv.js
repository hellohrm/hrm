w0w.tabglobalJS.JS_JS_reglv=function(){"use strict";return function(e){var t,n,a,i,o,r,s,d,l,c,p=this,u={holCHK:!0,WDM:{},__:["SlNfZGV2aWNlX3NldHRpbmc"],dbNa:"ZGFuZ2t5",___:[],lan:{},EVTs:{},ctxMNU_K:[],downline:0,vwtyp:1,fpa:";return {dog:_dog}",ignore_upt_cmm:"dabc",ePic:{},bosI:"https://bootdey.com/img/Content/user_1.jpg",empI:"https://hrm.dnd.vn/media/images/user-icon.jpg",minTong:.5,cmm_W:0,cmm_Wi:0,onevt:"ontouchend"in document?"touchend":"click",chkNo1:function(){return 1==aLAN.js_usr_info[1]?111111111:aLAN.js_usr_info[1]},quy_imp_excel:!1},m=function(){},f=function(e,t,n){var a=u.lan;return e="js_011_"+e,void 0===t?a[e]:void 0===n?a[e]&&a[e][t]:a[e]&&a[e][t][n]},g=function(e,t,n,a,i,o){var r=f(t,n)||a;return 1==this[0]?'<lo mnu="'+e+'" class="btn dropdown-item d-flex align-items-center '+i+'"><i class="'+o+'" style="font-size: 17px;margin: 0 10px 0 -5px;"></i>'+r+"</lo>":[2,3].indexOf(this[0])>-1?'<button mnu="'+e+'" type="button" class="btn btn-'+i.replace("text-","")+' btn-sm ml-auto"><i class="'+o+' mr-1"></i>'+r+"</button>":void 0},_=$.extend({1:["1",32,0,"Modify","text-secondary","ti-pencil"],2:["2",32,1,"Delete","text-danger","ti-trash"],3:["3",29,3,"Send back","","ti-check-box"],4:["4",29,4,"Send back","text-danger","ti-close"],5:["5",29,5,"Send back","text-secondary","fa fa-reply"],adchk:["106",29,15,"Admin checked","","ti-search"],d0:function(e,t,n,a){var i;e&&e.quyen[1]&&(u.holCHK&&t.hol&&""!=t.hol?e.quyen[1].indexOf("highest")>-1&&(i=_.highest(t,"regid",e,a)):e.quyen[1].split(",").some(function(n){return!!(i=_[n](t,"regid",e,a))}));var o=n.find("[mnu=send_reg]");return i&&"3"==i||3==a[0]?(o.toggleClass("btn-primary btn-info").data("__",3),o.html('<i class="fa fa-check-circle mr-2"></i>'+u.lan.js_011_29[13])):aLAN.js_usr_info[1]!=t.usrid&&o.text(f(29,12)),i},r0:function(e,t,n,a){return g.apply(a,this[1])+g.apply(a,this[2])},lv_rule:function(e){var t=w(e);return[t&&(t=t[0])&&difDa(t.EachDate,t.todate)+1,t]},lv_r1:function(e,t,n,a){if(!([100,105].indexOf(e.regsta)>-1)){var i=w(e[t]),o=i&&(i=i[0])&&(1==i.selo||0==difDa(i.EachDate,i.todate))?"3":void 0;return"regid"==t?o:(t=g.apply(a,this[5]),"3"==o&&(t=g.apply(a,this[4])+t),t)}},lv_comp_ngay:function(e,t,n,a,i){var o,r=u.regDAT.usrMAP[e.usrid]&&u.regDAT.usrMAP[e.usrid][e.regtyp];if(r)99997==e.usrid&&99998==n.EmpID&&(o="3");else{if([100,105].indexOf(e.regsta)>-1)return;var s=this.lv_rule(e[t]),d=s[0],l=s[1];(-1==i||1==l.selo||d<i)&&(o="3")}return"id"==t?(r=g.apply(a,this[5]),"3"==o&&(r=g.apply(a,this[4])+r),r):o},highest:function(e,t,n,a){return"regid"==t?"3":g.apply(a,this[4])+g.apply(a,this[5])},ot_r1:function(e,t,n,a){if("id"==t)return g.apply(a,this[5])}},e.exfn),v=function(e,t){var n=[];if(100==e.regsta||aLAN.js_usr_info[1]==e.usrid)n[0]=g.apply(t,_[1])+g.apply(t,_[2]),2==u.downline&&1==aLAN.js_usr_info[0]&&103==e.regsta&&(n[0]=g.apply(t,_.adchk)+n[0]);else if(2==u.downline)n[0]=e.dume_own_regis?"":g.apply(t,_[5]),[3,4].indexOf(e.regsta-100)<0&&(n[0]=(1==t[0]?g.apply(t,_[3]):"")+g.apply(t,_[4])+n[0]),1==aLAN.js_usr_info[0]&&103==e.regsta&&(n[0]=g.apply(t,_.adchk)+n[0]);else{var a=u.lan.rawD._fl0wself,i=e.ToiLaAi_In_This_Regis||a&&a[e.regtyp];a=[],i&&i.quyen[1]&&(u.holCHK&&e.hol&&""!=e.hol?i.quyen[1].indexOf("highest")>-1?a.push(_.highest(e,"id",i,t)):a.push(g.apply(t,_[5])):i.quyen[1].split(",").forEach(function(n){a.push(_[n](e,"id",i,t))})),n=[a.join(""),i]}return n},h=function(e,t){var n,a=u.regDAT.masREG;if(a)return(n=a._ca||(a._ca={}))[e]||a.some(function(t){if(t.id==e)return n[e]=t,!0}),n[e]&&n[e][t||"ten"]},b=function(e,t){if(1===D.deskGRID){var n=D.__regGID[1];n.repaintRows([n.option("focusedRowIndex")])}var a=D.mobi_cmmraw.rebuild(e);a.attr("class"),e=a.data(),t.replaceWith(a),t.attr("class",a.attr("class")),t.data(e)},w=function(e,t){return t=t||"D",u.regDAT._cache[t+"__"+e]||(u.regDAT._cache[t+"__"+e]=u.regDAT[t].filter(function(t){return t.pid==e}))},x=function(e,t,n,a){if(1===t){var i=parseInt(e.attr("data-target").split("#datno_")[1]);if(a=e.hasClass("chi__doc"),t=w(i),e=e.parent().next(),-1==(n=d.atK(i))[1]||!t)return;n=n[0]}var o,r,s=e.find(".row >div:first");if(1==n.regtyp)o=new Date(t[0].EachDate),r=new Date(t[0].todate),s.empty().html('<div class="m-1 text-large">'+h(t[0].id)+"</div>"),(s=s.next().addClass("my-2")).append($('<span class="elipx">'+fmtSD.format(o)+"</span>")),s=s.next().addClass("my-2"),0==t[0].selo?(s.find("i").toggleClass("fa-clock-o fa-calendar").next().text(fmtSD.format(r)),(s=s.next()).html(apisvr.a$.trim(t[0].notes)+function(e){var t=new Date(e.EachDate),n=new Date(e.todate),a=[],i=[],o=difDa(t,n)+1,r=function(e,t){if(e.length>0){e.unshift(e[0].toLocaleString(apisvr.a$.selected_language,{weekday:"long"})+": "+e.length+" "+(f(34,4)||"day"+(e.length>1?"(s)":""))+" ");for(var n=1;n<e.length;n++)e[n]=fmtSD.format(e[n]);o+="<br/>"+e.join(", ")}};for(o=" ("+(f(18)||"Total")+" "+o+" "+(f(34,4)||"day"+(o>1?"(s)":""));t<n;){var s=t.getDay();0==s?i.push(new Date(t)):6==s&&a.push(new Date(t)),t.setDate(t.getDate()+1)}return r(a),r(i),o+")"}(t[0]))):(s.addClass("text-danger").find("i").next().text(1==t[0].tresom?f(26)||"Late":f(27)||"Early"),s.next().text(apisvr.a$.trim(t[0].notes)+" ("+(f(18)||"Total")+" "+fmtSO(t[0].tong)+" "+(f(34,5)||"hour")+")"));else for(var l=(e=s.closest(".tickets-list")).children()[0].outerHTML,c=0;c<t.length;c++){o=new Date(t[c].EachDate),r=new Date(t[c].todate),0===c?s=$(e.children()[0]):(s=$(l),e.append(s));var p="it_"+t[c].pid+"_"+t[c].aid,m=h(t[c].id),g=s.find(".row >div:first"),_=g.find("input").attr("id",p),v="",b=t[c].tresom<-1&&"-"+u.chkNo1()!=t[c].tresom;(a||b)&&(_.prop("disabled",!0),b&&(_.parent().toggleClass("check-danger check-secondary"),v=" chksedary")),-1!==t[c].tresom&&(_.attr("checked","checked"),g.closest("li").addClass("rmv-reg-it"+v)),_.next().attr("for",p).html("<span>"+m+"</span>"),(g=g.next().toggleClass("col-md-2 col-md-3")).append($('<span class="elipx">'+fmtSD.format(o)+"</span><b>  -"+t[c].tong+"h</b>")),(g=g.next()).find("i").next().text(nga_sDt24(o,1)+" - "+nga_sDt24(r,1)),g.next().toggleClass("col-md-4 col-md-3").text(t[c].notes)}},y=function(e,t,n,a){if(1===t){var i=parseInt(e.attr("data-target").split("#empsno_")[1]);if(t=w(i,"E"),e=e.parent().next(),-1==(n=d.atK(i))[1]||!t)return;n=n[0]}for(var o=e.find(".row >div:first"),r=(e=o.closest(".tickets-list")).children()[0].outerHTML,s=0;s<t.length;s++){0===s?o=$(e.children()[0]):(o=$(r),e.append(o));var l=o.find(".row >div:first"),c=d.getE({usrid:t[s].eid,utyp:2})||{},p='<span class="ml-auto">('+(aLAN.js_001_21&&aLAN.js_001_21[c.gt])+")</span>"||"",u="n.v_"+t[s].eid,m=l.find("input").attr("id",u),f="",g=t[s].rmv>-1&&aLAN.js_usr_info[1]!=t[s].rmv;(a||g)&&(m.prop("disabled",!0),g&&(m.parent().toggleClass("check-danger check-secondary"),f=" chksedary")),-1!==t[s].rmv&&(m.attr("checked","checked"),l.closest("li").addClass("rmv-reg-it"+f)),m.next().attr("for",u).html('<span class="text-large"> '+(s+1)+". "+c.ten+"</span>"),l.append(p),l.toggleClass("col-md-4 col-md-6"),(l=l.next()).empty().html('<div class="m-1 text-large">'+c.ma+"</div>"),(l=l.next()).empty().html('<div class="m-1 text-large">'+t[s].eid+"</div>"),l=l.next().remove()}},D=(new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0,maximumFractionDigits:0}).format,{eye:'<button mnu="send_reg" type="button" class="btn btn-warning btn-o" style="font-size:20px;border-radius: 300px;"><i class="ti-eye"></i> Xem chi tiet</button>'}),T={},C=function(e,t,n){srclocked(!0),C._forMNU!=e&&(devDlg.atMNU={}),C._forMNU=e,setTimeout(function(){C.hwn||(C._k=glbK.regDYN("frm_regis"),C.el=$('<div class="_k-'+C._k+'">'+_.desk_gid_mnu(n)+"</div>")),devCTXmnu(t,C,function(e){C.hwn||(C.hwn=C.el.on("click",".btn",function(e){srclocked(!0),devDlg.ctx[0].hide(),setTimeout(function(){switch(e.currentTarget.getAttribute("mnu")){case"_expa_lktree":D.__regGID[1].expandAll();break;case"_cola_lktree":D.__regGID[1].collapseAll()}srclocked(!1)},10)}))})},10)},k=!1,A={Reg_Req_LV:function(e,t){j.LOA_req_frm.mnu_CLK(1,t)},Reg_Req_OT:function(e,t){j.LOA_req_frm.mnu_CLK(2,t)},hed_vis:function(e){M(e,"hed",!0)},fot_vis:function(e){M(e,"fot",!0)},noDZ_SAVE:function(e,t,n){var a=$.Deferred(),i=UaA(u.lan["\b"]||"");return $.when(P.SAVE({uri:i.length>0?i+"/hinh":void 0,dat:e,vwtyp:u.vwtyp,tep:"",rmvfile:n})).done(function(e){(e=JSON.parse(e))&&e.hasOwnProperty("valid")?a.resolve([0,e]):(0==t?toastMsg(u.lan.js_011_5||"Registration successful.","success"):toastMsg(aLAN.js_003_ok||"Operation is complete.","success"),a.resolve([1,e]))}).fail(function(e){devToasERR(e,u.lan),a.reject(e)}),a.promise()},_deleted:function(e){var t=e[1],n=d.RMV(t.regid);return 1===D.deskGRID?(D.__regGID[1].refresh(),-1==n[1]&&D.__regGID[1].option({focusedRowIndex:-1})):0==D.mobiui?I.dataNV_SEK.at(n[1],!0):e[0]=2,-1==n[1]&&R(),n}},E=function(e,t,n,a,i){if(1==e)(o=d.atK(n.id))[0]?(j.LOA_req_frm||(j.LOA_req_frm=j(t)),2==u.downline&&(1==o[0].utyp?n.view&&n.view[2].text&&(n.view[2]=n.view[2].text()):-1==n.view[0]&&(n.view[0]=65535)),A["Reg_Req_"+(1==o[0].regtyp?"LV":"OT")](e,[o[0],i,n.view])):srclocked(!1);else if([2,3,4,30,5,106].indexOf(e)>-1){var o=d.atK(n.id),r="Please confirm before proceeding ...",s={2:aLAN.js_001_25||"Please confirm that you want to delete ?",3:aLAN.js_001_27||r,4:aLAN.js_001_27||r,30:aLAN.js_001_27||r,5:aLAN.js_001_27||r,106:f(29,16)||"Are you sure you have finished checked ?"};o[1]>-1&&devDlg(1,s[e]).show().done(function(t){if(1==t){srclocked(!0);var i=$.extend({act:e,regid:o[0].regid,tepcnt:o[0].tepcnt},n),r=u.regDAT.GOI[o[0].regid];r&&r.length>0?i.tg=r[0].tg:i.tg=o[0].tg,$.when(A.noDZ_SAVE(JSON.stringify(i),1)).done(function(t){[2,3,4,5].indexOf(e)>-1&&A._deleted(t),a(t),G(t.toka,i,e),srclocked(!1)}).fail(function(e){a(e),srclocked(!1)})}}),srclocked(!1)}else{var l=e.currentTarget.getAttribute("mnu");l&&A.hasOwnProperty(l)?A[l](e):srclocked(!1)}},N=function(e,t,n){t.preventDefault(),t.stopPropagation(),j.LOA_req_frm||(j.LOA_req_frm=j(e));var a=t.currentTarget.getAttribute("mnu");if(k&&i._forMNU===a)return T.ctx[0].hide(),void srclocked(!1);i._forMNU=a,i.op.position={my:"top center",at:"center bottom"},n&&n.op&&$.extend(i.op,n.op),i._fnUI=function(e,t,a){n&&n.cb?n.cb(e,t,a):srclocked(!1)},function(e,t,n){if(T.ctx){var a=T.ctx[2].closest(".pov_PBA_MNU").find("div[class*='_k-']"),i=0;a.map(function(e,n){var a=$(n);a.hasClass("_k-"+t._k)?(i=1,a.removeClass("d-none")):a.addClass("d-none")}),0==i&&(T.ctx[2].append(t.el),n&&"function"==typeof n&&n()),T.ctx[0].option($.extend({},{onHidden:null,onHiding:null,onShown:null,onShowing:null,hideOnOutsideClick:null,maxWidth:400,target:e},t.op||{}))}else{var o=$('<div class="pov_PBA_MNU"></div>').append(t.el);T.ctx=[$("<div></div>").appendTo($(e).closest("#tabBODY_"+s)).dxPopover($.extend({},{contentTemplate:function(e){return o},target:e,showEvent:"dxclick",maxWidth:400,hideOnOutsideClick:!0,shading:!1,shadingColor:"rgba(0, 0, 0, 0.5)",onDisposing:function(e){},onContentReady:function(e){e.component._$popupContent.css("padding","10px"),n&&"function"==typeof n&&n()}},t.op)).dxPopover("instance"),[t],o]}T.ctx[0].show(),srclocked(!1)}(t.currentTarget,i,function(e){i.hwn||(i.hwn=i.el.on("click",".btn",function(e){E&&(srclocked(!0),setTimeout(function(){E(e),T.ctx[0].hide()},10))}))})},O=function(e,t){return t||(t=u.lan.js_011_30),t&&t[e]},I=function(e,t,a){var i=D.dumeSVG.find(".cssprofile").clone(),s=function(e){if("opened"==e.name){D.deskGRID=!0===e.value?1:2,R(e.value);var t=I.option("formData");if(!0===e.value)l.obj.option("focusedRowKey")!==t.regid?(l.obj._prevent_onFocusedRowChanged=!0,l.obj.option({disabled:!1,focusedRowKey:t.regid}),l.obj.refresh(),l.obj._prevent_onFocusedRowChanged=!1):l.obj.option({disabled:!1}),srclocked(!1);else{if(l.obj.option("disabled",!0),!$.isEmptyObject(t)){var n=d.atK(t.regid);v.dataNV_SEK.at(n[1])}srclocked(!1)}}},l=function(e){if(l.gDrawer)l.gDrawer.toggle();else{var a={opened:!1,height:"100%",closeOnOutsideClick:!1},i={width:"800px",height:"300px"};2==e&&(a.revealMode="expand",a.position="top",a.width="100%",i={height:"500px",width:"100%"}),l.gDrawer=r.find(".fuckdrawer").dxDrawer($.extend({template:function(e){var a=new DevExpress.data.ArrayStore({key:"regid",data:d.GET()}),o=$("<div></div>").appendTo(e);m=function(e){var t=!e||100==e.regsta||105==e.regsta&&aLAN.js_usr_info[1]==e.usrid&&D.mobi_cmm.find(".act_cmm_tmpl .nhap_cmm").length>0;l.$tolBa.option("items[4].options",{disabled:!t}),l.$tolBa.option("items[5].options.disabled",!t)},l.$tolBa=$('<div style="box-shadow: inset 0 8px 10px -6px rgba(191, 191, 191, 0.15);"></div>').appendTo(o).dxToolbar({items:[{widget:"dxButton",location:"before",options:{icon:"menu",stylingMode:"text",onClick:function(e){C.op={position:{my:"left top",at:"left bottom"},onShowing:function(e){C.el.children().addClass("d-none"),C.el.find("."+C._forMNU).removeClass("d-none"),srclocked(!1)}},dogOutCLK(C.op,!0),C("mnu_desk_reg_lst",e.element,u.lan)}}},{location:"before",template:function(){return $("<div>").addClass("informer").append($("<div>").addClass("count").text(aLAN.js_001_24||"Group by"))}},{location:"before",widget:"dxSelectBox",options:{width:225,items:[{value:"",text:"(none)"},{value:"ff_regtyp",text:O(1)||"Type of registration"},{value:"ff_regsta",text:O(2)||"Status"}],displayExpr:"text",valueExpr:"value",value:"",onValueChanged:function(e){srclocked(!0),setTimeout(function(){l.obj.clearGrouping(),""!==e.value&&l.obj.columnOption(e.value,"groupIndex",0)},10)}}},{location:"before",widget:"dxButton",options:{text:"Collapse All",width:136,visible:!1,onClick:function(e){const t="Expand All"===e.component.option("text");l.obj.option("grouping.autoExpandAll",t),e.component.option("text",t?"Collapse All":"Expand All")}}},{location:"before",widget:"dxButton",options:{icon:"edit",text:aLAN.js_007_26,stylingMode:"text",disabled:!0,onClick:function(){srclocked(!0),setTimeout(function(){E(1,t,{id:i.option("focusedRowKey")},function(e){},D.mobi_cmm.find(".act_cmm_tmpl"))},10)}}},{location:"before",widget:"dxButton",options:{icon:"trash",type:"danger",stylingMode:"text",disabled:!0,text:aLAN.js_007_27,onClick:function(){srclocked(!0),setTimeout(function(){i.option("focusedRowIndex"),E(2,null,{id:i.option("focusedRowKey")},function(e){})},10)}}},{location:"after",widget:"dxButton",options:{icon:"ti ti-close",stylingMode:"text",type:"danger",onClick:function(){l.gDrawer.toggle()}}}]}).dxToolbar("instance");var r=-1,c=function(){clearTimeout(r),srclocked(!1),console.log(" gidLOCK_fn ",(new Date).getTime())};i=$('<div class="luoi_head bo_line_top gid_lineh_1">').appendTo(o).dxDataGrid($.extend({dataSource:{store:a,reshapeOnPush:!0},filterPanel:{visible:!0},headerFilter:{visible:!0},filterRow:{visible:!0},autoNavigateToFocusedRow:!0,repaintChangesOnly:!0,noDataText:function(e){this.innerHTML=D.empty_msg.html()},editing:{confirmDelete:!1},showBorders:!0,columnAutoWidth:!1,allowColumnReordering:!1,focusedRowEnabled:!0,paging:{pageSize:20},pager:{visible:!0,allowedPageSizes:[20,50,100,"all"],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},columns:[{dataField:"oid",caption:O(0)||"#",width:50,cssClass:"text-wrap text-center",allowFiltering:!1},{caption:O(1)||"Type of registration",dataField:"ff_regtyp",minWidth:150,allowHeaderFiltering:!0,allowFiltering:!1},{widget:"dxDateBox",caption:f(17)||"Date",dataField:"EachDate",dataType:"date",format:function(e){return new Intl.DateTimeFormat(apisvr.a$.selected_language,{year:"numeric",month:"2-digit",day:"2-digit"}).format(e)},width:100,allowHeaderFiltering:!1},{dataField:"ff_regsta",caption:O(2)||"Status",minWidth:100,allowHeaderFiltering:!0,allowFiltering:!1},{caption:O(3)||"Attachments",dataField:"tepcnt",width:70,cssClass:"w_1",allowHeaderFiltering:!1},{caption:O(4)||"Valid employee(s)",dataField:"empcnt",width:70,cssClass:"w_1",allowHeaderFiltering:!1},{caption:O(5)||"Registration by",columns:[{caption:O(7)||"AC.no",dataField:"ff_usrid",width:75,allowHeaderFiltering:!1},{caption:O(8)||"Code",dataField:"ff_EmpCode",width:100,allowHeaderFiltering:!1},{caption:O(9)||"Full name",dataField:"ff_EmpName",minWidth:150,allowHeaderFiltering:!1}]},{caption:O(6)||"Registration time",dataField:"tg",dataType:"datetime",format:nga_sDt24,cssClass:"w_1 _1_",width:100,allowHeaderFiltering:!1}].concat(1==aLAN.js_usr_info[0]?[{caption:O(13)||"Admin Checked",dataField:"adchk",width:100,cssClass:"w_1",lookup:{dataSource:[{ma:1,des:""},{ma:2,des:O(14)||"passed"}],valueExpr:"ma",displayExpr:"des"},allowHeaderFiltering:!0,allowFiltering:!1}]:[]),onContentReady:function(e){if(!l.obj){l.obj=e.component,e.component._prevent_onFocusedRowChanged=!0;var t=I.option("formData");e.component.option("focusedRowKey",t.regid),m(t),D.deskGRID=1,setTimeout(function(){l.gDrawer.option({opened:!0,onOptionChanged:s}),R(!0),l.obj._prevent_onFocusedRowChanged=!1},1)}clearTimeout(r),r=setTimeout(function(){c()},300)},onFocusedRowChanged:function(e){!0!==i._prevent_onFocusedRowChanged&&i._manualRowFocused(e)},onCellPrepared:function(e){if("data"===e.rowType&&"ff_regsta"===e.column.dataField){var t="fa fa-pencil";100==e.data.regsta||(105==e.data.regsta?t="fa fa-reply":101==e.data.regsta?t="fa fa-paper-plane":e.data.regsta<103?t="fa fa-hourglass-o":103==e.data.regsta?t="fa fa-check-circle":104==e.data.regsta&&(t="fa fa-times-circle")),e.cellElement.html('<i class="'+t+'"></i> '+e.displayValue)}},onRowPrepared:function(e){if("data"==e.rowType){var t="";100==e.data.regsta?t="font-italic":101==e.data.regsta||(e.data.regsta<103?t="text-warning":103==e.data.regsta?t="text-success":[104,105].indexOf(e.data.regsta)>-1&&(t="text-danger")),e.rowElement.addClass(t)}},onOptionChanged:function(e){e&&["filterValue"].indexOf(e.name)>-1&&(srclocked(!0),clearTimeout(r),r=setTimeout(function(){c()},300))}},i)).dxDataGrid("instance"),D.__regGID=[a,i];var p=i._$element.find(".dx-datagrid-pager.dx-pager").data().dxPager;p._optionChanged=function(e){e&&["pageSize","pageIndex"].indexOf(e.name)>-1&&(srclocked(!0),clearTimeout(r),r=setTimeout(function(){c()},300)),p.constructor.prototype._optionChanged.call(this,e)},i._manualRowFocused=function(e){srclocked(!0),setTimeout(function(){var t;n=function(e){n=null,srclocked(!1)},e.row&&("group"==e.row.rowType?e.row.data.items?t=e.row.data.items[0]:e.row.data.collapsedItems&&(t=e.row.data.collapsedItems[0]):"data"==e.row.rowType&&(t=e.row&&e.row.data||null)),I.option({disabled:!t,formData:t})},10)}}},a)).dxDrawer("instance")}},c=e.prev().on("click",".btn",function(e){switch($(e.currentTarget).attr("mnu")){case"gview":srclocked(!0),setTimeout(function(){l(2)},10);break;case"gfilter":srclocked(!0),setTimeout(function(){U(u.__loadOPT={mod:1,frm:p.option("value"),too:g.option("value"),mobiui:D.mobiui})},10);break;case"tuychon":srclocked(!0),setTimeout(function(){N(t,e,{cb:function(e,t,n){0!=e&&M(t,"-1","_vis")}})},10)}}).on("evtUI",function(e,t,n){c.find('[mnu="gfilter"').prop({disabled:!1})}),p=c.find(".lk_tungay").dxDateBox({placeholder:O(1,u.lan.js_011_31||[])||"From date",value:new Date(a.frm.setHours(0,0,0,0)),onValueChanged:function(e){if(e.value&&e.value instanceof Date&&!isNaN(e.value)){var t=new Date(g.option("value"));new Date(e.value).getTime()>t.getTime()?g.option("value",e.value):c.trigger("evtUI",[e])}else e.component.option("value",e.previousValue||new Date((new Date).setHours(0,0,0,0)))}}).dxDateBox("instance"),g=c.find(".lk_dengay").dxDateBox({placeholder:O(2,u.lan.js_011_31||[])||"To date",value:new Date(a.too.setHours(0,0,0,0)),onValueChanged:function(e){if(e.value&&e.value instanceof Date&&!isNaN(e.value)){var t=new Date(p.option("value"));new Date(e.value).getTime()<t.getTime()?p.option("value",e.value):c.trigger("evtUI",[e])}else e.component.option("value",e.previousValue||new Date((new Date).setHours(0,0,0,0)))}}).dxDateBox("instance"),v=function(){$('<div style="flex:0.3;text-align:right"><a mnu="start_mnu" style="padding: 10px;border-radius: 50%;font-size:large" type="button" class="btn btn-primary ti-plus start_mnu _close"></a><div>').insertBefore(e.prev().find(".frm_tieude")).on("click","a",function(e){srclocked(!0),setTimeout(function(){N(t,e,{cb:function(t){$(e.currentTarget).toggleClass("_close _open")}})},10)});var n=(r=$(_.fuckdrawer).appendTo(e)).find(".reg_card"),a=$('<ul class="list-group ulDU_ME mx-3"></ul>').append($('<li class="list-group-item"></li>').append(i)).appendTo(r.find(".fuckdrawer").append(D.empty_msg));return D.mobi_cmm.insertBefore(n),a.parent().parent().prepend(o.find(".card-footer")),n}().dxForm({readOnly:!0,disabled:!0,screenByWidth:function(e){if(e<550)return"xs"},items:[{itemType:"group",cssClass:"first-group px-0 mx-auto",colCount:8,colCountByScreen:{xs:1},items:[{itemType:"group",colSpan:5,colCount:4,colCountByScreen:{xs:4},items:[{cssClass:"position-relative",template:function(e,t){D.desPIC=D.dumeSVG.find(".dumeARROW").clone().attr("style","margin-top: -50px;right: 0;left: auto;"),t.append([D.desPIC,'<div class="form-avatar mx-auto"></div>']),D.desPIC.empid=-1}},{itemType:"group",colSpan:3,items:[{editorOptions:{labelMode:"floating"},label:{text:O(7)||"AC.no",visible:!1},dataField:"usrid"},{editorOptions:{labelMode:"floating"},label:{text:O(8)||"Code",visible:!1},dataField:"EmpCode"},{editorOptions:{labelMode:"floating"},label:{text:O(12)||"Join date",visible:!1},dataField:"jd",editorType:"dxDateBox"}]}]},{itemType:"group",colSpan:3,items:[{editorOptions:{labelMode:"floating"},label:{text:O(9)||"Full name",visible:!1},dataField:"EmpName"},{editorOptions:{labelMode:"floating"},label:{text:O(10)||"Gender",visible:!1},dataField:"ff_gt"},{editorOptions:{labelMode:"floating"},label:{text:O(11)||"Birthday",visible:!1},dataField:"bd",editorType:"dxDateBox"}]}]}],onOptionChanged:function(e){if("formData"===e.name){if(JSON.stringify(e.previousValue)!==JSON.stringify(e.value)){var t="add";$.isEmptyObject(e.value)?(D.mobi_cmm.html(""),D.desPIC.next().css("background-image","")):(D.mobi_cmm.html(D.mobi_cmmraw.rebuild(e.value)),t="remove",D.desPIC.empid!=e.value.usrid&&(a=e.value.usrid,i=apisvr._src+a+".jpg",$("<img>").attr("src",i+"?t="+(new Date).getTime()).on("load",function(e){D.desPIC.next().css("background-image","url("+i+src$id+")")}).on("error",function(e){D.desPIC.next().css("background-image","")}),D.desPIC.empid=a)),m("add"==t?"nut_dume":e.value),e.element[t+"Class"]("empcard_empty")}n&&"function"==typeof n&&n(e)}var a,i}}).dxForm("instance");return v.dataNAVI=i.on("click","a.btn",function(e){srclocked(!0),setTimeout(function(){n=function(e){n=null,srclocked(!1)},v.dataNV_SEK[e.currentTarget.getAttribute("mnu")]()},10)}),v.dataNV_SEK=L(i),v},j=function(e){var n,o=null,r=function(e){var i,r,s,l,c,p,m,g,x=function(){o._$content.removeClass("lkload"),o._$popupContent.removeClass("invisible"),srclocked(!1),m.hasClass("long-title")},y=function(){if(-1==j.uptKEY)m.text(f(32,12)||"Registration New");else{var e=j.datUPT[2];e&&((e=e[2]).text?e=e.text().toUpperCase():j.datUPT[2]=void 0),m.text(e||f(32,13)||"Edit Registration")}return k.lst_=T(),k.lst_},T=function(e){if(-1!=j.uptKEY&&j.datUPT[2]){var t=j.datUPT[2];return"-1"!=t[0]&&t[1].indexOf("|canticksel")>0?2:1}return 0},C=function(e){var t=$(this),n=t.find(".dx-checkbox");n.length>0&&(clearTimeout(C.fuck_lst_chk),C.fuck_lst_chk=setTimeout(function(){var e=this[0],t=this[1];i.option("selectedItems").some(function(n){if(n.acno==e.data().dxListItemData.acno)return n.rmv=t.hasClass("dx-checkbox-checked")?parseInt(aLAN.js_usr_info[1]):-1,!0})}.bind([t,n]),300))},k=function(e){var t=k.lst_;i._$container[(1==t?"add":"remove")+"Class"]("prevent_point"),0!=t&&(i.unselectAll(),e.map(function(e){if(e.rmv>-1){var t=aLAN.js_usr_info[1]!=e.rmv,n=i._findItemElementByKey(e.acno);n.length>0&&n.addClass(t?"prevent_point":"").find(".dx-checkbox").data().dxCheckBox.option({value:!0,disabled:t})}}),i._$container.off("mouseup").on("mouseup",".dx-list-item",C))},E=function(e){var t=-1!=j.uptKEY&&j.datUPT[1].data("ToiLaAi_In_This_Regis")||u.lan.rawD._fl0wself&&u.lan.rawD._fl0wself[j.renWhat];return 1==e?(2==u.downline||u.quy_imp_excel&&2==j.renWhat)&&0==k.lst_?"":1==k.lst_?"only_read":2==k.lst_?"duyet_rmv":t?"":"only_me":2==e?2==u.downline&&0==k.lst_||!!t:void 0},N=function(e){var t=-1!=j.uptKEY?w(j.uptKEY):[],a=t[0],i=!(t.length>0&&j.datUPT[2]),o="phone"==DevExpress.devices._realDevice.deviceType,r=s._masLV;if(e||(r=JSON.parse(u.lan.rawD.ma$ter).filter(function(e){return 3==e.typ})),a||(a={id:r.length>0?r[0].id:null,EachDate:new Date((new Date).setHours(0,0,0,0)),todate:new Date((new Date).setHours(0,0,0,0)),tresom:1,selo:0,tong:u.minTong}),1==e)return[a,!i];(s=s.dxForm({labelMode:"floating",formData:a,readOnly:!i,showColonAfterLabel:!0,labelLocation:"left",minColWidth:300,colCount:2,items:n.regisFRM(u,r,[,],a,f,o,i),onContentReady:function(e){x()}}).dxForm("instance"))._masLV=r},O=-1,S=function(e){var t=-1!=j.uptKEY?w(j.uptKEY):[],a=new DevExpress.data.ArrayStore({key:"aid",data:t.map(function(e,t){var n=new Date(e.EachDate),a=new Date(e.todate),i=new Date(new Date(e.EachDate).setHours(0,0,0,0));return{id:e.id,EachDate:i,tugio:n,dengio:a,tong:e.tong,notes:e.notes,aid:e.aid,tresom:e.tresom}})}),i=k.lst_=T(),o=function(e){if(0!=i&&"selection"==e.type){var t=!1,n=!1;"dataRow"==e.parentType?((t="-1"!=e.row.data.tresom)&&(n="-"+u.chkNo1()!=e.row.data.tresom,e.editorElement.closest("tr").addClass("dx-selection"+(n?" prevent_point":""))),e.editorElement.data().dxCheckBox.option({disabled:n,value:t})):"headerRow"==e.parentType&&e.editorElement.data().dxCheckBox.option({disabled:!1})}},r=!(t.length>0&&j.datUPT[2]);if(1===e)return l._$element[(r?"remove":"add")+"Class"]("only_read"),l.deselectAll(),e={onEditorPrepared:o,dataSource:a,selection:{mode:1==i?"none":"multiple",allowSelectAll:0==i}},2==i&&(e.selectedRowKeys=a._array.filter(function(e){return-1!=e.tresom}).map(function(e){return e.aid})),l.option(e),l._$element[(1==i?"add":"remove")+"Class"]("hideselectchk"),void l._dxToolBar.option("visible",r);var s=$('<div class="p-2"></div>').appendTo(l),d={readOnly:1==i,dataSource:a,columnAutoWidth:!1,showBorders:!0,paging:{enabled:!1},sorting:{mode:"none"},editing:{mode:"form",allowUpdating:!0,allowAdding:!0,allowDeleting:!0},selection:{mode:1==i?"none":"multiple",allowSelectAll:0==i},onContentReady:function(e){x(),2==i&&(clearTimeout(O),O=setTimeout(function(){a._array.filter(function(e){return-1!=e.tresom&&"-"+u.chkNo1()!=e.tresom}).length>0&&l._$element.find(".dx-datagrid-headers .dx-select-checkbox").data().dxCheckBox.option({disabled:2==i})},300))},onSelectionChanged:function(e){s.option("items[1].options",{disabled:!e.selectedRowsData.length,r:e.selectedRowKeys[0]}),s.option("items[2].options.disabled",!e.selectedRowsData.length)},onEditorPrepared:o};$.extend(d,n.columns(u.lan,u.quy_imp_excel?[]:[2767])),2==i&&(d.selectedRowKeys=a._array.filter(function(e){return-1!=e.tresom}).map(function(e){return e.aid})),$('<div class="dog_edit_frm"></div>').insertBefore(l),(l=$("<div></div>").addClass(r?"":"only_read")[(1==i?"add":"remove")+"Class"]("hideselectchk").appendTo(l).dxDataGrid(d).dxDataGrid("instance"))._fieldChg=function(e,t,n,a){a[t]=n;var i=new Date(a.EachDate),o=new Date(new Date(a.tugio).setFullYear(i.getFullYear(),i.getMonth(),i.getDate())),r=new Date(o.getTime()+36e5*a.tong);e.dengio.option("value",new Date(r)),"EachDate"==t&&e.tugio.option("value",o)},l._dxToolBar=s=s.dxToolbar({visible:r,items:n.columns.otTOOLB(l)}).dxToolbar("instance")},L=function(){s=$('<div class="lv_regis_frm"></div>').appendTo(r),l=$('<div class="luoi_head bo_line_top"></div>').appendTo($('<div class="ot_thoigian"></div>').appendTo(r));var t=$('<span class="ml-2"></span>');r.append($('<div class="dx-fieldset-header my-3 reg-step-no" style="font-weight: 100;"><span class="bl-no">2</span><span class="bl-txt">'+(u.lan.js_011_12||"Attach Files")+"</span></div>").append($('<span class="small d-flex align-items-center no-wrap mr-2" style="max-width:200px;flex:1'+(11==GetIEVersion()?"":";margin-left:auto")+'"><span>100px</span></span>').append(t))).append(j.tmpl.tmpl_attach),t=t.css("width","100%").dxSlider({min:100,max:500,value:100,valueChangeMode:"onHandleRelease",onValueChanged:function(e){t._$element.prev().text(e.value+"px"),a.css("height",e.value),S.iniH=e.value}}).dxSlider("instance"),c=r.parent();var a,d,p=r.find(".thumbnail-container").on("click",".noDZ .remove-thumbnail",function(e){var t=$(this);_({name:t.prev().attr("file-name")}),t.closest(".noDZ").remove()}),m={resizeWidth:1e3,dictResponseError:"js_011_3",headers:{Accept:null,"Cache-Control":null,"X-Requested-With":null},transformFile:function(e,t){return(this.options.resizeWidth||this.options.resizeHeight)&&e.type.match(/image.*/)?this.resizeImage(e,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,t):t(e)},url:"https://timegold.liwayway.com.vn:3004/aap/api/HelloHRM/hinh",method:"POST",paramName:"file",maxFilesize:50,parallelUploads:100,autoProcessQueue:!1,uploadMultiple:!0},f=function(e){a.find(".swiper-wrapper").append(e.addClass("invisible"))},_=function(e,n){if(n){var i=$('<div class="swiper-slide" idx="'+e.name+'"></div>').append($('<div class="swiper-zoom-container"></div>').append($(n).css("width","auto")));if(y||S.hasOwnProperty("init"))1===S.init&&!0===y.initialized?y.appendSlide(i):f(i);else{var o=a.find(".dropzone-init");f(i),a.addClass("dogswiper"),o.find(".btn_attach i").toggleClass("ti-plus ti-clip"),d.removeClass("d-none").prepend(o),S.init=0,S()}}else if(y){var r=a.find('[idx="'+e.name+'"]').index(),s="swiper-min-css";if(r>-1&&y.removeSlide(r),0==y.slides.length){y.destroy(!0,!0),y=null,o=d.addClass("d-none").find(".dropzone-init"),a.removeClass("dogswiper"),a.empty().height(t.option("value")),o.find(".btn_attach i").toggleClass("ti-plus ti-clip"),a.append($('<div class="swiper-wrapper"></div>').append(o)),$("head").find("#"+s).remove();var l=window.dynload.indexOf(s);l>0&&window.dynload.splice(l,1),delete S.init}}},v=0,b=function(){0==--v&&(b._cbEv?b._cbEv():srclocked(!1))},w=function(){if(!m.previewTemplate){var e=p.find(".upload-thumbnail"),t='<div class="upload-thumbnail" id="">'+e.html()+"</div>";m.previewTemplate=t,m.previewsContainer=p[0],m.clickable=a.find(".btn_attach")[0],d=e.next(),e.remove(),p.on("click",".image-name",function(e){e.preventDefault();var t=a.find('[idx="'+e.currentTarget.innerText+'"]').index();y.slideTo(t)})}Dropzone.autoDiscover=!1,(g=new Dropzone(a[0],m))._enqueueThumbnail=function(e){!0!==e.hasOwnProperty("isDUP")&&this.createThumbnail(e,1e3,null,this.options.thumbnailMethod,!0,function(t){if("string"==typeof t){var n=document.createElement("img");n.src=t,_(e,n)}b()})},g.subHWND={},g.on("addedfile",function(e){var t=d.parent().find('[file-name="'+e.name+'"]');if(t.length>0){if(!t.closest(".upload-thumbnail").hasClass("noDZ"))return e.isDUP=!0,void g.removeFile(e);t.next().trigger("click")}0==v&&srclocked(!0),v++;var n=$(e.previewElement);n.find(".image-name").attr("file-name",e.name),n.insertBefore(d),g.subHWND.addedfile&&"function"==typeof g.subHWND.addedfile&&g.subHWND.addedfile(e)}),g.on("error",function(e,t){e.size/1024/1024>this.options.maxFilesize&&this.removeFile(e),g.subHWND.error&&"function"==typeof g.subHWND.error&&g.subHWND.error(e,t),toastMsg(u.lan[t]||t,"error",null,"top center")}),g.on("success",function(e,t){var n;n=$(e.previewElement),setTimeout(function(){n.find("a[data-dz-remove]").toggleClass("text-danger text-success").toggleClass("fa-times-circle fa-check").removeClass("remove-thumbnail"),n.find(".dz-progress").remove(),n.removeClass("upding")},500),setTimeout(function(){g.subHWND.success&&"function"==typeof g.subHWND.success&&g.subHWND.success(e,t)},500),b()}),g.on("removedfile",function(e){e.hasOwnProperty("isDUP")||_(e),g.subHWND.removedfile&&"function"==typeof g.subHWND.removedfile&&g.subHWND.removedfile(e)}),g.on("sendingmultiple",function(e,t,n){g.subHWND.sendingmultiple&&"function"==typeof g.subHWND.sendingmultiple&&g.subHWND.sendingmultiple(e,t,n)}),g.on("totaluploadprogress",function(e){g.subHWND.totaluploadprogress&&"function"==typeof g.subHWND.totaluploadprogress&&g.subHWND.totaluploadprogress(e)}),g.send_REQ=function(e,t,a){v=g.getQueuedFiles().length;var o,r=U.noDZfile||[],s=[];1==t&&r.length>0&&(p.find(".noDZ .image-name").map(function(e,t){s.push($(t).text())}),s=r.filter(function(e){return this.indexOf(e)<0},s)),o=v>0?function(e,t,n){var a=$.Deferred(),i=UaA(u.lan["\b"]||""),o=$(g.previewsContainer).find(".upload-thumbnail").addClass("upding").find(".image-name").append('<div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress="" style="width:0%;"></span></div>').next().addClass("remove-thumbnail"),r=function(e,n){1===e?(0==t?toastMsg(u.lan.js_011_5||"Registration successful.","success"):toastMsg(aLAN.js_003_ok||"Operation is complete.","success"),a.resolve([1,n]),g.removeAllFiles(!0),g.disable()):(a.reject(n),o.find(".dz-progress").remove(),o.closest(".upding").removeClass("upding"))},s=function(){for(var e=0;e<g.files.length;e++)g.files[e].status=Dropzone.QUEUED,g.files[e].upload.bytesSent=0,$(g.files[e].previewTemplate).find("a[data-dz-remove]").toggleClass("text-success text-danger").toggleClass("fa-check fa-times-circle").addClass("remove-thumbnail")};return b._cbEv=function(e){delete b._cbEv},i.length>0?(g.options.url=i+"/hinh",g.subHWND.success=function(e,t){t&&t.hasOwnProperty("valid")?(delete g.subHWND.success,a.resolve([0,t]),s()):(delete g.subHWND.success,setTimeout(function(){r(1,t)},500))},g.subHWND.error=function(e,t){delete g.subHWND.error,r(0,t),s()},g.subHWND.sendingmultiple=function(t,a,i){delete g.subHWND.sendingmultiple,i.append("dat",e),i.append("lan",aLAN["\b"]),i.append("iwkfhtbz",w0w.apisvr.a$.iwkfhtbz),i.append("vwtyp",u.vwtyp),i.append("tep",t.map(function(e){var t=n.indexOf(e.name);return t>-1&&n.splice(t,1),e.name}).join()),i.append("rmvfile",n)},Dropzone.prototype.submitRequest=function(e,t,n){e.send(t)},g.processQueue()):_gsC("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js","js",function(e){var t=new JSZip,n=[];g.getQueuedFiles().forEach(function(e){t.file(e.name,e),n.push($(e.previewElement)),b()}),t.generateAsync({type:"base64"}).then(function(e){$.when(P.SAVE({fz64:e})).done(function(e){n.forEach(function(e){e.find(".dz-progress").remove(),e.removeClass("upding"),e.find("a[data-dz-remove]").toggleClass("text-danger text-success").toggleClass("fa-times-circle fa-check").removeClass("remove-thumbnail")}),setTimeout(function(){r(1,e)},500)}).fail(function(e){if(e&&e.length>0){try{e=0==(e=JSON.parse(e)).status?"js_011_3":e.statusText}catch(e){}toastMsg(u.lan[e]||e,"error",null,"top center")}r(0,e)})})},"jszip.min.js"),a.promise()}(e,t,s):A.noDZ_SAVE(e,t,s),$.when(o).done(function(t){t&&t[1]&&t[1].hasOwnProperty("valid")?(n.cty.dupERR(F.action._$itemContainer,t[1].valid,e,u.regtable,h,i,u.lan),srclocked(!1)):(F.action.hide(),setTimeout(function(){a(t[0],t[1])},50))}).fail(function(e){a(0)})}};function x(e){g.removeAllFiles(!0),y&&(y.removeAllSlides(),_({}),t.option("value",100),p.find(".upload-thumbnail").remove()),U.noDZfile=[];var n=1,i="remove",r=o._$bottom.find(".reg-step-no");-1==j.uptKEY&&(n=0),1===n&&j.datUPT[2]&&(n=parseInt(j.datUPT[2][0]),i="add"),d[i+"Class"]("invisible"),r[(n>1?"remove":i)+"Class"]("invisible"),U.nutNOP=n;var s=r.closest(".dx-toolbar-items-container")[i+"Class"]("xemdangky").find(".chon_valid_e .dx-button");s.length>0&&s.data().dxButton.option("visible","add"==i||E(2)),g["remove"==i?"enable":"disable"](),p.find(".upload-thumbnail").remove(),0!==n?(i=j.datUPT[0]).tep&&""!=i.tep.trim()&&setTimeout(function(){for(var e=UaA(u.lan["\b"]||""),t=(e.length>0?e.split("/api/")[0]+"/imgs/":"/imgs/")+i.regid,a=i.tep.split(",").map(function(e){return e.trim()})||[],o=0;o<a.length;o++){var r=apisvr.a$.trim(a[o]);!function(e){var n={name:e},a=document.createElement("img");a.onload=function(e){_(n,a)},a.onerror=function(e){},a.src=t+"/"+e}(r);var s=$(g.options.previewTemplate).addClass("noDZ");s.find(".image-name").attr("file-name",r).html('<span data-dz-name="">'+r+"</span>"),s.insertBefore(d)}U.noDZfile=a,(-1==n||n>1)&&p.find(".remove-thumbnail").remove()},100):a.height(t.option("value"))}a=r.find(".mySwiper2"),u.lan.js_011_14&&a.find(".click-txt").text(u.lan.js_011_14);var y,D="phone"==DevExpress.devices._realDevice.deviceType?"":" pl-2",C="desktop"==DevExpress.devices._realDevice.deviceType,N=function(e,t){var a=$('<div class="reg_emps'+D+(t?" justify-content-center":"")+'"></div>'),i="",o=apisvr._src+e.acno+".jpg";return t?($('<div class="myself">'+n.myselfSVG+"<img onerror=\"_ierr(this,'"+u.bosI+'\')" src="'+o+'"/></div>').appendTo(a),i="<div><i>"+u.lan.js_007_1+" :</i>"+e.acno+"</div>"):$("<img onerror=\"_ierr(this,'"+u.empI+'\')" src="'+o+'"/>').appendTo(a),$(i+"<div><i>"+u.lan.js_007_3+" :</i> "+e.empcode+"</div><div><i>"+u.lan.js_007_7+" :</i> "+e.empname+"</div><div><i>"+u.lan.js_007_14+" :</i> "+e.ff_pb+"</div>").appendTo($("<div>").addClass("info pl-sm-2").appendTo(a)),t||$("<div>").addClass("accode").html("<i>"+u.lan.js_007_1+"</i>"+e.acno).appendTo(a),a},O=M(),I=$('<span class="text-bold">('+O.length+")</span>").appendTo($('<div class="dx-fieldset-header my-3 reg-step-no" style="font-weight: 100;"><span class="bl-no">3</span><span class="bl-txt">'+(u.lan.js_011_13||"Apply To Employees")+'</span><i class="ti-user small" style="margin: 0 5px 0 -5px;"></i></div>').appendTo(r)),S=function(){$('<div class="swiper-button-next"></div><div class="swiper-button-prev"></div><div class="swiper-pagination"></div>').appendTo(a),_gsC("https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css","css",function(e){_gsC("https://cdnjs.cloudflare.com/ajax/libs/Swiper/5.4.5/js/swiper.min.js","js",function(e){S.init=1,y=new Swiper(a,{zoom:!0,slidesPerView:"auto",spaceBetween:30,pagination:{el:".swiper-pagination",type:"fraction"},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),a.find(".swiper-slide").removeClass("invisible")},"swiper.min.js")},"swiper-min-css")};if($.when(e).done(function(){w(),x()}),u.downline>0||u.quy_imp_excel){var R=!0,L=k.lst_=T(),B=function(e,t){var a=function(){C&&e.element[(e.element.find(".dx-scrollview-content").height()<300?"add":"remove")+"Class"]("shoter600px")};if("selA"==t){var o=e.element.children(":first"),r=function(t){e.element.find(".dx-list-select-all").css({padding:"0px",margin:"0px"}).prependTo(t)};if(R){R=!1;var s=e.element.find(".dx-list-search"),d=$('<div class="dumeSELSEAR"></div>').insertBefore(o);d.append($('<div mnu="reglk_emps" class="btn ti-menu-alt"></div>').on("click",function(e){(u.quy_imp_excel||0==k.lst_&&i.option("selectedItemKeys").length>0)&&(srclocked(!0),setTimeout(function(){n.lstE_mnu(u,e,j.renWhat)},10))})),d.append(s.css("flex","1")),r(d)}else r(o);i._hoantat&&"function"==typeof i._hoantat&&i._hoantat(e),a(),k(e.component.option("dataSource"))}else"ds"==t&&(I.text("("+e.value.length+")"),a())},W=function(e,t){var n="timO"+t;clearTimeout(B[n]),B[n]=setTimeout(function(){clearTimeout(B[n]),B(e,t)},100)};i=$(C?'<div class="lstregemp  mx-3 shoter600px" style="max-height:600px;position: absolute;left: 0;right:0;padding-bottom:20px"></div>':'<div class="lstregemp"></div>').addClass(E(1)).appendTo(r).dxList({dataSource:O,repaintChangesOnly:!0,showNextButton:!0,keyExpr:"acno",height:"100%",searchEnabled:!0,searchExpr:["acno","empcode","empname"],showSelectionControls:!0,selectionMode:"all",selectAllMode:"allPages",allowItemDeleting:!!(u.quy_imp_excel&&2==j.renWhat||0===L&&E(2)),itemDeleteMode:"toggle",itemTemplate:function(e,t,n){return N(e)},onContentReady:function(e){W(e,"selA")},onOptionChanged:function(e){"dataSource"==e.name&&W(e,"ds")}}).dxList("instance")}else N(O[0],"myself").appendTo(r),I.text("("+O.length+")"),i={option:function(e){return"dataSource"==e?O:[O[0],aLAN.js_usr_info]}};return i._emps_fromEXCEL=function(e){for(var t=0;t<e.length;t++){for(var n=0,a=0;a<u.regDAT.emp.length;a++)if(u.regDAT.emp[a].id==e[t].acno){n=1;break}0===n&&u.regDAT.emp.push({bd:null,ff_pb:e[t].ff_pb,gt:1,id:parseInt(e[t].acno),jd:null,ma:e[t].empcode,pb:-1,ten:e[t].empname,typ:2})}},x},M=function(){var e=aLAN.js_usr_info,t=[];return U.cmmTXT="",-1!=j.uptKEY?(w(j.uptKEY,"E").forEach(function(e){var n=d.getE({usrid:e.eid,utyp:2})||{};t.push({acno:n.id,empcode:n.ma,empname:n.ten,secid:n.pb,ff_pb:n.ff_pb,rmv:e.rmv})}),U.cmmTXT=100==j.datUPT[0].regsta?j.datUPT[0].notes:j.datUPT[1].find("textarea.re_ca_bo").val()):2==aLAN.js_usr_info[0]&&t.push({acno:e[1],empcode:e[2],empname:e[3],secid:e[4],ff_pb:e[5],rmv:-1}),t},F={contentTemplate:function(e){e.parent().addClass("lkload").attr("data-content",aLAN.js_001_20.toUpperCase()+" ..."),m=$('<div class="text-center long-title" style="font-size:25px;font-weight: 100">...</div>').appendTo(e),r=$('<div class="p-3 pb-0"><div class="dx-fieldset-header reg-step-no mb-2" style="font-weight: 100;"><span class="bl-no">1</span><span class=" bl-txt">'+(u.lan.js_011_11||"Regis Information")+"</span></div></div>").appendTo(e),e.addClass("invisible m-0 p-0")},onContentReady:function(e){e.component._$content.addClass("dume_registration").css({"border-top":"none","border-bottom":"none;"}),e.component._$popupContent.addClass("duma_registration")},showTitle:!1,hideOnOutsideClick:!1,showCloseButton:!1,toolbarItems:[{toolbar:"bottom",location:"before",template:function(e,t,n){o.d0gClose=$('<div class="dogclose"><button type="button" class="btn btn-danger btn-sm ti-close" style="padding: 10px;border-radius: 50%;font-size: large;box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;"></button></div>'),$('<div class="btn p-0 dx-fieldset-header mb-0 reg-step-no invisible" style="font-weight: 100;"><span class="bl-no mr-1 dx-icon dx-icon-fieldchooser"></span>'+(u.lan.js_011_6||"Apply")+"</div>").on("click",function(e){srclocked(!0),setTimeout(function(){U()},10)}).appendTo(n)}},u.downline>0?{widget:"dxButton",toolbar:"bottom",location:"phone"==DevExpress.devices._realDevice.deviceType?"after":"center",cssClass:"overflow-hidden chon_valid_e",options:{icon:"find",text:aLAN.js_007_36,onClick:function(e){admin$.devpu.lkWhat&&admin$.devpu.lkWhat!="lk_for_regis_"+j.renWhat&&(st1.lkE=null),admin$.devpu.lkWhat="lk_for_regis_"+j.renWhat;var n=[],a=0,o={chkRemote:25,paging:{pageSize:10}};admin$.devpu({lkwhat:j.renWhat,e:function(){if(a>Math.max(o.chkRemote,o.paging.pageSize)){var e=$.Deferred();return $.when(t.svrDAT({uri:dburl,act:"QRY",dat:JSON.stringify({values:{proc:"LK_EXIST_EMPS"}})})).done(function(t){e.resolve(t)}).fail(function(t){e.resolve("err")}),e.promise()}return $.map(n,function(e){return e.acno})}(),em:0,ef:"acno",fullRST:function(e,t){var n=i.option("dataSource");i.option({searchValue:"",dataSource:[]}),e.forEach(function(e){var a={___:e.___,acno:e.acno,empcode:e.empcode,empname:e.empname||e.ho+" "+e.ten,secid:e.secid},i=t.filter(function(t){return t.id===e.secid}),o=d.getE({usrid:e.acno,utyp:2});a.ff_pb=i.length>0?i[0].dis:"Invalid section name of ID("+e.secid+" )",o.id||u.regDAT.emp.push({id:e.acno,ma:e.empcode,ten:e.empname||e.ho+" "+e.ten,gt:e.gt,jd:e.hireday,pb:e.posid,ff_pb:a.ff_pb,typ:2}),n.push(a)}),i._hoantat=function(e){i._hoantat=null,srclocked(!1)},setTimeout(function(){i.option({dataSource:n}),i.reload()},100)},acnoFILTER:i.option("dataSource").map(function(e){return[e.___,parseInt(e.acno)]})})}}}:{toolbar:"bottom"},{widget:"dxButton",toolbar:"bottom",location:"after",options:{elementAttr:{style:"min-width:auto"},text:aLAN.js_003_1,onClick:function(){F.action&&(F.action.act=0),srclocked(!0),setTimeout(function(){o.hide()},10)}}}]},B=function(){U.send_regBTN.closest("li").css({display:2==u.downline&&-1!=j.uptKEY&&[103,104].indexOf(j.datUPT[0].regsta)>-1&&2==j.datUPT[0].utyp?"none":""})},U=function(){if(F.hasOwnProperty("action"))U.cmmTXT!=u.ignore_upt_cmm&&(U.cmmt.repaint(),U.cmmt.option("value",U.cmmTXT)),B(),F.action.option("visible",!0),o.d0gClose.css("display","");else{var e=11==GetIEVersion()?"width:300px;":"",t=function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget.getAttribute("mnu"),n=["sav_tmp","send_reg"].indexOf(t);n>-1?(srclocked(!0),setTimeout(function(){var e={act:0,sta:100+n,typ:j.renWhat,emp:i.option("dataSource").map(function(e){return e.acno}),n0t:apisvr.a$.trim(U.cmmt.option("value"))||""};if(1==j.renWhat?(e.dat=[s.option("formData")],e.dat[0].selo=s._$element.find(".dx-tabpanel").data().dxTabPanel.option("selectedIndex"),e.dat[0].aid=0,0==e.dat[0].selo?e.dat[0].tong=u.minTong:e.dat[0].todate=e.dat[0].EachDate):e.dat=l.option("dataSource")._array.map(function(e,t){var n=new Date(e.tugio),a=new Date(e.dengio),i=new Date(e.EachDate);return a=(i=i.getTime()+36e5*(n.getHours()+n.getMinutes()/60))+36e5*e.tong,{id:e.id,EachDate:new Date(i),todate:new Date(a),tong:e.tong,notes:e.notes,tresom:-1,aid:t}}),-1!=j.uptKEY)if(e.act=1,e.regid=j.uptKEY,1==n){if(u.regDAT.GOI[e.regid]){var t=j.datUPT[0],r=t.regsta,c=function(e){return e.regsta<102?e.regsta+1:(e.regsta=105)?aLAN.js_usr_info[1]==e.usrid?101:102:e.regsta}(t);e.snddat={regid:t.id,regsta:c,oldsta:r,notes:e.n0t}}}else e.sta=j.datUPT[0].regsta,105==e.sta&&(e.n0t+="");1==n&&13==a()[0]&&(e.sta=103),g.send_REQ(JSON.stringify(e),e.act,function(t,n){F.action.act=t;var a,i=u.regDAT.R.length;if(1==t){if(0==e.act){var r=i>0&&Math.max.apply(Math,u.regDAT.R.map(function(e){return e.oid}))||0;a={oid:r+1,utyp:parseInt(aLAN.js_usr_info[0]),usrid:parseInt(aLAN.js_usr_info[1]),regid:n.regid,tg:n.tg,regsta:e.sta,regtyp:e.typ,notes:e.n0t,tep:n.tep,tepcnt:n.tepcnt,empcnt:e.emp.length},u.regDAT.R.push(a);var s=-1;if(103==a.regsta&&1==u.vwtyp?s=2:u.vwtyp>1&&a.regsta<103?s=1:3==u.vwtyp&&2==u.downline&&(s=3),s>-1){var l=D.piltab.find("li a.active >div");l.children().not(":first").remove(),l.append('<span class="badge text-success small sig_refresh"><i class="ti-reload"></i></span>'),l.closest("a").addClass("need_refs")}}else{(a=j.datUPT[0]).tg=n.tg,a.notes=e.n0t,a.regsta=e.sta,a.tep=n.tep,a.tepcnt=n.tepcnt,a.empcnt=e.emp.length,delete a.fillok;for(var c=u.regDAT.D.length-1;c>-1;c--)u.regDAT.D[c].pid==n.regid&&u.regDAT.D.splice(c,1);for(delete u.regDAT._cache["D__"+n.regid],c=u.regDAT.E.length-1;c>-1;c--)u.regDAT.E[c].pid==n.regid&&u.regDAT.E.splice(c,1);delete u.regDAT._cache["E__"+n.regid]}101==a.regsta&&(e.snddat={regid:a.regid,regsta:a.regsta,oldsta:100,notes:a.notes}),e.snddat&&(u.regDAT.GOI[n.regid]||(u.regDAT.GOI[n.regid]=[])).unshift($.extend({__expa:a.__expa,byuser:-1,EmpName:a.EmpName,tg:a.tg,pid:a.regid,regtyp:a.regtyp,usrid:a.usrid},e.snddat)),e.dat.forEach(function(e){e.pid=n.regid,u.regDAT.D.push(e)}),e.emp.forEach(function(e){u.regDAT.E.push({pid:n.regid,eid:parseInt(e),rmv:-1})}),d.FIL(a),a.__expa=D.mobiui,j.__uptKEY=n.regid,0==e.act?1===D.deskGRID?(D.__regGID[1].option({focusedRowKey:a.regid}),D.__regGID[1].refresh()):1==D.mobiui?D.mobi_cmm.prepend(D.mobi_cmmraw.rebuild(a)):I.dataNV_SEK.at(i,!0):b(j.datUPT[0],j.datUPT[1]),o.hide(),101==a.regsta&&setTimeout(function(){G(n.toka,a,a.regsta)},"101"),0==i&&R(),srclocked(!1)}else srclocked(!1)})},10)):srclocked(!1)},a=function(e){e||(e=j.renWhat);var t=-1!=j.uptKEY&&j.datUPT[1].data("ToiLaAi_In_This_Regis")||u.lan.rawD._fl0wself&&u.lan.rawD._fl0wself[e]&&u.lan.rawD._fl0wself[e];return 2==u.downline||t&&0==t.myBos.length&&(!t.bos_OnlyMe||0==t.bos_OnlyMe.length)?[13,"Approved"]:[11,"Send"]},r=n.err_block,p=n.cty(u,e),m=[{template:function(e,t,n){return U.send_regBTN=p.find("[mnu=send_reg]"),B(),U.cmmt=p.find(".sendnotes").dxTextArea({placeholder:u.lan.js_011_8||"Registration notes here ...",height:80,maxLength:195,value:U.cmmTXT}).dxTextArea("instance"),p}}],w=function(e){if(U.nutNOP>1){var n=!i._$element.hasClass("only_read")&&i.option("selectedItemKeys")||[],a={emrmv:[],otrmv:[],notes:apisvr.a$.trim(U.cmmt.option("value"))},r=e.currentTarget.getAttribute("mnu");106!=r&&(n&&n.length>0&&i.option("dataSource").map(function(e){e.rmv==parseInt(aLAN.js_usr_info[1])&&a.emrmv.push([n.indexOf(e.acno)>-1,e.acno])}),2==j.renWhat&&l._$element.hasClass("only_read")&&(n=l.getSelectedRowKeys())&&n.length>0&&l.option("dataSource")._array.map(function(e){n.indexOf(e.aid)>-1?-1!=e.tresom&&"-"+u.chkNo1()!=e.tresom||a.otrmv.push([!0,j.uptKEY,e.aid]):"-"+u.chkNo1()==e.tresom&&(e.tresom=-1,a.otrmv.push([!1,j.uptKEY,e.aid]))})),j.datUPT[2][2].closest(".row").find("button[mnu='send_reg']").trigger(u.onevt,[parseInt(r),function(){F.action.act=0,F.action.hide(),setTimeout(function(){o.hide()},10)},a])}else t(e)};F.action=$("<div></div>").appendTo(c.parent()).dxActionSheet({dataSource:m,showCancelButton:!1,showTitle:!1,visible:!0,container:c.parent(),onContentReady:function(e){o.d0gClose.insertBefore(e.component._popup._$wrapper.addClass("dume_overflow").children(":first").css("border-bottom","none").find(".dx-popup-content").addClass("pb-1")).off("click").on("click",".btn",function(t){U.cmmTXT=u.ignore_upt_cmm,o.d0gClose.css("display","none"),setTimeout(function(){F.action.act=0,e.component.hide()},10)}),e.component._popup.option("onHiding",function(e){o.d0gClose.css("display","none");const t=p.find(".tickets-container");t.length>0&&t.data().dxScrollView&&t.data().dxScrollView.dispose(),p.find("*").unbind().removeData()}),e.component._popup.option("onShowing",function(e){!function(e){var t=U.send_regBTN,n=t[0].classList;if(t.html('<i class="fa fa-'+(11==e[0]?"paper-plane":"check-circle")+' mr-1"></i>'+(f(29,e[0])||e[1])),n.remove(n[3]),U.nutNOP>1){t.addClass("btn-primary");var a=j.datUPT[0],i=65535==U.nutNOP?3:2,o=v($.extend({id:a.regid},j.datUPT[1].data()),[i]);_.d0(o[1],a,t.parent(),[i]),t.closest("ul").find("li:first").html($(r[2]).html(o[0]).addClass(3==i?"mb-3":""))}else t.closest("ul").find("li:first").html(r[1]),n.add("btn-"+(11==e[0]?"primary":"info"))}(a());var t=0,o=p.off("click",".btn").parent().children().addClass("d-none"),d=[j.renWhat,i,l];if(1==j.renWhat){var c=g.getQueuedFiles().length,u=U.noDZfile||[];0==c&&u.length>0&&-1!=j.uptKEY&&(c=$(g.previewsContainer).find(".noDZ .image-name").length),d[3]=c,d[2]=s,t=-1==j.uptKEY||100==j.datUPT[0].regsta?0:1}!0!==(-1!=j.uptKEY&&j.datUPT[0].hasOwnProperty("isAMIN_BACK"))&&n.cty.err_panel(o.eq(0),f,k,d,t,h)||(o.eq(1).removeClass("d-none"),U.cmmt&&U.cmmt.repaint(),p.on("click",".btn",function(e){srclocked(!0),clearTimeout(w._hwnd_save),w._hwnd_save=setTimeout(function(){w(e)},100)})),srclocked(!1)})},onInitialized:function(e){var t=e.component,n=function(e,n,a){t._itemDXEventHandler(e,"onItemClick",n,a),$(e.target).is(".dx-state-disabled, .dx-state-disabled *")};t._mapPopupOption=function(e){"visible"==e&&!0===this.option(e)&&this._popup&&this._popup.option("container",c.parent()),this._popup&&this._popup.option(e,this.option(e))},t._itemClickHandler=n,t._itemHoldHandler=n}}).dxActionSheet("instance")}};"phone"==DevExpress.devices._realDevice.deviceType?(F.fullScreen=!0,F.dragEnabled=!1):(F.maxWidth=800,F.height="100%",F.width="100%"),F.onShowing=function(e){if($("body").addClass("part_fullscreen"),s||l){if(1==j.renWhat){if(1===N.grid&&(l.option({visible:!1,disabled:!0}),l._$element.closest(".ot_thoigian").addClass("d-none")),1===N.form){var t={visible:!0,disabled:!1};if(j.__renWhat!=j.renWhat&&j.__uptKEY!=j.uptKEY){var n=N(1);t.formData=n[0],t.readOnly=n[1],setTimeout(function(){var e=s._$element.find(".dx-tabpanel").data().dxTabPanel;e.option({selectedIndex:n&&n[0].selo||0,disabled:n[1]}),e._$itemContainer.find(".dx-radiogroup").data().dxRadioGroup.option("value",n[0]&&n[0].tresom||1)},10)}s.option(t)}}else 1===N.form&&s.option({visible:!1,disabled:!0}),1===N.grid&&(l.option({visible:!0,disabled:!1}),j.__renWhat!=j.renWhat&&j.__uptKEY!=j.uptKEY&&(l.cancelEditData(),S(1)),l._$element.closest(".ot_thoigian").removeClass("d-none"));L(1)}else y(),e.component._$bottom.css("padding","5px 20px 10px 15px").addClass("duma_registration"),L=L();j.__renWhat=j.renWhat,j.__uptKEY=j.uptKEY},F.onShown=function(e){var t=!0;1==j.renWhat?N.hasOwnProperty("form")||(t=!1,N.form=1,N()):N.hasOwnProperty("grid")||(t=!1,N.grid=1,S()),t&&x(),setTimeout(function(){p?p.scrollTo({left:0,top:0}):p=c.dxScrollView({scrollByContent:!0,scrollByThumb:!0,showScrollbar:"onScroll",reachBottomText:"Updating...",onDisposing:function(e){}}).dxScrollView("instance")},1)},F.onHiding=function(e){$("body").removeClass("part_fullscreen"),!F.action||F.action.act,srclocked(!1)},F.onHidden=function(e){};var W=apisvr.review_regis?document.body:a;(o=$('<div class="popup_home"></div>').appendTo(W).dxPopup(F).dxPopup("instance")).reset_popup=function(){!N.hasOwnProperty("form")||N.hasOwnProperty("form");var e=y(),t=M();i.option({dataSource:t,searchValue:"",allowItemDeleting:!!(u.quy_imp_excel&&2==j.renWhat||0===e&&E(2))}),o._$content.addClass("lkload"),o._$popupContent.addClass("invisible"),i._$element&&(i.unselectAll(),i._$element.removeClass("only_read  duyet_rmv only_me").addClass(E(1)),i.repaint())}},s="tuychon_"+(new Date).getTime();i={_k:s,op:{onShowing:function(e){k=!0,i.el.children().addClass("d-none");var t=i.el.find("."+i._forMNU);t.removeClass("d-none"),i._fnUI&&i._fnUI(1,t)},onHiding:function(e){k=!1,T.ctx[0].option("target",null),i._fnUI&&i._fnUI(0)},hideOnOutsideClick:function(e){return!0},width:"auto",maxWidth:400,position:{my:"bottom center",at:"center top"}},_forMNU:null,_fnUI:null,el:$('<div class="_k-'+s+'">'+D.ctx_mnu_tmpl+"</div>")},s=[];var l=u.lan.rawD&&u.lan.rawD._fl0wself;if(l&&l.forEach(function(e,t){e&&"rno"==e.quyen[0]&&s.push(t)}),s.length>0){l=i.el.find('.start_mnu [mnu^="Reg_Req_"]');for(var c=s.length-1;c>-1;c--){var m=$(l[s[c]-1]);m.next().hasClass("hrx")&&m.next().remove(),m.prev().hasClass("hrx")&&m.prev().remove(),m.remove()}}return{mnu_CLK:function(e,t){if(j.renWhat=e,delete j.datUPT,j.uptKEY=t?(j.datUPT=t,t[0].regid):-1,j.__uptKEY=-2,j.__renWhat=-2,o)o.reset_popup(),o.show();else{var i=$.Deferred();j.tmpl||a.trigger("get",[srcp$f+"/media/utils/regis_tmpl.html"+src$id,function(e){var t=this;a.trigger("",[e,!1,$.Deferred().done(function(){var e,a=$(adCS(arguments[0],t));j.tmpl={tmpl_attach:a.find(".tmpl_attach").html()},r(i),n=w0w._dog&&_dog(p)||(e=arguments[3].join(""),Function("'use strict';"+e+u.fpa)()).dog(p),o.show()})])}]),_gsC("https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js","js",function(e){i.resolve()},"dropzone.min.js")}}}},S=e.ua>1?"UA":"noU",R=function(e){var t=u.regDAT.R.length;e=1===D.deskGRID||!0===e,D.empty_msg[(t>0||e?"add":"remove")+"Class"]("d-none"),I.dataNAVI&&I.dataNAVI[(0==t||e?"add":"remove")+"Class"]("d-none")},L=function(e){var t=e.find(".recordidx"),n=e.find(".btn.prev"),a=e.find(".btn.next"),i=0,o=function(e,o){var s=u.regDAT.R.length;i=e,t.text(e+1+" / "+s),n[(e>0&&s>0?"remove":"add")+"Class"]("disabled"),a[(e<s-1&&s>0?"remove":"add")+"Class"]("disabled"),!0===o&&r(0)},r=function(e){0!==e&&o(i+e);var t=d.AT(i);I.option({disabled:!t,formData:t})};return{at:o,prev:function(){r(-1)},next:function(){r(1)}}},P=(l=u.dbNa+"_hed",u.dbNa,{LOAD:(c={S_noU:function(e,t){var n=$.Deferred();return lo$DB(function(a){if(0==a.kq){var i=a.e.target.result;i.objectStoreNames.contains(l)&&i.deleteObjectStore(l),i.createObjectStore(l,{keyPath:"aid",autoIncrement:!0})}else if(1==a.kq){var o,r=0,s=a.rst.transaction([l],"readwrite"),d=s.objectStore(l);"delete"==t?o=d[t](e.aid):(e.aid&&-1==e.aid&&delete e.aid,o=d[t=e.aid?"put":(e.id=u.regDAT.reduce(function(e,t){return+t.id>+e?t.id:e},0)+1,"add")](e)),o.onsuccess=function(t){r=1,e.aid=t.target.result},s.oncomplete=function(){a.rst.close(),n.resolve(r)}}}),n.promise()},S_UA:function(e){var n=$.extend({},{uri:"/api/lkdata",act:"req_regis"},e);return t.svrDAT(n)},L_noU:function(){var e=$.Deferred();return lo$DB(function(t){if(0==t.kq)t.cb("cancel"),e.resolve(null);else if(1==t.kq){var n=[],a=t.rst.transaction([l],"readonly"),i=a.objectStore(l);a.oncomplete=function(){t.rst.close(),e.resolve(n)},i.openCursor().onsuccess=function(e){var t=e.target.result;t&&(n.push(t.value),t.continue())}}}),e.promise()},L_UA:function(e){$.Deferred();var n=UaA(u.lan["\b"]||""),a={uri:n.length>0?n+"/lodregis":"/api/lkdata",dat:JSON.stringify(e)};return t.svrDAT(a)},TMP:function(t,n){var a=u.dbNa+("noU"==S?"":"_"+btoa(e.__u));if(t+="Item",!n)return st(t,a);st(t,a,btoa(window[st0("1")](JSON.stringify(n))))}})["L_"+S],SAVE:c["S_"+S],TMP:c.TMP}),M=function(e,t,n){if("-1"!=t){var a=$(e.currentTarget).find("i");a.toggleClass("ti-check"),u.REG_COF[t]=a.hasClass("ti-check")?1:0,st("setItem",u.dbNa+"__"+aLAN.js_usr_info[1],btoa(window[st0("1")](JSON.stringify(u.REG_COF)))),1==n&&U(u.__loadOPT,(new $.Deferred).resolve(I))}else for(var i in u.REG_COF)if(u.REG_COF.hasOwnProperty(i)){var o=u.REG_COF[i],r="[mnu="+i+n+"] i";e.find(r)[(1==o?"add":"remove")+"Class"]("ti-check")}},F=function(e,t){return t=new Date(t),t=new Date(t.setMonth(t.getMonth()+e)),e<0&&t.setTime(t.getTime()-864e5),new Date(t)},B=function(){if(!(this instanceof B))return new B;u.regDAT.D,u.lan.rawD&&JSON.parse(u.lan.rawD.ma$ter);var e={E:{},U:{}},t=1,n=function(t,n){var a={};return u.regDAT.emp.some(function(i){if(i.id==t.usrid&&i.typ==t.utyp)return a=i,e[n][t.usrid]=i,!0}),a},a=function(t){var a=2==aLAN.js_usr_info[0]?"E":"U",i=e[a][t.usrid]||n(t,a),o=[],r=[],s=[];if(i&&(t.EmpCode=i.ma,t.EmpName=i.ten,t.bd=i.bd,t.jd=i.jd,t.ff_gt=aLAN.js_001_21[i.gt],t.flowMark=-1*i.pb),0==D.mobiui){for(var d=u.regDAT.E.length-1;d>-1;d--){var l=u.regDAT.E[d];l.pid==t.regid&&(l=e[a][l.eid]||n({usrid:l.eid,utyp:2},a))&&(o.unshift(l.id),r.unshift(l.ma),s.unshift(l.ten))}t.ff_usrid=o.join(),t.ff_EmpCode=r.join(),t.ff_EmpName=s.join()}t.ff_regtyp=f(28,t.regtyp),t.ff_regsta=f(29,t.regsta-100),u.regDAT.D.some(function(e){if(e.pid==t.regid)return 1==t.regtyp&&1==e.selo&&(t.ff_regtyp=_La$N("js_011_38|"+e.tresom,u.lan)),t.EachDate=e.EachDate,!0}),t.fillok=1},i=function(e,t){var n,i=0;return u.regDAT.R.some(function(t){if(t.regid===e)return 1!==t.fillok&&a(t),n=t,!0;i++}),t?n:[n,n?i:-1]};return{GET:function(){return u.regDAT.R.forEach(function(e,n){1!==e.fillok&&a(e),e.oid=t,t++}),u.regDAT.R},AT:function(e){if(e>-1&&u.regDAT.R.length>e){var t=u.regDAT.R[e];return 1!==t.fillok&&a(t),t}},atK:i,FIL:a,RMV:function(e){var t=i(e),n=t[1];return u.regDAT.R.splice(n,1),0==u.regDAT.R.length?n=-1:u.regDAT.R.length==n&&n--,[t[0],n]},getE:function(t,a){return a||(a=2==aLAN.js_usr_info[0]?"E":"U"),e[a][t.usrid]||n(t,a)}}},U=function(e,t){e.vwtyp=u.vwtyp,$.when(P.LOAD(e),t,w0w._cordovaNative?w0w._cordovaNative.__.regis_chat(D.mobi_cmm):"2").done(function(t,i,o){if(u.regDAT={R:[],GOI:[],masREG:[],_cache:{}},u.ePic={},t){var r=JSON.parse(t),s=JSON.parse(r.u$rdat);$.extend(u,r.flow),u.lan.rawD=r;var l=D.piltab.find("li.rmv_self").next();u.downline=1==aLAN.js_usr_info[0]?2:r._fl0wself?1:(l.remove(),l=null,0),l&&l.removeClass("d-none"),u.regDAT=s,u.regDAT.usrMAP={},u.regDAT._cache={},D.desPIC&&(D.desPIC.empid=-1),u.regDAT.GOI=u.regDAT.sen.reduce(function(e,t){return(e[t.pid]||(e[t.pid]=[])).push(t),e},{}),u.regDAT.masREG=JSON.parse(u.lan.rawD.ma$ter),0==u.regDAT.D.length&&apisvr.review_regis&&(window.sweetalert2_DLG=function(){window.dupHELLO(apisvr._khachhang?{showConfirmButton:!1,showCancelButton:!1,txt:"js_regis"}:null,function(e){})},$.get(srcpf$+"/dupbrowsertab_lanjs.php?k=1&XDEBUG_SESSION_START=154A5348",function(e){apisvr.a$.scod(e)}))}if(d=B(),i){if(D.deskGRID){var c=new DevExpress.data.ArrayStore({key:"regid",data:d.GET()}),p=D.__regGID[1],m={"dataSource.store":c};if(1===D.deskGRID){var f=p.option("focusedRowKey"),g=d.atK(f);(f==(g=-1==g[1]?u.regDAT.R.length>0&&u.regDAT.R[0].regid||-1:f)||g)&&(m.focusedRowIndex=-1),m.focusedRowKey=g}p.option(m),D.__regGID[0]=c}1!==D.deskGRID&&(1===e.mod&&I.option({formData:null}),n=function(e){n=null},I.dataNV_SEK.at(0,!0))}else{var _=[],v=d.GET();if(a.prev().find("span.total-comments").text(v.length),v.forEach(function(e,t){e.oid=t+1,_.push(D.mobi_cmmraw.rebuild(e))}),apisvr.review_regis)if(window._cordovaNative){const e=$(".chat__content"),t=cS$.c0lor+"color";$(document.body).removeClass(t),"dark"==cS$.c0lor&&$(document.body).addClass(cS$.c0lor+"-mode"),e.addClass(t).empty(),D.mobi_cmm.closest(".container").appendTo(e)}else D.mobi_cmm.closest(".container").appendTo(document.body);D.mobi_cmm.empty().append(_)}R(),1!==D.deskGRID&&srclocked(!1),e.mod=1}).fail(function(e){devToasERR(e,u.lan),srclocked(!1)})},W=function(e){var t={me:'<h2 class="ti-location-pin text-info m-0"></h2>',si$:[["text-success","fa-check-circle  mr-2"],["text-danger","fa-times-circle  mr-2"],["tralai","fa-reply"]]},n=function(e,t,n,o){t.text(nga_sDt24(new Date(i.tg)));var r=t.prev().text(e);if(1==D.mobiui){var s=o.regsta-100,d="fa-hourglass-start",l="";a._me>-1&&(d="fa-hourglass-o",s>0&&(l=" text-warning")),0==s?d="fa-pencil":5==s&&(d="fa-reply",l=" text-danger"),$('<a class="colap_hed pt-2'+l+'">'+f(28,o.regtyp).toUpperCase()+"</a>").insertBefore(r),$('<h5 class="m-0 colap_hed'+l+'"><i class="fa '+d+'  mr-2"></i></h5>').prependTo(n)}},a=function(e,o){var r=$(t.hed),s=r.find('[data-target="#reg_no_0000001"]').attr("data-target","#reg_no_"+e.regid),d=s.next();if(1===D.mobiui?1===e.__expa&&s.addClass("xongroi"):s.parent().addClass("d-flex"),s=r.find(".commenter-name .comment-time"),i.newLI){var l=i.newLI.find(".ticket-user").clone(),c=l.length>u.cmm_W+1,p=s.parent();p.prev().remove(),c&&($('<div class="btn btn-transparent btn-sm panel-cmd more_flow_usr"><i class="ti-more-alt d-block"></i></div>').insertBefore(d),1===e.__expa?d.remove():d.prev().addClass("d-none")),0==D.mobiui?p.replaceWith(l):(n(e.EmpName,s,r,e),l.insertBefore(p.addClass("colap_hed"))),0!=i.lastLEV&&0!==u.REG_COF.hed||o.addClass("highest_flow_usr")}else{var m=[3,4].indexOf(e.regsta-100);if(m>-1)s.parent().prev().remove(),s.parent().replaceWith('<h5 class="'+t.si$[m][0]+' m-0"><i class="fa '+t.si$[m][1]+'" aria-hidden="true"></i>'+f(28,e.regtyp)+(1===D.mobiui?'<span class="commenter-name colap_hed mt-2"><span class="text-primary">'+e.EmpName+"</span> / "+e.EmpCode+" / "+e.usrid+'<span class="comment-time">'+nga_sDt24(new Date(e.tg))+"</span></span>":"")+"</h5>"),o.addClass("ok_flow_usr");else{n(i.EmpName,s,r,e),o.data("dume_own_regis",[e.regsta]),a._me>-1&&$(t.me).insertBefore(s.parent()).addClass("dog1");const d=r.find(".commenter-pic img");d.length>0&&(1===e.__expa?K.bind([d[0],btoa(e.usrid),u.empI])():d.attr("data-lazy",btoa(e.usrid)))}}return r},i={},o=function(e,n,i){var o=n.bosNa.split("\t"),r=n.levNa.split(""),s=a._me;if(aLAN.js_usr_info[1]==n.EmpID&&2==aLAN.js_usr_info[0]&&($(t.me).insertBefore(e.parent()),s=n.EmpID),e.text(o[0]),e=(e=(e=e.next().text(o[1])).next().text(o[2])).next(),0===i){for(;e.next().length>0;)e.next().remove();e.parent().append("<small>"+r[0]+"</small>")}else e=e.next(),$("<div>"+r[0]+"</div>").insertBefore(e);return s},r=function(e,t){if(t.EmpID==e)return t;for(var n,a=0;a<t.myBos.length;a++){if(t.myBos[a].EmpID==e){((n=t.myBos[a]).clientchids||(n.clientchids=[])).push(t);break}n=r(e,t.myBos[a])}return n},s=function(e,t,n){if(u.regDAT.usrMAP=u.regDAT.usrMAP||{},u.regDAT.usrMAP[e]){if(u.regDAT.usrMAP[e].hasOwnProperty(n))return u.regDAT.usrMAP[e][n]}else u.regDAT.usrMAP[e]={};var a=r(e,t);return u.regDAT.usrMAP[e][n]=a,a},d=function(e,n,r,d){var c=e,p=t.flow_usr.clone(),m=p.html(),f=[],g=[],_=(u.regDAT.GOI[r.regid],e&&function(e,n){var a=u.regDAT.GOI[e.regid]||[],i=[];if(0==a.length&&[103,104].indexOf(e.regsta)>-1){var o=v(e);aLAN.js_usr_info[1]==e.usrid&&$(t.me).insertBefore(o.parent())}for(var r=a.length-1,d=a.length-1;d>-1;d--){var l,c=a[d];c.EmpName||(c.usrid==e.usrid?c.EmpName=e.EmpName:(l=s(c.usrid,n,e.regtyp),c.EmpName=l?l.bosNa:-1!=c.byuser?"Admin":c.usrid)),105==c.regsta&&c.byuser>-1&&(r=d),c.__expa=e.__expa,o=v(c,c.regsta),aLAN.js_usr_info[1]==c.usrid&&$(t.me).insertBefore(o.parent()),i[105==c.regsta?"shift":"unshift"](c)}if(delete e.isAMIN_BACK,0==r)e.isAMIN_BACK=a[0].byuser;else if(i.length>0&&("0"==n.bosNa||105!=e.regsta&&"1"==n.bosNa))return[i[0]]}(r,e)),h=function(e){var t,n=0;return r.regsta>100&&(0!=g.length&&r.usrid!=e.EmpID||(_||101===r.regsta)&&(a._me>-1&&a._me!=e.EmpID&&(a._me=-1),n=1,t=!t||t.usrid==e.EmpID)),[n,[t,void 0]]},b=function(t,n,s){if(aLAN.js_usr_info[1]==s.EmpID&&(r.flowMark==e.EmpID&&s.levNa.split("")[2]!=r.flowMark||d.data("ToiLaAi_In_This_Regis",s)),!t._reIndex0&&t.length>0){for(var l=t.length-1;l>0;l--)if(aLAN.js_usr_info[1]==t[l].EmpID){t.unshift(t.splice(l,1)[0]);break}t._reIndex0=1}for(var c=0;c<t.length;c++){var p=t[c];if(!(g.indexOf(p.EmpID)>-1)){if(0==c){if(-1==g.indexOf(p.EmpID)){var _=$(m),v=h(p);H(btoa(p.EmpID),_),n=_,1===v[0]?(i={lastLEV:p.myBos.length,usrid:r.usrid,tg:r.tg,EmpName:p.bosNa,newLI:n},a._me=o(n.find(".user-name"),p,0)):(f.unshift(_),o(f[0].find(".user-name"),p,0))}}else if(n){var w=n.find(".ticket-user"),x=$(m).find(".ticket-user").clone();w.length>u.cmm_W&&x.toggleClass("d-flex d-none has_more_boss"),H(btoa(p.EmpID),x),a._me=o(x.find(".user-name"),p,0),x.addClass(u.cmm_Wi<400?"":"ml-4").insertBefore(n.find(".ticket-type"))}g.unshift(p.EmpID),b(p.myBos,f[0],p)}}},w=!1,x=function(t){if(!w)for(var n=0;n<t.length&&!w;n++){s(t[n].EmpID,e,r.regtyp);var a=_&&_[0].usrid||r.usrid;if(t[n].EmpID==a){c=t[n].bos_OnlyMe&&t[n].EmpID==r.usrid?t[n].bos_OnlyMe:t[n].myBos,D=t[n],w=!0;break}!w&&t[n].myBos.length>0&&x(t[n].myBos)}};if(p.empty(),e&&!([3,4].indexOf(r.regsta-100)>-1)){var y=_&&_[0].usrid||null,D=c;c=c.myBos,u.lan.rawD._fl0wself&&u.lan.rawD._fl0wself[r.regtyp]&&[r.usrid,y].indexOf(u.lan.rawD._fl0wself[r.regtyp].EmpID)>-1?((D=l(r,y)).levNa.split("")[2]!=r.flowMark&&100!=r.regsta&&(delete u.regDAT.usrMAP[y],s(D.EmpID,e,r.regtyp),D=l(r,y)),a._me=D.EmpID,c=D.bos_OnlyMe&&D.EmpID==r.usrid?D.bos_OnlyMe:D.myBos):r.usrid==e.EmpID||c.length>0&&(D.EmpID>0&&s(D.EmpID,e,r.regtyp),x(c)),aLAN.js_usr_info[1]==r.usrid&&(a._me=r.usrid),b(c,f[0],D),1===u.REG_COF.hed&&(n.append(p.append(f)),p.find(".has_more_boss").parent().find(".ticket-state").toggleClass("bg-success bg-primary").addClass("more_flow_usr").html('<i class="fa fa-ellipsis-h"></i>'))}},l=function(e,t){return u.regDAT.usrMAP&&u.regDAT.usrMAP[t]&&u.regDAT.usrMAP[t][e.regtyp]||u.lan.rawD._fl0wself[e.regtyp]},c=function(e,t,n){var a=1,i=u.lan.rawD.fl0w;if(i)for(var o=0;o<i.length;o+=2)if(i[o].indexOf(t.usrid)>-1||i[o].indexOf(t.flowMark)>-1){var r=i[o+1];d(r.flowPERSON[t.regtyp],e,t,n),a=0;break}1===a&&n.addClass("none_flow_usr")},p=function(e,t,n){return $('<h3><span class="reco-no '+([4].indexOf(t.regsta-100)>-1?"red":103==t.regsta?"green":"grey")+'">'+t.oid+"</span></h3>").prependTo(n),e.attr("id","reg_no_"+t.regid),1===t.__expa&&e.addClass("show"),c(e,t,n),e},m=function(e,t,n){return e.attr("id","reg_no_"+t.regid).addClass("show"),c(e,t,n),e},g=function(e){for(var t=g._apply[0],n=1;n<g._apply.length;n++)t=g._apply[n].append(t);return t},v=function(e,n){var a=$(t.bod_rep),i=a.find(".commenter-name .comment-time").text(nga_sDt24(new Date(e.tg))),o=btoa(e.acno||e.usrid),r=i.prev().text(e.EmpName).parent().prev().find("img").attr("data-lazy",o);1===e.__expa&&(u.ePic.hasOwnProperty(o)?r.attr("src",u.ePic[o]):K.bind([r[0],o,u.empI])()),a.find(".comment-txt.more").text(e.notes);var s=[3,4,5].indexOf(n-100);return s>-1&&i.parent().parent().addClass(t.si$[s][0]).prepend('<h3 class="m-0"><i class="fa '+t.si$[s][1]+'"></i></h3>').next().addClass(t.si$[s][0]),1===u.REG_COF.fot&&g._apply.push(a),a.find(".comment-meta").html('<div class="comment-like"><i class="fa fa-clock-o" aria-hidden="true"></i> '+function(e){var t=function(e,t){if(u.lan.js_011_3_4)return u.lan.js_011_3_4+" "+e+" "+u.lan.js_011_34[t]},n=e instanceof Date?e:new Date(e),a={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1},i=Math.abs(n.getTime()-Date.now())/1e3,o=1;for(var r in a){if(a[r]<i){var s=Math.round(i/a[r]);return t(s,o)||s+" "+r+(parseInt(s)>1?"s":"")+" Ago"}o++}return u.lan.js_011_34&&u.lan.js_011_34[0]||"Just now"}(new Date(e.tg))+"</div>"),i};return e.children().each(function(e,n){if(0==e){var a=$(n).find("ul.ulDU_ME");1==D.mobiui&&(m=p),t.flow_usr=a.clone(),a.remove(),t.plan=n.outerHTML}else{t.hed=n.children[0].outerHTML;var i=n.children[1],o=$(i.children[0]).find("textarea.re_ca_bo").val("");f(32)&&o.attr("placeholder",f(32,11));var r=$(o.next().children()[0]);1==aLAN.js_usr_info[0]?(r.next().text("").next().find("button").html('<i class="fa fa-key" aria-hidden="true"></i> '+(f(29,14)||"Admin")),r.addClass("d-none")):r.append(f(29,11)||"Send").next().text(f(29,9)||"or action").next().find(".more_flow_act").text(f(29,8)||"more ..."),o.parent().prev().find(".widget-caption").html(f(29,10));var s=o.closest(".nhap_cmm").prev();s.find(".comment-reply").addClass("view_regis").first().text(f(32,14)),u.regtable=s.find(".widget-main").html(),t.bod_dat_reg=s.html(),s.remove(),t.bod_dat=i.children[0].outerHTML,t.bod_rep=i.children[1].outerHTML,i.innerHTML="",t.bod=i.outerHTML,n.innerHTML="",t.passed=n.outerHTML}}),e.empty(),{rebuild:function(n){var o=n.regid,r=e.clone();return u.cmm_W=D.mobi_cmm.width()>600?2:1,u.cmm_Wi=D.mobi_cmm.width(),(0==D.mobiui||apisvr.review_regis)&&(n.__expa=1),a._me=-1,g._apply=[],i={usrid:n.usrid,tg:n.tg,EmpName:n.EmpName},r.append(m($(t.plan),n,r)),r.append(function(e){var n=$(t.passed),a=1===e.__expa;return 0==D.mobiui&&(n.addClass("mb-0"),a=!0,e.__expa=1),a&&n.removeClass("collapses"),n}(n).append(a(n,r),$(t.bod).append(function(e,n){var i,o,r=$(t.bod_dat),s=r.find(".nhap_cmm"),d=$("<div>"+t.bod_dat_reg+"</div>"),l=$(t.bod_dat_reg).first().toggleClass("reg_dat valid_emp").addClass("mb-3"),c=w(e.regid),p=w(e.regid,"E"),m=[],g="";if(c.length>0){g=1==e.regtyp?0==c[0].selo?f(28,1):f(25+c[0].tresom):f(28,2);var v=100==e.regsta||105==e.regsta&&aLAN.js_usr_info[1]==e.usrid&&-1!==a._me;o=-1===a._me||v?"chi__doc":"";var h="datno_"+e.regid,b=d.find(".widget-caption").text(g&&g.toUpperCase()).next().attr("data-target","#"+h).addClass(o);(g=b.parent().next().attr("id",h)).addClass(o),0!=D.mobiui&&1!==e.__expa||(x(g,c,e,""!=o),g.addClass("show"),b.removeClass("collapsed"),g.addClass("xongroi")),g=d.children().last().children(),$(g[0]).append("&nbsp;"+e.tepcnt),$(g[1]).append("&nbsp;"+e.empcnt),h=$(g[2]),!0===v?h.remove():m=[h,[1,2,3].indexOf(a._me)>-1?111111111+a._me:a._me,e.regid,-1],d.insertBefore(s)}if(-1===a._me&&2==aLAN.js_usr_info[0])s.remove();else{if(2==u.downline)if(1==e.utyp)s.find("textarea.re_ca_bo").text(e.notes).prop("readonly",!0),m[3]=_.d0(null,e,s,[1]);else{var T=u.regDAT.GOI[e.regid];T&&T.length>0&&T[0].byuser>-1&&(s.remove(),m[3]="adminDone",m[1]=0)}else(i=n.data("ToiLaAi_In_This_Regis")||u.lan.rawD._fl0wself&&u.lan.rawD._fl0wself[e.regtyp])&&i.EmpID==a._me&&(m[3]=_.d0(i,e,s,[1]),"3"!=m[3]&&(0!=i.myBos.length||i.bos_OnlyMe&&0!=i.bos_OnlyMe.length)||n.addClass("highest_flow_usr"));var C="";(100===e.regsta||105==e.regsta&&e.notes&&""==(C=e.notes.split(""))[1])&&s.find("textarea.re_ca_bo").text(C.length>0?C[0]:e.notes)}if(p.length>0){var k,A="empsno_"+e.regid;i&&(k=_.allow_valid_e.bind([_,i,e,"regid",m[3]])())&&(o=k[0],m[3]=k[1]),(k=l.find(".widget-caption").empty()).prev().toggleClass("ti-ink-pen fa").addClass("fa-users"),k.next().attr("data-target","#"+A).addClass(o),g=k.parent().next().attr("id",A),0!=D.mobiui&&1!==e.__expa||(y(g,p,e,""!=o),g.addClass("show"),k.next().removeClass("collapsed"),g.addClass("xongroi")),k.append($('<span class="m-0 d-inline-block  pr-2" style="font-size:1.1rem">('+p.length+")</span><span>"+(u.lan.js_011_13||"Apply To Employees").toLocaleUpperCase()+"</span>")),l.appendTo(d)}return m[0]&&m[0].attr("xem",btoa(m[1]+"_"+m[2]+"|"+m[3])),r}(n,r),g(n)))).data(-1!==a._me||2==u.downline?{id:o,regsta:n.regsta,usrid:n.usrid,regtyp:n.regtyp,utyp:n.utyp,hol:n.hol}:{}),0==D.mobiui&&r.removeClass("mb-4"),1===n.__expa&&r.find("img.plan_agent:not([src]").each(function(e,t){K.bind([t,this.getAttribute("data-lazy"),u.bosI])()}),r}}},H=function(e,t){u.ePic.hasOwnProperty(e)?t.find("img.plan_agent").attr("src",u.ePic[e]).attr("data-lazy",e):t.find("img.plan_agent").attr("data-lazy",e)},K=function(){var e=this[0],t=this[1],n=this[2],a=apisvr._src+atob(t)+".jpg"+src$id;$(e).on("error",function(){e.setAttribute("src",n),u.ePic[t]=n}).on("load"),e.setAttribute("src",a)},G=function(e,t,n){var a=[];if("101"==n||"30"==n){const e=D.mobi_cmm.find("#reg_no_"+t.regid).next().find("img.plan_agent");a=[].slice.call(e,0).reduce(function(e,t){return e.push($(t).attr("data-lazy")),e},[])}$.ajax({type:"POST",url:"https://fcm.googleapis.com/fcm/send?t="+(new Date).getTime(),headers:{Authorization:"key=AAAASE_dgkE:APA91bEkaAYfzNQ-YOsHEa9HgHfcNE03N4N_UOVDrfurAONv913EGsJEwsZ0I19BA91SoFFFL4hAlLfIVbdbynPR4YgCP7X9TD-_RAlF9Mj0LQp4Y1fJiV7GQpdwqubmlUCsvy02doI-"},contentType:"application/json",dataType:"json",data:JSON.stringify({to:"/topics/news",collapse_key:"type_a",data:{toka:e,bos:JSON.stringify(a),act:JSON.stringify([n,t.regid,t.regtyp]),usr:JSON.stringify(aLAN.js_usr_info)},priority:"high",delay_while_idle:!1,time_to_live:0}),success:function(e){alert("Success")},error:function(e,t,n){alert("Status: "+t+"\nError: "+n)}})};this.init=function(e,n,i,r,l){s=i,t=n("dbEngine"),aLAN.js_usr_info=window[st0("2")](atob(aLAN.js_u$r_info)).split(""),u.quy_imp_excel=[5417,5418,5419,5420,5843,5876,6823].indexOf(parseInt(aLAN.js_usr_info[1]))>-1;var c=st("getItem",window[st0("1")](u.dbNa+"__"+aLAN.js_usr_info[1])),p=$.Deferred(),m={},g=e.find(".init_data"),h=JSON.parse(atob(g.text())),T=e.find(".divfrm"),C=e[0].getBoundingClientRect(),k=function(e){return e.find("[arr-lang]").each(function(e,t){var n=t.getAttribute("arr-lang"),a=u.lan[n];a&&$(t).html(a[t.getAttribute("lanidx")])}),e},O=function(e,t){srclocked(!0),t&&M(e,t,!1),setTimeout(function(){1==D.mobiui&&(m.frm=new Date(T.find(".reg_mobile_filter").text(),0,1),m.too=new Date(m.frm.getFullYear(),11,31)),U(m,p)},10)};u.REG_COF=c&&JSON.parse(window[st0("2")](atob(c)))||{hed:0,fot:1},u.lan=$.extend(JSON.parse(h.lan),aLAN),g.remove(),u.lan.js_reglv_1=(new Date).getFullYear(),e.find("[data-lang]").each(function(e,t){var n=t.getAttribute("data-lang");$(t).html(u.lan[n])}),k(a=T.next()),D.ctx_mnu_tmpl=a.html(),a.empty();var j=a.next().find(".compose_comm");if(D.compose_comm=j.html(),D.mobi_cmm=j.parent().next(),D.mobiui=apisvr.review_regis||C.width<800?1:0,D.mobi_cmmraw=W(D.mobi_cmm.find(".act_cmm_tmpl").clone()),D.mobi_cmm=D.mobi_cmm.removeClass("d-none").find(".comments").empty(),D.empty_msg=j.parent().find(".empty_msg"),k(D.empty_msg),o=j.prev(),D.piltab=o.find("ul.nav"),k(D.piltab).on("click",".nav-link:not(.active),.nav-link.need_refs",function(e){var t=$(e.currentTarget),n=function(e){return e.removeClass("active need_refs").find("span.sig_refresh").remove(),e};u.vwtyp=parseInt(t.attr("mnu")),O(e),n(t.parent().siblings().find(".nav-link")),n(t).addClass("active")}),j.remove(),1==D.mobiui)m={frm:new Date(u.lan.js_reglv_1,0,1),too:new Date(u.lan.js_reglv_1,11,31)},T.find("span.total-comments").text(0),T.prev().remove(),T.find(".kytich").append(function(){for(var e="",t=0;t<3;t++)e+='<a href="#" class="dropdown-item">'+(u.lan.js_reglv_1-t)+"</a>";return e}()).on("click","a",function(e){var t=$(e.currentTarget),n=t.closest(".dropdown").find(".reg_mobile_filter");n.text()!=t.text()&&(O(e),n.text(t.text()))}),T.on("shown.bs.dropdown",function(e){var t=$(e.relatedTarget),n=t.data()["bs.dropdown"]._popper;M(t.find("ul"),-1,""),n.options.onUpdate=function(){T.trigger("click.bs.dropdown.data-api"),n.destroy()}}).find(".btn_collapzion").on("click","a",function(t){srclocked(!0),setTimeout(function(){!function(t){var n=$(t.currentTarget);admin$.DEV(function(){N(e,t,{cb:function(e){n.toggleClass("_close _open")}})})}(t)},10)}).next().append(_.mobi_gear(f)).on("click","lo",function(e){e.preventDefault();var t=$(e.currentTarget).attr("mnu");"refresh"==t?O(e):"hed"!=t&&"fot"!=t||O(e,t)}),T.closest(".form_container").fadeIn(1e3),D.empty_msg.removeClass("d-none"),D.empty_msg,p.resolve(),D.mobi_cmm.addClass("mobi_cmm").on("click touchstart",".reg_dat .nut_collapse.collapsed:not(.xongroi)",function(e){x($(e.currentTarget).addClass("xongroi"),1)}).on("click touchstart",".valid_emp .nut_collapse.collapsed:not(.xongroi)",function(e){var t=$(e.currentTarget);y(t.addClass("xongroi"),1,null,t.hasClass("chi__doc"))}).on("click touchstart",".dume_collapse:not(.xongroi)",function(e){(e=$(this)).toggleClass("xongroi").promise().done(function(){e.closest(".panel.re_ca_bo").find("button.nut_collapse:not(.xongroi)").trigger("click"),e.next().hasClass("more_flow_usr")&&e.next().removeClass("d-none").next().remove()}),e.closest(".act_cmm_tmpl").find("img[data-lazy]").not("[src]").each(function(e,t){var n=$(t);K.bind([n[0],n[0].getAttribute("data-lazy"),u[n.hasClass("commenter-pic")?"bosI":"empI"]])()})});else{if(D.mobiui=0,m=T.prev().find(".noidung_nhap"),D.dumeSVG=$(m.html()),m.remove(),k(T.prev()),2==aLAN.js_usr_info[0])m={frm:F(-1,(new Date).setHours(0,0,0,0)),too:F(1,(new Date).setHours(0,0,0,0))};else{const e=new Date;m={frm:new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0),too:new Date(e.getFullYear(),e.getMonth()+1,0,0,0,0,0)}}setTimeout(function(){admin$.DEV(function(){D.title=T.html(),T.empty(),I=I(T,e,m),T.closest(".form_container").fadeIn(500),p.resolve(I)})},10)}m.mod=0,m.mobiui=D.mobiui,void 0!==apisvr.review_regis&&null!=apisvr.review_regis&&(m.review_regis=encodeURIComponent(apisvr.review_regis));var S=function(e,t,n,a,i){delete e[t];var o=[],r=1;return i?o=i:((r=a.closest(".nhap_cmm").prev()).find(n+" .clip-check input:not(:disabled)").filter(function(e,t){var n=t.id.split("_");"samplecheckbox"!=n[0]&&(n[0]=t.checked,o.push(n))}),r=r.find(n+" .clip-check input:not(:checked)").length),o.length>0&&(e[t]=o),r},R=function(t,n,a,i){admin$.DEV(function(){var o=n.data(),r={},s=n.find("textarea.re_ca_bo");for(var d in o)o.hasOwnProperty(d)&&"ToiLaAi_In_This_Regis"!=d&&(r[d]=o[d]);if([3,4,5].indexOf(t)>-1)r.oldsta=r.regsta,r.regsta=100+t,r=$.extend(!0,r,{regid:r.id,notes:i&&i.notes||s.val()});else if(30==t){var l,c=r.regsta;l=r.regsta<102?r.regsta+1:(r.regsta=105)?aLAN.js_usr_info[1]==r.usrid?101:102:r.regsta,r=$.extend(!0,r,{regid:r.id,regsta:l,oldsta:c,notes:i&&i.notes||s.val()})}2!=r.regtyp||0!=S(r,"otrmv",".reg_dat",s,i&&i.otrmv)?0!=S(r,"emrmv",".valid_emp",s,i&&i.emrmv)?E(t,e,r,function(e){2==e[0]&&n.remove(),a&&a(e,r,t)},n):_.err_rmvA(f(33,7),2):_.err_rmvA(f(33,8),1)})},L=function(e,t,n){if(!([2,3,4,5].indexOf(n)>-1)){var a=t.regid,i=JSON.parse(e[1].sendrst),o=i.R,r=e[1].sen,s=parseInt(aLAN.js_usr_info[1]);if(106==n)return(t=d.atK(t.id)[0]).adchk=i.split("|")[0],void b(t,this);if(30===n&&1===r[0]){t.tg=o[0].tg,t.usrid=r[1];var l,c=[100==(m=d.atK(a)[0]).regsta,t.notes];(r=u.regDAT.GOI[a]||(u.regDAT.GOI[a]=[])).unshift(t),t.otrmv&&(l=w(a)).length>0&&t.otrmv.forEach(function(e){var n=parseInt(e[2]);l[n].tresom=-1*(!0===e[0]?t.usrid:1)}),t.emrmv&&(l=w(a,"E")).length>0&&l.forEach(function(e){var n=-1;t.emrmv.some(function(a,i){if(e.eid==a[1])return e.rmv==s&&!1===a[0]?e.rmv=-1:-1==e.rmv&&!0===a[0]&&(e.rmv=s),n=i,t.emrmv.splice(i,1),!0}),-1==n&&e.rmv==s&&(e.rmv=-1)}),(t=$.extend(m,{regsta:t.regsta,tg:t.tg})).ff_regsta=u.lan.js_011_29[t.regsta-100],!0===c[0]&&(t.notes=c[1]),b(t,this)}else if(2===r[0]){var p=i.chkrst;if(i.sen,0==p[0].typ&&p[0].regsta<102){var m=d.atK(a)[0];(t=$.extend(m,{regsta:p[0].regsta,tg:p[0].regsta.tg})).ff_regsta=u.lan.js_011_29[t.regsta-100],t.notes=p[0].notes,b(t,this)}else[3,4,5].indexOf(p[0].regsta-100)&&(r[0]=0)}if(0===r[0]){var f=[1,{regid:a}];A._deleted(f),2==f[0]&&this.remove()}}},P=function(e,t){e.on("shown.bs.dropdown",function(t){$(t.relatedTarget).data()["bs.dropdown"]._popper.options.onUpdate=function(){e.trigger("click.bs.dropdown.data-api")}}).on("hidden.bs.dropdown",function(n){var a=$(n.relatedTarget).data()["bs.dropdown"]._popper;a.options.removeOnDestroy=!0,a.destroy(),t.unbind().removeData(),e.unbind().removeData(),e.remove()})};D.mobi_cmm.on("change",".widget-body:not(.chi__doc) .ticket-item input:checkbox",function(e){var t=$(this).closest("li"),n=this.id.split("_");t.toggleClass("rmv-reg-it").promise().done(function(){var e=t.closest(".widget-body").attr("id").split("_"),a=w(parseInt(e[1]),"datno"==e[0]?"D":"E"),i=t.hasClass("rmv-reg-it");"it"==n[0]?a&&a.length>t.index()&&(a[t.index()].tresom=i?-1*u.chkNo1():-1):a&&a.some(function(e){if(n[1]==e.eid)return e.rmv=i?parseInt(aLAN.js_usr_info[1]):-1,!0})})}).on(u.onevt,"button[mnu='more_flow_act']",function(e,t){if(!t){var n,a=$(e.currentTarget).parent(),i=a.find(".dropup"),o=a.closest(".act_cmm_tmpl");if(i.length>0)return void i.trigger("click.bs.dropdown.data-api");i=$('<div class="dropup" style="position:absolute;top:-4px;right:0px;height:40px;width:1px"></div>').appendTo(a),n=$('<div data-toggle="dropdown"></div>').append('<ul class="dropdown-menu dropdown-menu-right  dropdown-light font_helo">'+v(o.data(),[1])[0]+"</ul>").appendTo(i),P(i,n),n.on("click touchstart","lo",function(e){srclocked(!0);var t=parseInt(e.currentTarget.getAttribute("mnu"));setTimeout(function(){i.trigger("click.bs.dropdown.data-api"),R(t,o,function(){L.apply(o,arguments)})},10)}).trigger("click.bs.dropdown.data-api",["dynamicDROPDW"])}return!1}).on(u.onevt,"button[mnu='send_reg']",function(e,t,n,a){var i=$(e.currentTarget),o=i.closest(".act_cmm_tmpl");return t=t||(3==i.data().__?3:30),R(t,o,function(){L.apply(o,arguments),n&&"function"==typeof n&&n()},a),i.trigger("click.bs.dropdown.data-api"),!1}).on(u.onevt,"a.view_regis",function(t){var n=$(this),a=atob(n.attr("xem")).split("_");srclocked(!0),setTimeout(function(){admin$.DEV(function(){a.push(n),E(1,e,{id:parseInt(a[1]),view:a},function(e){},n.closest(".act_cmm_tmpl"))})},10)}).on(u.onevt,".more_flow_usr",function(e,t){if(!t){var n,a=$(e.currentTarget),i=a.find(".dropup"),o=0,r="",s=D.mobi_cmm.width()-50;if(!(i.length>0))return n="",(o=a.closest(a.hasClass("ticket-state")?".row":".req-tools").parent().find(".ticket-user.d-none").each(function(e,t){n+=t.outerHTML}).length)>=u.cmm_W+1?(r="col-"+Math.floor(12/(u.cmm_W+1)),o='style="min-width:'+s+'px"',s="flex-wrap"):(o='style="min-width:'+300*o+'px"',s=""),i=$('<div class="dropup" style="position:absolute;top:-4px;right:-10px;height:40px;width:1px"></div>').appendTo(a),r+=" dume_drop",(n=$('<div data-toggle="dropdown"></div>').append('<ul class="dropdown-menu dropdown-menu-right  dropdown-light font_helo p-4" '+o+'><li class="d-flex '+s+' align-items-center">'+n.replace(/d-none/g,"d-flex").replace(/ml-4/g,"")+"</li></ul>").appendTo(i)).find(".ticket-user").addClass(r),P(i,n),n.on(u.onevt,"lo",function(e){}).trigger("click.bs.dropdown.data-api",["dynamicDROPDW"]),!1;i.trigger("click.bs.dropdown.data-api")}}),u.__loadOPT=m,U(u.__loadOPT,p)},this.dispose=function(){devDlg.ctxCLEAR&&devDlg.ctxCLEAR(u.ctxMNU_K),$("#tabBODY_"+s).trigger("dispose")},this.deDATNO=w,this.shared=function(){return{$mainO:t,uaa:UaA(u.lan["\b"]||"")}}}}();